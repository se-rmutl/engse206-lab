# 6.6.3.1 Frontend - Electron Agent Desktop App (Complete Version V3.2 - Final)

**เอกสารฉบับสมบูรณ์พร้อมไฟล์ทั้งหมด**

---

## 📋 สารบัญ

1. [ภาพรวมโปรเจค](#ภาพรวมโปรเจค)
2. [โครงสร้างโปรเจค](#โครงสร้างโปรเจค)
3. [Setup & Installation](#setup--installation)
4. [Configuration Files](#configuration-files)
5. [Electron Files](#electron-files)
6. [React Components](#react-components)
7. [Services](#services)
8. [Utilities](#utilities)
9. [Styles](#styles)
10. [Testing & Running](#testing--running)

---

## ภาพรวมและสถาปัตยกรรม

## 1.1 ภาพรวมโปรเจค

**Agent Desktop Application** สร้างด้วย **Electron.js + React**  
เชื่อมต่อกับ Backend Server v2.0 ผ่าน REST API และ WebSocket

**เวอร์ชัน:** 3.2 (Final - ครบถ้วนทุกไฟล์)

**ฟีเจอร์หลัก:**
- 🔐 Login ด้วย Agent Code
- 📊 แสดงและเปลี่ยนสถานะ (Available, Busy, Break, Offline)
- 💬 รับข้อความจาก Supervisor แบบ real-time
- 🔔 Desktop notifications
- 🪟 System tray integration
- 🔄 Auto-reconnect WebSocket
- 
**Agent Desktop Application V3.2** คือแอปพลิเคชันสำหรับ Agent ในระบบ Call Center ที่สร้างด้วย:
- **Electron.js** - สร้าง Desktop Application
- **React** - UI Framework
- **Socket.io-client** - Real-time communication
- **REST API** - HTTP Communication

### จุดประสงค์
ให้ Agent สามารถ:
1. Login เข้าสู่ระบบด้วย Agent Code
2. เปลี่ยนสถานะ (Available, Busy, Break, Offline)
3. รับข้อความจาก Supervisor แบบ real-time
4. ดู Message History
5. ได้รับ Desktop Notifications

## 1.2 สถาปัตยกรรมระบบ

```
┌───────────────────────────────────────┐
│     Agent Desktop Application         │
│            (Electron + React)         │
├───────────────────────────────────────┤
│                                       │
│  ┌──────────────┐   ┌──────────────┐  │
│  │   Electron   │   │    React     │  │
│  │  Main Process│   │   Renderer   │  │
│  │   (Node.js)  │   │   Process    │  │
│  └──────┬───────┘   └──────┬───────┘  │
│         │                  │          │
│         └──────────┬───────┘          │
│                    │                  │
└────────────────────┼──────────────────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
         ▼           ▼           ▼
    REST API    WebSocket    Notifications
         │           │           │
         └───────────┴───────────┘
                     │
         ┌───────────▼───────────┐
         │   Backend Server      │
         │  (Express + Socket.io)│
         └───────────────────────┘
                     │
         ┌───────────┴───────────┐
         │                       │
         ▼                       ▼
    SQLite DB                 MongoDB
  (Master Data)           (Real-time Data)
```

## 1.3 โครงสร้างไฟล์

```
agent-desktop/
│
├── 📦 Configuration Files
│   ├── package.json          # Dependencies และ scripts
│   ├── .env.example          # Environment variables template
│   └── .gitignore            # Git ignore rules
│
├── ⚡ Electron Files
│   ├── main.js               # Electron main process (Node.js)
│   └── preload.js            # Security bridge between main/renderer
│
├── 📄 HTML Template
│   └── public/
│       ├── index.html        # Main HTML template
│       └── assets/           # Icons and static assets
│           ├── icon.png (256x256)
│           ├── tray-icon.png (32x32)
│           └── README.txt
│
└── ⚛️ React Application
    └── src/
        ├── index.js          # React entry point
        ├── App.js            # Main application component
        │
        ├── components/       # UI Components
        │   ├── ErrorBoundary.js
        │   ├── LoginForm.js
        │   ├── AgentInfo.js
        │   ├── StatusPanel.js
        │   └── MessagePanel.js
        │
        ├── services/         # External communications
        │   ├── api.js        # REST API calls
        │   ├── socket.js     # WebSocket management
        │   └── notifications.js
        │
        ├── utils/            # Helper functions
        │   ├── logger.js
        │   ├── validation.js
        │   └── dateUtils.js
        │
        └── styles/           # CSS files
            ├── App.css
            └── components.css
```

## 1.4 Data Flow (ขั้นตอนการทำงาน)

### 1.4.1 Login Flow
```
User → LoginForm → api.loginAgent() → Backend /auth/login
                                    ↓
                              Verify Agent Code in SQLite
                                    ↓
                              Generate JWT Token
                                    ↓
Frontend ← Token + User Data ← Backend Response
    ↓
Store Token → Load Messages → Connect WebSocket
```

### 1.4.2 Status Update Flow
```
User Click Status → handleStatusChange()
                           ↓
                    Try WebSocket First
                    (sendStatusUpdate)
                           ↓
                    ┌──────┴──────┐
                    │             │
              Success?          Failed?
                    │             │
                    ↓             ↓
              Broadcast to   HTTP Fallback
              Supervisors    (updateAgentStatus)
                    │             │
                    └──────┬──────┘
                           ↓
                    Save to MongoDB
                    (agent_status collection)
```

### 1.4.3 Message Reception Flow
```
Supervisor sends message → Backend saves to MongoDB
                                    ↓
                          Emit 'new_message' via WebSocket
                                    ↓
                          Agent receives event
                                    ↓
                    ┌───────────────┴───────────────┐
                    │                               │
            Update UI State                  Show Notification
            (Add to messages array)          (Desktop notification)
```

### 1.5 Key Technologies และเหตุผลการใช้

| Technology | Purpose | Why? |
|------------|---------|------|
| **Electron** | Desktop App Framework | ให้ Web App ทำงานเป็น Native Desktop App |
| **React** | UI Framework | Component-based, Easy state management |
| **Socket.io** | WebSocket Library | Real-time bidirectional communication |
| **JWT** | Authentication | Stateless, Secure token-based auth |
| **CSS Modules** | Styling | Scoped styles, No conflicts |

---

## Setup & Installation

### ขั้นตอนที่ 1: สร้างโปรเจค

```bash
mkdir agent-desktop
cd agent-desktop
npm init -y
```

### ขั้นตอนที่ 2: ติดตั้ง Dependencies

```bash
# Production dependencies
npm install react react-dom react-scripts socket.io-client dotenv

# Development dependencies
npm install --save-dev electron concurrently wait-on electron-builder
```

### ขั้นตอนที่ 3: สร้างโครงสร้าง Folders

```bash
mkdir -p public/assets
mkdir -p src/components
mkdir -p src/services
mkdir -p src/utils
mkdir -p src/styles
```

---

## Configuration Files

### 📄 package.json

```json
{
  "name": "agent-wallboard-desktop",
  "version": "3.1.0",
  "description": "Agent Desktop Application for Wallboard System - Complete Version",
  "main": "main.js",
  "homepage": "./",
  "author": "Your Name",
  "license": "MIT",
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject",
    "electron": "electron .",
    "electron-dev": "concurrently \"npm start\" \"wait-on http://localhost:3000 && electron .\"",
    "dist": "npm run build && electron-builder",
    "dist:win": "npm run build && electron-builder --win",
    "dist:mac": "npm run build && electron-builder --mac",
    "dist:linux": "npm run build && electron-builder --linux",
    "postinstall": "electron-builder install-app-deps"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-scripts": "5.0.1",
    "socket.io-client": "^4.7.2",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "electron": "^28.0.0",
    "concurrently": "^8.2.0",
    "wait-on": "^7.0.1",
    "electron-builder": "^24.6.3"
  },
  "build": {
    "appId": "com.wallboard.agent",
    "productName": "Agent Wallboard",
    "files": [
      "build/**/*",
      "main.js",
      "preload.js",
      "public/assets/**/*"
    ],
    "directories": {
      "buildResources": "public/assets"
    },
    "win": {
      "target": ["nsis"],
      "icon": "public/assets/icon.png"
    },
    "mac": {
      "target": ["dmg"],
      "icon": "public/assets/icon.png",
      "category": "public.app-category.business"
    },
    "linux": {
      "target": ["AppImage", "deb"],
      "icon": "public/assets/icon.png",
      "category": "Office"
    }
  },
  "browserslist": {
    "production": [">0.2%", "not dead", "not op_mini all"],
    "development": ["last 1 chrome version", "last 1 firefox version"]
  }
}
```

### 📄 .env.example

```bash
# API Configuration
REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_SOCKET_URL=http://localhost:3001

# Development
NODE_ENV=development
ELECTRON_IS_DEV=true
```

### 📄 .gitignore

```
# Dependencies
node_modules/
/.pnp
.pnp.js

# Testing
/coverage

# Production
/build
/dist
out/

# Misc
.DS_Store
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Editor
.idea/
.vscode/
*.swp
*.swo

# OS
Thumbs.db
```

---

## Electron Files

### 📄 main.js

```javascript
require('dotenv').config();

const { app, BrowserWindow, Tray, Menu, ipcMain, Notification } = require('electron');
const path = require('path');

const isDev = process.env.ELECTRON_IS_DEV === 'true' || 
              process.env.NODE_ENV === 'development' ||
              !app.isPackaged;

let mainWindow;
let tray;

console.log('Starting Agent Wallboard Desktop App');
console.log('Environment:', isDev ? 'DEVELOPMENT' : 'PRODUCTION');

// IPC Handlers
ipcMain.handle('show-notification', async (event, { title, body }) => {
  try {
    const notification = new Notification({ 
      title, 
      body,
      icon: path.join(__dirname, 'public/assets/icon.png')
    });
    notification.show();
    return { success: true };
  } catch (error) {
    console.error('Notification error:', error);
    return { success: false, error: error.message };
  }
});

ipcMain.handle('minimize-to-tray', () => {
  if (mainWindow) {
    mainWindow.hide();
    return { success: true };
  }
  return { success: false };
});

ipcMain.handle('show-app', () => {
  if (mainWindow) {
    mainWindow.show();
    mainWindow.focus();
    return { success: true };
  }
  return { success: false };
});

ipcMain.handle('get-app-version', () => {
  return app.getVersion();
});

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 400,
    height: 700,
    minWidth: 350,
    minHeight: 600,
    maxWidth: 500,
    icon: path.join(__dirname, 'public/assets/icon.png'),
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, 'preload.js'),
      devTools: isDev
    },
    show: false,
    resizable: true,
    maximizable: false,
    frame: true,
    backgroundColor: '#667eea'
  });

  const startUrl = isDev 
    ? 'http://localhost:3000' 
    : `file://${path.join(__dirname, 'build/index.html')}`;
  
  console.log('Loading URL:', startUrl);
  mainWindow.loadURL(startUrl);

  mainWindow.once('ready-to-show', () => {
    console.log('Window ready to show');
    mainWindow.show();
    if (isDev) {
      mainWindow.webContents.openDevTools();
    }
  });

  mainWindow.on('close', (event) => {
    if (!app.isQuiting) {
      event.preventDefault();
      mainWindow.hide();
      
      if (!global.hasShownTrayNotification) {
        if (tray) {
          tray.displayBalloon({
            title: 'Agent Wallboard',
            content: 'Application minimized to tray'
          });
        }
        global.hasShownTrayNotification = true;
      }
    }
  });

  mainWindow.webContents.on('did-fail-load', (event, errorCode, errorDescription) => {
    console.error('Failed to load:', errorCode, errorDescription);
    if (!isDev) {
      mainWindow.loadURL(`file://${path.join(__dirname, 'build/index.html')}`);
    }
  });
}

function createTray() {
  try {
    const trayIconPath = path.join(__dirname, 'public/assets/tray-icon.png');
    console.log('Creating tray icon:', trayIconPath);
    
    tray = new Tray(trayIconPath);
    
    const contextMenu = Menu.buildFromTemplate([
      { 
        label: 'Show App', 
        click: () => {
          if (mainWindow) {
            mainWindow.show();
            mainWindow.focus();
          }
        }
      },
      { type: 'separator' },
      { 
        label: `Version ${app.getVersion()}`,
        enabled: false
      },
      { type: 'separator' },
      { 
        label: 'Quit', 
        click: () => {
          app.isQuiting = true;
          app.quit();
        }
      }
    ]);
    
    tray.setContextMenu(contextMenu);
    tray.setToolTip('Agent Wallboard');
    
    tray.on('double-click', () => {
      if (mainWindow) {
        mainWindow.show();
        mainWindow.focus();
      }
    });
    
    console.log('Tray icon created successfully');
  } catch (error) {
    console.error('Tray creation failed:', error);
    console.log('Application will continue without tray icon');
  }
}

app.whenReady().then(() => {
  console.log('App is ready');
  createWindow();
  createTray();
});

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createWindow();
  } else if (mainWindow) {
    mainWindow.show();
  }
});

const gotTheLock = app.requestSingleInstanceLock();

if (!gotTheLock) {
  console.log('Another instance is already running');
  app.quit();
} else {
  app.on('second-instance', () => {
    if (mainWindow) {
      if (mainWindow.isMinimized()) mainWindow.restore();
      mainWindow.show();
      mainWindow.focus();
    }
  });
}

process.on('uncaughtException', (error) => {
  console.error('Uncaught exception:', error);
});

process.on('unhandledRejection', (error) => {
  console.error('Unhandled rejection:', error);
});
```

### 📄 preload.js

```javascript
const { contextBridge, ipcRenderer } = require('electron');

contextBridge.exposeInMainWorld('electronAPI', {
  showNotification: (title, body) => {
    return ipcRenderer.invoke('show-notification', { title, body });
  },
  
  minimizeToTray: () => {
    return ipcRenderer.invoke('minimize-to-tray');
  },
  
  showApp: () => {
    return ipcRenderer.invoke('show-app');
  },
  
  getAppVersion: () => {
    return ipcRenderer.invoke('get-app-version');
  },
  
  isElectron: true,
  platform: process.platform,
  isDevelopment: process.env.NODE_ENV === 'development'
});

console.log('Preload script loaded');
```

### 📄 public/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#667eea" />
    <meta name="description" content="Agent Wallboard Desktop Application" />
    <link rel="icon" href="%PUBLIC_URL%/assets/icon.png" />
    <title>Agent Wallboard</title>
    <style>
      #loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      }
      
      #loading-screen h2 {
        margin: 20px 0 10px 0;
        font-size: 24px;
      }
      
      #loading-screen p {
        margin: 0;
        font-size: 14px;
        opacity: 0.8;
      }
      
      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .app-loaded #loading-screen {
        display: none;
      }
    </style>
  </head>
  <body>
    <noscript>
      <div style="padding: 40px; text-align: center; font-family: sans-serif;">
        <h2>JavaScript Required</h2>
        <p>You need to enable JavaScript to run this application.</p>
      </div>
    </noscript>
    
    <div id="loading-screen">
      <div class="spinner"></div>
      <h2>Agent Wallboard</h2>
      <p>Loading application...</p>
    </div>
    
    <div id="root"></div>
  </body>
</html>
```

### 📄 public/assets/README.txt

```
Agent Wallboard Desktop App - Icon Assets
==========================================

Required Files:
--------------
1. icon.png (256x256px) - Main application icon
2. tray-icon.png (32x32px) - System tray icon

Creating Icons:
--------------
Option 1: Use online tools
- https://www.favicon-generator.org/
- https://favicon.io/

Option 2: Use placeholder
curl -L -o icon.png "https://placehold.co/256x256/667eea/FFFFFF.png?text=Agent"
curl -L -o tray-icon.png "https://placehold.co/32x32/667eea/FFFFFF.png?text=A"

Option 3: Use ImageMagick
convert -size 256x256 xc:#667eea -gravity center -pointsize 72 -fill white -annotate +0+0 "A" icon.png
convert -size 32x32 xc:#667eea -gravity center -pointsize 20 -fill white -annotate +0+0 "A" tray-icon.png
```

### 📄 สร้าง Icon ใน public/assets

```
Agent Wallboard Desktop App - Icon Assets
==========================================

ใน Terminal และ อยู่ที่ไดเร็คทอรี่ agent-desktop
สร้าง icon โดยเลือก Option 2: Use placeholder พิมพ์คำสั่ง:

curl -L -o public/assets/icon.png "https://placehold.co/256x256/667eea/FFFFFF.png?text=Agent"
curl -L -o public/assets/tray-icon.png "https://placehold.co/32x32/667eea/FFFFFF.png?text=A"
```

---

## React Components

### 📄 src/index.js

```javascript
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import ErrorBoundary from './components/ErrorBoundary';

document.body.classList.add('app-loaded');

const root = ReactDOM.createRoot(document.getElementById('root'));

root.render(
  <React.StrictMode>
    <ErrorBoundary>
      <App />
    </ErrorBoundary>
  </React.StrictMode>
);

console.log('Agent Wallboard Desktop App - Started');
console.log('Version:', process.env.REACT_APP_VERSION || '3.1.0');
console.log('Environment:', process.env.NODE_ENV);
```

### 📄 src/App.js

```javascript
import React, { useState, useEffect, useCallback, useRef } from 'react';
import LoginForm from './components/LoginForm';
import AgentInfo from './components/AgentInfo';
import StatusPanel from './components/StatusPanel';
import MessagePanel from './components/MessagePanel';
import { 
  setAuthToken, 
  getMessages, 
  updateAgentStatus,
  logoutAgent 
} from './services/api';
import { 
  connectSocket, 
  disconnectSocket, 
  sendStatusUpdate
} from './services/socket';
import { 
  showDesktopNotification, 
  requestNotificationPermission 
} from './services/notifications';
import logger from './utils/logger';
import './styles/App.css';
import './styles/components.css';

function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [agent, setAgent] = useState(null);
  const [status, setStatus] = useState('Offline');
  const [messages, setMessages] = useState([]);
  const [connectionStatus, setConnectionStatus] = useState('disconnected');
  const [error, setError] = useState(null);
  const [loadingMessages, setLoadingMessages] = useState(false);
  
  const socketRef = useRef(null);
  const isLoggedInRef = useRef(false);

  useEffect(() => {
    isLoggedInRef.current = isLoggedIn;
  }, [isLoggedIn]);

  useEffect(() => {
    requestNotificationPermission();
    logger.info('App initialized');
  }, []);

  const loadMessages = useCallback(async (agentCode) => {
    setLoadingMessages(true);
    try {
      logger.log('Loading existing messages for', agentCode);
      const messagesData = await getMessages(agentCode, 50);
      
      if (messagesData.success) {
        const messageList = messagesData.messages || [];
        logger.log('Loaded', messageList.length, 'messages');
        setMessages(messageList);
      }
    } catch (error) {
      logger.error('Failed to load messages:', error);
    } finally {
      setLoadingMessages(false);
    }
  }, []);

  useEffect(() => {
    if (!isLoggedIn || !agent) {
      return;
    }

    logger.log('Setting up WebSocket connection for', agent.agentCode);
    const socket = connectSocket(agent.agentCode);
    socketRef.current = socket;
    
    if (!socket) {
      logger.error('Failed to create socket connection');
      return;
    }

    const handlers = {
      connect: () => {
        logger.log('WebSocket connected');
        setConnectionStatus('connected');
        setError(null);
      },
      
      disconnect: (reason) => {
        logger.log('WebSocket disconnected:', reason);
        setConnectionStatus('disconnected');
      },
      
      connect_error: (error) => {
        logger.error('WebSocket connection error:', error);
        setConnectionStatus('error');
        setError('Failed to connect to server');
      },

      reconnect: (attemptNumber) => {
        logger.log('WebSocket reconnected after', attemptNumber, 'attempts');
        setConnectionStatus('connected');
        setError(null);
      },
      
      connection_success: (data) => {
        logger.log('WebSocket authentication successful:', data);
      },

      connection_error: (error) => {
        logger.error('Connection error from server:', error);
        setError(error.message || 'Connection error');
      },
      
      status_updated: (data) => {
        logger.log('Status updated:', data);
        setStatus(data.status);
      },

      status_error: (error) => {
        logger.error('Status error from server:', error);
        setError(error.message || 'Status update failed');
      },
      
      new_message: (message) => {
        logger.log('New message received:', message);
        
        if (isLoggedInRef.current) {
          setMessages(prev => [message, ...prev]);
          showDesktopNotification(
            `Message from ${message.fromCode}`,
            message.content
          );
        }
      },

      message_sent: (data) => {
        logger.log('Message sent confirmation:', data);
      },

      message_error: (error) => {
        logger.error('Message error from server:', error);
      },
      
      agent_connected: (data) => {
        logger.log('Agent connected:', data);
      },

      agent_disconnected: (data) => {
        logger.log('Agent disconnected:', data);
      }
    };

    Object.entries(handlers).forEach(([event, handler]) => {
      socket.on(event, handler);
    });

    return () => {
      logger.log('Cleaning up WebSocket connection');
      
      Object.entries(handlers).forEach(([event, handler]) => {
        socket.off(event, handler);
      });
      
      disconnectSocket();
      socketRef.current = null;
      setConnectionStatus('disconnected');
    };
  }, [isLoggedIn, agent]);

  const handleLogin = useCallback(async (agentData, token) => {
    logger.log('Login successful:', agentData);
    
    setAuthToken(token);
    setAgent(agentData);
    setIsLoggedIn(true);
    setStatus('Available');
    setError(null);
    
    await loadMessages(agentData.agentCode);
  }, [loadMessages]);

  const handleLogout = useCallback(async () => {
    logger.log('Logging out');
    
    try {
      await logoutAgent();
    } catch (error) {
      logger.error('Logout API call failed:', error);
    }
    
    disconnectSocket();
    
    setIsLoggedIn(false);
    setAgent(null);
    setStatus('Offline');
    setMessages([]);
    setConnectionStatus('disconnected');
    setError(null);
    setLoadingMessages(false);
  }, []);

  const handleStatusChange = useCallback(async (newStatus) => {
    if (!agent) return;
    
    logger.log('Changing status to:', newStatus);
    
    const previousStatus = status;
    setStatus(newStatus);
    
    try {
      const socketSuccess = sendStatusUpdate(agent.agentCode, newStatus);
      
      if (socketSuccess) {
        logger.log('Status update sent via WebSocket');
      } else {
        logger.log('WebSocket not connected, using HTTP API fallback');
        await updateAgentStatus(agent.agentCode, newStatus);
        logger.log('Status updated via HTTP API');
      }
    } catch (error) {
      logger.error('Status update failed:', error);
      
      setStatus(previousStatus);
      setError('Failed to update status. Please try again.');
      
      setTimeout(() => setError(null), 3000);
    }
  }, [agent, status]);

  const clearError = useCallback(() => {
    setError(null);
  }, []);

  return (
    <div className="app">
      <div className={`connection-status ${connectionStatus}`}>
        <div className="status-indicator"></div>
        <span>
          {connectionStatus === 'connected' && 'Connected'}
          {connectionStatus === 'disconnected' && 'Disconnected'}
          {connectionStatus === 'error' && 'Connection Error'}
        </span>
      </div>

      {error && (
        <div className="error-banner">
          <span>{error}</span>
          <button onClick={clearError} className="error-close" aria-label="Close error">
            ×
          </button>
        </div>
      )}

      {!isLoggedIn ? (
        <LoginForm onLogin={handleLogin} />
      ) : (
        <div className="dashboard">
          <div className="dashboard-header">
            <AgentInfo agent={agent} status={status} />
            <button 
              onClick={handleLogout} 
              className="logout-btn"
              aria-label="Logout"
            >
              Logout
            </button>
          </div>
          
          <StatusPanel 
            currentStatus={status} 
            onStatusChange={handleStatusChange}
            disabled={connectionStatus !== 'connected'}
          />
          
          <MessagePanel 
            messages={messages}
            agentCode={agent?.agentCode}
            loading={loadingMessages}
          />
        </div>
      )}
    </div>
  );
}

export default App;
```

### 📄 src/components/ErrorBoundary.js

```javascript
import React from 'react';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { 
      hasError: false, 
      error: null,
      errorInfo: null
    };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    console.error('ErrorBoundary caught an error:', error, errorInfo);
    this.setState({
      error,
      errorInfo
    });
  }

  handleReload = () => {
    window.location.reload();
  };

  handleReset = () => {
    this.setState({
      hasError: false,
      error: null,
      errorInfo: null
    });
  };

  render() {
    if (this.state.hasError) {
      return (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          padding: '20px'
        }}>
          <div style={{
            background: 'white',
            padding: '40px',
            borderRadius: '16px',
            maxWidth: '500px',
            width: '100%',
            textAlign: 'center',
            boxShadow: '0 10px 40px rgba(0,0,0,0.2)'
          }}>
            <div style={{ fontSize: '48px', marginBottom: '20px' }}>
              ⚠️
            </div>
            
            <h2 style={{ 
              margin: '0 0 16px 0',
              color: '#333',
              fontSize: '24px'
            }}>
              Something went wrong
            </h2>
            
            <p style={{ 
              color: '#666', 
              fontSize: '14px',
              marginBottom: '24px',
              lineHeight: '1.6'
            }}>
              The application encountered an unexpected error. 
              Please try reloading the application.
            </p>
            
            {this.state.error && (
              <details style={{
                marginBottom: '24px',
                textAlign: 'left',
                background: '#f5f5f5',
                padding: '12px',
                borderRadius: '8px',
                fontSize: '12px',
                maxHeight: '150px',
                overflow: 'auto'
              }}>
                <summary style={{ 
                  cursor: 'pointer',
                  fontWeight: '600',
                  marginBottom: '8px',
                  color: '#666'
                }}>
                  Error Details
                </summary>
                <pre style={{ 
                  margin: 0,
                  whiteSpace: 'pre-wrap',
                  wordBreak: 'break-word',
                  color: '#d32f2f'
                }}>
                  {this.state.error.toString()}
                  {this.state.errorInfo && this.state.errorInfo.componentStack}
                </pre>
              </details>
            )}
            
            <div style={{
              display: 'flex',
              gap: '12px',
              justifyContent: 'center'
            }}>
              <button 
                onClick={this.handleReload}
                style={{
                  padding: '12px 24px',
                  background: '#667eea',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                Reload Application
              </button>
              
              <button 
                onClick={this.handleReset}
                style={{
                  padding: '12px 24px',
                  background: '#f0f0f0',
                  color: '#333',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer'
                }}
              >
                Try Again
              </button>
            </div>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;
```

### 📄 src/components/LoginForm.js

```javascript
import React, { useState, useEffect } from 'react';
import { loginAgent, checkServerHealth } from '../services/api';
import { validateAgentCode } from '../utils/validation';

function LoginForm({ onLogin }) {
  const [agentCode, setAgentCode] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [serverStatus, setServerStatus] = useState('unknown');

  useEffect(() => {
    checkHealth();
  }, []);

  const checkHealth = async () => {
    try {
      await checkServerHealth();
      setServerStatus('online');
    } catch (error) {
      setServerStatus('offline');
      setError('Backend server is not running. Please start the server first.');
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    
    const validationError = validateAgentCode(agentCode);
    if (validationError) {
      setError(validationError);
      return;
    }

    setLoading(true);
    setError('');

    try {
      const result = await loginAgent(agentCode.toUpperCase());
      
      if (result.success) {
        onLogin(result.data.user, result.data.token);
      } else {
        setError(result.error || 'Login failed');
      }
    } catch (err) {
      console.error('Login error:', err);
      
      if (err.message.includes('fetch')) {
        setError('Cannot connect to server. Please check if backend is running.');
        setServerStatus('offline');
      } else {
        setError(err.message || 'Network error. Please check your connection.');
      }
    } finally {
      setLoading(false);
    }
  };

  const handleRetry = () => {
    setError('');
    checkHealth();
  };

  return (
    <div className="login-container">
      <div className="login-form">
        <div className="login-header">
          <h2>Agent Login</h2>
          <p>Enter your agent code to continue</p>
          
          <div className={`server-status ${serverStatus}`}>
            <span className="status-dot"></span>
            <span>Server: {serverStatus}</span>
          </div>
        </div>
        
        <form onSubmit={handleSubmit}>
          <div className="form-group">
            <label htmlFor="agentCode">Agent Code</label>
            <input
              id="agentCode"
              type="text"
              placeholder="e.g., AG001"
              value={agentCode}
              onChange={(e) => {
                setAgentCode(e.target.value.toUpperCase());
                if (error) setError('');
              }}
              disabled={loading || serverStatus === 'offline'}
              maxLength={5}
              autoFocus
            />
          </div>
          
          <button 
            type="submit" 
            disabled={loading || !agentCode.trim() || serverStatus === 'offline'}
            className="login-btn"
          >
            {loading ? 'Signing in...' : 'Sign In'}
          </button>
          
          {error && (
            <div className="error-message">
              <span>⚠️</span> {error}
              {serverStatus === 'offline' && (
                <button 
                  type="button" 
                  onClick={handleRetry} 
                  className="retry-btn"
                >
                  Retry Connection
                </button>
              )}
            </div>
          )}
        </form>
        
        <div className="login-footer">
          <p>Sample codes: AG001, AG002, AG003</p>
          <p className="help-text">
            Need help? Check if backend server is running on port 3001
          </p>
        </div>
      </div>
    </div>
  );
}

export default LoginForm;
```

### 📄 src/components/AgentInfo.js

```javascript
import React from 'react';

function AgentInfo({ agent, status }) {
  if (!agent) return null;

  const getStatusColor = (status) => {
    const colors = {
      Available: '#4CAF50',
      Busy: '#FF9800',
      Break: '#2196F3',
      Offline: '#9E9E9E'
    };
    return colors[status] || colors.Offline;
  };

  return (
    <div className="agent-info">
      <div className="agent-avatar">
        <span>👤</span>
      </div>
      
      <div className="agent-details">
        <h3 className="agent-name">{agent.agentName}</h3>
        
        <div className="agent-meta">
          <div className="agent-code">
            <span className="label">Code:</span>
            <span className="value">{agent.agentCode}</span>
          </div>
          
          <div className="agent-team">
            <span className="label">Team:</span>
            <span className="value">{agent.teamName || 'N/A'}</span>
          </div>
        </div>
        
        <div className="agent-status">
          <span 
            className="status-dot"
            style={{ backgroundColor: getStatusColor(status) }}
          ></span>
          <span className="status-text">{status}</span>
        </div>
      </div>
    </div>
  );
}

export default AgentInfo;
```

### 📄 src/components/StatusPanel.js

```javascript
import React from 'react';

function StatusPanel({ currentStatus, onStatusChange, disabled = false }) {
  const statuses = [
    { key: 'Available', label: 'Available', color: '#4CAF50', icon: '✓' },
    { key: 'Busy', label: 'Busy', color: '#FF9800', icon: '⏱' },
    { key: 'Break', label: 'Break', color: '#2196F3', icon: '☕' },
    { key: 'Offline', label: 'Offline', color: '#9E9E9E', icon: '⏸' }
  ];

  return (
    <div className="status-panel">
      <div className="status-header">
        <h3>Status Control</h3>
        <div className="current-status">
          Current: <span className="status-badge" style={{ 
            backgroundColor: statuses.find(s => s.key === currentStatus)?.color 
          }}>
            {currentStatus}
          </span>
        </div>
      </div>
      
      <div className="status-buttons">
        {statuses.map(status => (
          <button
            key={status.key}
            className={`status-btn ${status.key === currentStatus ? 'active' : ''}`}
            onClick={() => onStatusChange(status.key)}
            disabled={disabled}
            style={{ 
              backgroundColor: status.color,
              opacity: disabled ? 0.5 : (status.key === currentStatus ? 1 : 0.8)
            }}
          >
            <span className="status-icon">{status.icon}</span>
            <span className="status-label">{status.label}</span>
          </button>
        ))}
      </div>
      
      {disabled && (
        <div className="status-warning">
          ⚠️ Not connected to server - Status updates unavailable
        </div>
      )}
    </div>
  );
}

export default StatusPanel;
```

### 📄 src/components/MessagePanel.js

```javascript
import React, { useEffect, useRef, useState } from 'react';
import { formatTime, getTimeAgo } from '../utils/dateUtils';
import { markMessageAsRead } from '../services/api';

function MessagePanel({ messages, agentCode, loading = false }) {
  const messagesEndRef = useRef(null);
  const [markingRead, setMarkingRead] = useState(new Set());

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const handleMarkAsRead = async (messageId) => {
    if (markingRead.has(messageId)) return;

    setMarkingRead(prev => new Set(prev).add(messageId));

    try {
      await markMessageAsRead(messageId);
      console.log('Message marked as read:', messageId);
    } catch (error) {
      console.error('Failed to mark message as read:', error);
    } finally {
      setMarkingRead(prev => {
        const newSet = new Set(prev);
        newSet.delete(messageId);
        return newSet;
      });
    }
  };

  const getPriorityColor = (priority) => {
    const colors = {
      high: '#f44336',
      normal: '#2196f3',
      low: '#9e9e9e'
    };
    return colors[priority] || colors.normal;
  };

  const unreadCount = messages.filter(m => !m.isRead).length;

  return (
    <div className="message-panel">
      <div className="message-header">
        <h3>
          Messages ({messages.length})
          {unreadCount > 0 && (
            <span className="unread-badge">{unreadCount} unread</span>
          )}
        </h3>
        
        {messages.length > 0 && (
          <button 
            onClick={scrollToBottom}
            className="scroll-btn"
            title="Scroll to bottom"
          >
            ⬇️
          </button>
        )}
      </div>
      
      <div className="message-list">
        {loading ? (
          <div className="loading-messages">
            <div className="loading-spinner"></div>
            <p>Loading messages...</p>
          </div>
        ) : messages.length === 0 ? (
          <div className="no-messages">
            <div className="no-messages-icon">📭</div>
            <p>No messages yet</p>
            <small>Messages from supervisors will appear here</small>
          </div>
        ) : (
          <>
            {messages.map((message, index) => (
              <div 
                key={message._id || index}
                className={`message-item ${message.type} ${message.isRead ? 'read' : 'unread'}`}
              >
                <div className="message-top">
                  <div className="message-from">
                    <span className="from-label">From:</span>
                    <strong>{message.fromCode}</strong>
                  </div>
                  <div className="message-priority">
                    <span 
                      className="priority-indicator"
                      style={{ backgroundColor: getPriorityColor(message.priority) }}
                      title={`Priority: ${message.priority}`}
                    >
                      {message.priority === 'high' ? '🔴' : 
                       message.priority === 'low' ? '🔵' : '⚪'}
                    </span>
                  </div>
                </div>
                
                <div className="message-content">
                  {message.content}
                </div>
                
                <div className="message-footer">
                  <div className="message-meta">
                    <span className="message-type">
                      {message.type === 'broadcast' ? '📢 Broadcast' : '💬 Direct'}
                    </span>
                    <span className="message-time">
                      {formatTime(message.timestamp)}
                    </span>
                    <span className="time-ago">
                      {getTimeAgo(message.timestamp)}
                    </span>
                  </div>
                  
                  {!message.isRead && (
                    <button
                      className="mark-read-btn"
                      onClick={() => handleMarkAsRead(message._id)}
                      disabled={markingRead.has(message._id)}
                      title="Mark as read"
                    >
                      {markingRead.has(message._id) ? '⏳' : '✓'}
                    </button>
                  )}
                </div>
              </div>
            ))}
            <div ref={messagesEndRef} />
          </>
        )}
      </div>
    </div>
  );
}

export default MessagePanel;
```

---

## Services

### 📄 src/services/api.js

```javascript
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';
let authToken = null;

export const setAuthToken = (token) => {
  authToken = token;
  console.log('Auth token set');
};

export const clearAuthToken = () => {
  authToken = null;
  console.log('Auth token cleared');
};

export const getAuthToken = () => authToken;

export const loginAgent = async (agentCode) => {
  try {
    const response = await fetch(`${API_BASE_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ agentCode })
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Login failed');
    }
    
    if (data.data?.token) {
      setAuthToken(data.data.token);
    }
    
    return data;
  } catch (error) {
    console.error('Login API Error:', error);
    throw error;
  }
};

export const logoutAgent = async () => {
  try {
    const response = await fetch(`${API_BASE_URL}/auth/logout`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      }
    });

    const data = await response.json();
    clearAuthToken();
    return data;
  } catch (error) {
    console.error('Logout API Error:', error);
    clearAuthToken();
    throw error;
  }
};

export const getMessages = async (agentCode, limit = 50, unreadOnly = false) => {
  try {
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    const url = `${API_BASE_URL}/messages/agent/${agentCode}?limit=${limit}&unreadOnly=${unreadOnly}`;
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${authToken}`
      }
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to get messages');
    }
    
    return data;
  } catch (error) {
    console.error('Get Messages API Error:', error);
    throw error;
  }
};

export const markMessageAsRead = async (messageId) => {
  try {
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    const response = await fetch(`${API_BASE_URL}/messages/${messageId}/read`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${authToken}`
      }
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to mark message as read');
    }
    
    return data;
  } catch (error) {
    console.error('Mark Read API Error:', error);
    throw error;
  }
};

export const updateAgentStatus = async (agentCode, status) => {
  try {
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    const response = await fetch(`${API_BASE_URL}/agents/${agentCode}/status`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      },
      body: JSON.stringify({ status })
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to update status');
    }
    
    return data;
  } catch (error) {
    console.error('Update Status API Error:', error);
    throw error;
  }
};

export const getStatusHistory = async (agentCode, limit = 50) => {
  try {
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    const response = await fetch(`${API_BASE_URL}/agents/${agentCode}/history?limit=${limit}`, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${authToken}`
      }
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to get status history');
    }
    
    return data;
  } catch (error) {
    console.error('Get Status History API Error:', error);
    throw error;
  }
};

export const checkServerHealth = async () => {
  try {
    const response = await fetch(`${API_BASE_URL.replace('/api', '')}/health`, {
      method: 'GET'
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error('Server health check failed');
    }
    
    return data;
  } catch (error) {
    console.error('Health Check Error:', error);
    throw error;
  }
};
```

### 📄 src/services/socket.js

```javascript
import io from 'socket.io-client';

const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';
let socket = null;

export const connectSocket = (agentCode) => {
  if (socket) disconnectSocket();

  console.log('Connecting to WebSocket...', SOCKET_URL);

  socket = io(SOCKET_URL, {
    query: { 
      agentCode: agentCode.toUpperCase(), 
      type: 'agent' 
    },
    timeout: 20000,
    reconnection: true,
    reconnectionAttempts: 5,
    reconnectionDelay: 1000,
    reconnectionDelayMax: 5000
  });

  socket.on('connect', () => {
    console.log('WebSocket connected:', socket.id);
    socket.emit('agent_connect', { agentCode: agentCode.toUpperCase() });
  });

  socket.on('disconnect', (reason) => {
    console.log('WebSocket disconnected:', reason);
  });

  socket.on('connect_error', (error) => {
    console.error('WebSocket connection error:', error);
  });

  socket.on('reconnect', (attemptNumber) => {
    console.log('WebSocket reconnected after', attemptNumber, 'attempts');
  });

  socket.on('reconnect_error', (error) => {
    console.error('WebSocket reconnection error:', error);
  });

  socket.on('reconnect_failed', () => {
    console.error('WebSocket reconnection failed after all attempts');
  });

  socket.on('connection_error', (error) => {
    console.error('Connection error from server:', error);
  });

  socket.on('status_error', (error) => {
    console.error('Status update error from server:', error);
  });

  socket.on('message_error', (error) => {
    console.error('Message error from server:', error);
  });

  window.socket = socket;
  return socket;
};

export const disconnectSocket = () => {
  if (socket) {
    console.log('Disconnecting WebSocket...');
    socket.disconnect();
    socket = null;
    window.socket = null;
  }
};

export const sendStatusUpdate = (agentCode, status) => {
  if (socket && socket.connected) {
    console.log('Sending status update via WebSocket:', { agentCode, status });
    socket.emit('update_status', {
      agentCode: agentCode.toUpperCase(),
      status: status
    });
    return true;
  }
  console.warn('Socket not connected, cannot send status update');
  return false;
};

export const isSocketConnected = () => {
  return socket && socket.connected;
};

export const getSocket = () => socket;
```

### 📄 src/services/notifications.js

```javascript
export const showDesktopNotification = async (title, body) => {
  try {
    if (window.electronAPI && window.electronAPI.showNotification) {
      await window.electronAPI.showNotification(title, body);
      return;
    }
    
    if ('Notification' in window && Notification.permission === 'granted') {
      new Notification(title, {
        body,
        icon: '/assets/icon.png',
        badge: '/assets/tray-icon.png'
      });
    }
  } catch (error) {
    console.error('Notification error:', error);
  }
};

export const requestNotificationPermission = async () => {
  if ('Notification' in window && Notification.permission === 'default') {
    const permission = await Notification.requestPermission();
    console.log('Notification permission:', permission);
    return permission;
  }
  return Notification.permission;
};
```

---

## Utilities

### 📄 src/utils/logger.js

```javascript
const isDev = process.env.NODE_ENV === 'development';

export const logger = {
  log: (...args) => {
    if (isDev) {
      console.log('[LOG]', ...args);
    }
  },
  
  info: (...args) => {
    if (isDev) {
      console.info('[INFO]', ...args);
    }
  },
  
  warn: (...args) => {
    if (isDev) {
      console.warn('[WARN]', ...args);
    }
  },
  
  error: (...args) => {
    console.error('[ERROR]', ...args);
  },
  
  debug: (...args) => {
    if (isDev) {
      console.debug('[DEBUG]', ...args);
    }
  }
};

export default logger;
```

### 📄 src/utils/validation.js

```javascript
export const validateAgentCode = (code) => {
  if (!code) {
    return 'Agent code is required';
  }
  
  const trimmed = code.trim().toUpperCase();
  
  if (trimmed.length === 0) {
    return 'Agent code cannot be empty';
  }
  
  if (!/^[A-Z]{2}\d{3}$/.test(trimmed)) {
    return 'Agent code must be in format: AG001 or SP001';
  }
  
  return null;
};

export const validateMessage = (content) => {
  if (!content || content.trim().length === 0) {
    return 'Message cannot be empty';
  }
  
  if (content.length > 500) {
    return 'Message is too long (max 500 characters)';
  }
  
  return null;
};
```

### 📄 src/utils/dateUtils.js

```javascript
export const formatTime = (timestamp) => {
  try {
    return new Date(timestamp).toLocaleTimeString('en-US', {
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    });
  } catch {
    return '--:--';
  }
};

export const formatDateTime = (timestamp) => {
  try {
    return new Date(timestamp).toLocaleString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    });
  } catch {
    return 'Invalid date';
  }
};

export const getTimeAgo = (timestamp) => {
  try {
    const now = new Date();
    const time = new Date(timestamp);
    const diffInSeconds = Math.floor((now - time) / 1000);
    
    if (diffInSeconds < 60) {
      return 'just now';
    }
    
    const diffInMinutes = Math.floor(diffInSeconds / 60);
    if (diffInMinutes < 60) {
      return `${diffInMinutes}m ago`;
    }
    
    const diffInHours = Math.floor(diffInMinutes / 60);
    if (diffInHours < 24) {
      return `${diffInHours}h ago`;
    }
    
    const diffInDays = Math.floor(diffInHours / 24);
    if (diffInDays < 7) {
      return `${diffInDays}d ago`;
    }
    
    const diffInWeeks = Math.floor(diffInDays / 7);
    return `${diffInWeeks}w ago`;
  } catch {
    return 'unknown';
  }
};

export const getDuration = (start, end) => {
  try {
    const startTime = new Date(start);
    const endTime = new Date(end);
    return Math.floor((endTime - startTime) / 1000);
  } catch {
    return 0;
  }
};
```

---

## Styles

### 📄 src/styles/App.css

เนื่องจากไฟล์ยาว ขอแบ่งเป็น 2 ส่วน

**Part 1:**

```css
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.app {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  max-width: 400px;
  margin: 0 auto;
  background: #f5f5f5;
  min-height: 100vh;
}

/* Connection Status */
.connection-status {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  font-size: 12px;
  font-weight: 500;
  color: white;
}

.connection-status.connected { background: #4caf50; }
.connection-status.disconnected { background: #9e9e9e; }
.connection-status.error { background: #f44336; }

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Error Banner */
.error-banner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f44336;
  color: white;
  padding: 12px 16px;
  font-size: 14px;
}

.error-close {
  background: none;
  border: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
  border-radius: 50%;
  width: 24px;
  height: 24px;
}

.error-close:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* Login */
.login-container {
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-form {
  background: white;
  padding: 40px 30px;
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  width: 100%;
  max-width: 320px;
}

.login-header {
  text-align: center;
  margin-bottom: 30px;
}

.login-header h2 {
  margin: 0 0 8px 0;
  color: #333;
  font-size: 24px;
}

.login-header p {
  color: #666;
  font-size: 14px;
}

/* Server Status */
.server-status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  margin-top: 12px;
  text-transform: uppercase;
}

.server-status.online {
  background: #e8f5e9;
  color: #2e7d32;
}

.server-status.offline {
  background: #ffebee;
  color: #c62828;
}

.server-status.unknown {
  background: #fff3e0;
  color: #f57c00;
}

.server-status .status-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: currentColor;
  animation: blink 2s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* Form */
.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #333;
  font-size: 14px;
}

.form-group input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 16px;
  font-family: monospace;
  letter-spacing: 1px;
}

.form-group input:focus {
  outline: none;
  border-color: #667eea;
}

.form-group input:disabled {
  background: #f5f5f5;
  cursor: not-allowed;
}

/* Buttons */
.login-btn {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
}

.login-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.login-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* Error Message */
.error-message {
  margin-top: 16px;
  padding: 12px;
  background: #ffebee;
  border: 1px solid #ffcdd2;
  border-radius: 8px;
  color: #c62828;
  font-size: 13px;
}

.retry-btn {
  margin-top: 8px;
  padding: 6px 12px;
  background: #c62828;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  width: 100%;
}

/* Login Footer */
.login-footer {
  margin-top: 20px;
  text-align: center;
}

.login-footer p {
  color: #999;
  font-size: 12px;
  margin: 6px 0;
}

.help-text {
  color: #666 !important;
  font-size: 11px !important;
}

/* Dashboard */
.dashboard {
  background: white;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e0e0e0;
}

.logout-btn {
  background: #f44336;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
}

.logout-btn:hover {
  background: #d32f2f;
  transform: translateY(-1px);
}

/* Loading */
.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
```

### 📄 src/styles/components.css

```css
/* Agent Info */
.agent-info {
  display: flex;
  gap: 12px;
  flex: 1;
}

.agent-avatar {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
}

.agent-details {
  flex: 1;
  min-width: 0;
}

.agent-name {
  margin: 0 0 4px 0;
  font-size: 16px;
  font-weight: 600;
  color: #333;
}

.agent-meta {
  display: flex;
  gap: 16px;
  margin-bottom: 6px;
  font-size: 12px;
  color: #666;
}

.agent-meta > div {
  display: flex;
  gap: 4px;
}

.agent-meta .label {
  font-weight: 500;
}

.agent-meta .value {
  font-weight: 600;
  color: #333;
}

.agent-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
}

.agent-status .status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.agent-status .status-text {
  font-weight: 600;
}

/* Status Panel */
.status-panel {
  padding: 20px;
  border-bottom: 1px solid #e0e0e0;
  background: #fafafa;
}

.status-header h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: 600;
  color: #333;
}

.current-status {
  font-size: 13px;
  color: #666;
}

.status-badge {
  padding: 4px 10px;
  border-radius: 12px;
  color: white;
  font-size: 12px;
  font-weight: 600;
  margin-left: 6px;
}

.status-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 12px;
}

.status-btn {
  padding: 16px 12px;
  border: none;
  border-radius: 10px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.status-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.status-btn.active {
  box-shadow: 0 0 0 3px rgba(255,255,255,0.5);
  transform: scale(1.05);
}

.status-btn:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

.status-icon {
  font-size: 18px;
}

.status-label {
  font-size: 13px;
}

.status-warning {
  margin-top: 12px;
  padding: 10px;
  background: #fff3cd;
  border: 1px solid #ffc107;
  border-radius: 8px;
  color: #856404;
  font-size: 12px;
  text-align: center;
}

/* Message Panel */
.message-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.message-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e0e0e0;
}

.message-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
}

.unread-badge {
  background: #f44336;
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 600;
}

.scroll-btn {
  background: #f0f0f0;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  cursor: pointer;
}

.scroll-btn:hover {
  background: #e0e0e0;
  transform: scale(1.1);
}

.message-list {
  flex: 1;
  overflow-y: auto;
  padding: 16px 20px;
  background: #fafafa;
}

.message-list::-webkit-scrollbar {
  width: 6px;
}

.message-list::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.message-list::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 3px;
}

/* Loading Messages */
.loading-messages {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40px 20px;
  color: #999;
}

/* No Messages */
.no-messages {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 60px 20px;
  color: #999;
  text-align: center;
}

.no-messages-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.no-messages p {
  font-size: 16px;
  margin: 8px 0;
  font-weight: 500;
}

.no-messages small {
  font-size: 13px;
  color: #bbb;
}

/* Message Item */
.message-item {
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 12px;
  animation: messageSlideIn 0.3s ease-out;
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message-item.unread {
  border-left: 4px solid #2196f3;
  background: #e3f2fd;
}

.message-item.broadcast {
  border-left: 4px solid #ff9800;
}

.message-item.broadcast.unread {
  background: #fff8e1;
}

.message-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.message-top {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}

.message-from {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: #666;
}

.message-from strong {
  color: #333;
  font-weight: 600;
}

.message-priority {
  display: flex;
  align-items: center;
}

.priority-indicator {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
}

.message-content {
  color: #333;
  font-size: 14px;
  line-height: 1.5;
  margin-bottom: 10px;
  word-wrap: break-word;
}

.message-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.message-meta {
  display: flex;
  gap: 10px;
  font-size: 11px;
  color: #999;
}

.message-type {
  padding: 2px 6px;
  background: #f5f5f5;
  border-radius: 4px;
  font-weight: 500;
}

.message-time {
  font-weight: 500;
}

.time-ago {
  color: #bbb;
}

.mark-read-btn {
  background: #4caf50;
  color: white;
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  cursor: pointer;
  font-size: 14px;
}

.mark-read-btn:hover:not(:disabled) {
  background: #45a049;
  transform: scale(1.1);
}

.mark-read-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* Responsive */
@media (max-width: 350px) {
  .status-buttons {
    grid-template-columns: 1fr;
  }
  
  .agent-meta {
    flex-direction: column;
    gap: 4px;
  }
}
```

---

## Testing & Running

### การเริ่มต้นใช้งาน

```bash
# 1. สร้าง .env
cp .env.example .env

# 2. สร้าง icons
mkdir -p public/assets
curl -L -o public/assets/icon.png "https://placehold.co/256x256/667eea/FFFFFF.png?text=Agent"
curl -L -o public/assets/tray-icon.png "https://placehold.co/32x32/667eea/FFFFFF.png?text=A"

# 3. เริ่ม Backend (Terminal 1)
cd ../backend-server
npm run dev

# 4. เริ่ม Agent App (Terminal 2)
cd agent-desktop
npm run electron-dev
```

### ทดสอบการทำงาน

**Test Login:**
- Agent Code: `AG001`
- ควรเห็น Dashboard พร้อม status buttons

**Test Status Change:**
- คลิก status button ต่างๆ
- ตรวจสอบ console logs

**Test Messages:**
- ใช้ Postman ส่งข้อความ
- ควรเห็นข้อความปรากฏและได้รับ notification

---

## Checklist สุดท้าย

- [ ] package.json มี scripts ครบ
- [ ] .env สร้างแล้ว
- [ ] Icon files สร้างแล้ว
- [ ] ทุกไฟล์ component มี export default
- [ ] ทุก service มี export functions
- [ ] Backend running บน port 3001
- [ ] MongoDB service running
- [ ] SQLite database มีข้อมูล

---
