# Agent Desktop App V3.2 - Complete Documentation

## üìö ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏´‡∏•‡∏±‡∏Å

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°](#section-1)
2. [‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞ Configuration](#section-2)
3. [Electron Core Files](#section-3)
4. [React Application Structure](#section-4)
5. [Components ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î](#section-5)
6. [Services Layer](#section-6)
7. [Utilities ‡πÅ‡∏•‡∏∞ Helpers](#section-7)
8. [Styling System](#section-8)
9. [Testing ‡πÅ‡∏•‡∏∞ Debugging](#section-9)

---

<a name="section-1"></a>
# Section 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°

## 1.1 ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ

**Agent Desktop Application V3.2** ‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Agent ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Call Center ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢:
- **Electron.js** - ‡∏™‡∏£‡πâ‡∏≤‡∏á Desktop Application
- **React** - UI Framework
- **Socket.io-client** - Real-time communication
- **REST API** - HTTP Communication

### ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
‡πÉ‡∏´‡πâ Agent ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:
1. Login ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Agent Code
2. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Available, Busy, Break, Offline)
3. ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å Supervisor ‡πÅ‡∏ö‡∏ö real-time
4. ‡∏î‡∏π Message History
5. ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö Desktop Notifications

## 1.2 ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏∞‡∏ö‡∏ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Agent Desktop Application         ‚îÇ
‚îÇ            (Electron + React)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ   Electron   ‚îÇ   ‚îÇ    React     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Main Process‚îÇ   ‚îÇ   Renderer   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ   (Node.js)  ‚îÇ   ‚îÇ   Process    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ          ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                    ‚îÇ                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ           ‚îÇ           ‚îÇ
         ‚ñº           ‚ñº           ‚ñº
    REST API    WebSocket    Notifications
         ‚îÇ           ‚îÇ           ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ   Backend Server      ‚îÇ
         ‚îÇ  (Express + Socket.io)‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº
    SQLite DB              MongoDB
  (Master Data)        (Real-time Data)
```

## 1.3 ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå

```
agent-desktop/
‚îÇ
‚îú‚îÄ‚îÄ üì¶ Configuration Files
‚îÇ   ‚îú‚îÄ‚îÄ package.json          # Dependencies ‡πÅ‡∏•‡∏∞ scripts
‚îÇ   ‚îú‚îÄ‚îÄ .env.example          # Environment variables template
‚îÇ   ‚îî‚îÄ‚îÄ .gitignore            # Git ignore rules
‚îÇ
‚îú‚îÄ‚îÄ ‚ö° Electron Files
‚îÇ   ‚îú‚îÄ‚îÄ main.js               # Electron main process (Node.js)
‚îÇ   ‚îî‚îÄ‚îÄ preload.js            # Security bridge between main/renderer
‚îÇ
‚îú‚îÄ‚îÄ üìÑ HTML Template
‚îÇ   ‚îî‚îÄ‚îÄ public/
‚îÇ       ‚îú‚îÄ‚îÄ index.html        # Main HTML template
‚îÇ       ‚îî‚îÄ‚îÄ assets/           # Icons and static assets
‚îÇ
‚îî‚îÄ‚îÄ ‚öõÔ∏è React Application
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ index.js          # React entry point
        ‚îú‚îÄ‚îÄ App.js            # Main application component
        ‚îÇ
        ‚îú‚îÄ‚îÄ components/       # UI Components
        ‚îÇ   ‚îú‚îÄ‚îÄ ErrorBoundary.js
        ‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.js
        ‚îÇ   ‚îú‚îÄ‚îÄ AgentInfo.js
        ‚îÇ   ‚îú‚îÄ‚îÄ StatusPanel.js
        ‚îÇ   ‚îî‚îÄ‚îÄ MessagePanel.js
        ‚îÇ
        ‚îú‚îÄ‚îÄ services/         # External communications
        ‚îÇ   ‚îú‚îÄ‚îÄ api.js        # REST API calls
        ‚îÇ   ‚îú‚îÄ‚îÄ socket.js     # WebSocket management
        ‚îÇ   ‚îî‚îÄ‚îÄ notifications.js
        ‚îÇ
        ‚îú‚îÄ‚îÄ utils/            # Helper functions
        ‚îÇ   ‚îú‚îÄ‚îÄ logger.js
        ‚îÇ   ‚îú‚îÄ‚îÄ validation.js
        ‚îÇ   ‚îî‚îÄ‚îÄ dateUtils.js
        ‚îÇ
        ‚îî‚îÄ‚îÄ styles/           # CSS files
            ‚îú‚îÄ‚îÄ App.css
            ‚îî‚îÄ‚îÄ components.css
```

## 1.4 Data Flow (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)

### 1.4.1 Login Flow
```
User ‚Üí LoginForm ‚Üí api.loginAgent() ‚Üí Backend /auth/login
                                    ‚Üì
                              Verify Agent Code in SQLite
                                    ‚Üì
                              Generate JWT Token
                                    ‚Üì
Frontend ‚Üê Token + User Data ‚Üê Backend Response
    ‚Üì
Store Token ‚Üí Load Messages ‚Üí Connect WebSocket
```

### 1.4.2 Status Update Flow
```
User Click Status ‚Üí handleStatusChange()
                           ‚Üì
                    Try WebSocket First
                    (sendStatusUpdate)
                           ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ             ‚îÇ
              Success?          Failed?
                    ‚îÇ             ‚îÇ
                    ‚Üì             ‚Üì
              Broadcast to   HTTP Fallback
              Supervisors    (updateAgentStatus)
                    ‚îÇ             ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚Üì
                    Save to MongoDB
                    (agent_status collection)
```

### 1.4.3 Message Reception Flow
```
Supervisor sends message ‚Üí Backend saves to MongoDB
                                    ‚Üì
                          Emit 'new_message' via WebSocket
                                    ‚Üì
                          Agent receives event
                                    ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                               ‚îÇ
            Update UI State                  Show Notification
            (Add to messages array)          (Desktop notification)
```

## 1.5 Key Technologies ‡πÅ‡∏•‡∏∞‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ

| Technology | Purpose | Why? |
|------------|---------|------|
| **Electron** | Desktop App Framework | ‡πÉ‡∏´‡πâ Web App ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô Native Desktop App |
| **React** | UI Framework | Component-based, Easy state management |
| **Socket.io** | WebSocket Library | Real-time bidirectional communication |
| **JWT** | Authentication | Stateless, Secure token-based auth |
| **CSS Modules** | Styling | Scoped styles, No conflicts |

## 1.6 Security Considerations

### Context Isolation
```javascript
// preload.js - Bridge ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Node.js ‡πÅ‡∏•‡∏∞ Browser
// ‡πÉ‡∏ä‡πâ contextBridge ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô direct access ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Node.js APIs
contextBridge.exposeInMainWorld('electronAPI', {
  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ API ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  showNotification: (title, body) => { ... }
});
```

### Token Management
```javascript
// api.js - ‡πÄ‡∏Å‡πá‡∏ö token ‡πÉ‡∏ô memory (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà localStorage)
let authToken = null; // In-memory storage

// ‡∏™‡πà‡∏á token ‡∏ú‡πà‡∏≤‡∏ô Authorization header
headers: {
  'Authorization': `Bearer ${authToken}`
}
```

---

<a name="section-2"></a>
# Section 2: ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞ Configuration

## 2.1 System Requirements

### ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
- **Node.js**: v18.0.0 ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤
- **npm**: v8.0.0 ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤
- **RAM**: 2GB ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
- **Disk Space**: 500MB ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö dependencies
- **OS**: Windows 10+, macOS 10.13+, Linux (Ubuntu 18.04+)

### Backend Requirements
- Backend Server ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô `http://localhost:3001`
- MongoDB service ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- SQLite database ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• sample agents

## 2.2 ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å

### Step 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ

```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á folder ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
mkdir agent-desktop
cd agent-desktop

# Initialize npm project
npm init -y
```

### Step 2: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Dependencies

```bash
# Production Dependencies
npm install react@18.2.0 react-dom@18.2.0 react-scripts@5.0.1
npm install socket.io-client@4.7.2
npm install dotenv@16.3.1

# Development Dependencies
npm install --save-dev electron@28.0.0
npm install --save-dev concurrently@8.2.0
npm install --save-dev wait-on@7.0.1
npm install --save-dev electron-builder@24.6.3
```

**‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ Dependencies:**

| Package | Version | Purpose |
|---------|---------|---------|
| `react` | 18.2.0 | Core React library |
| `react-dom` | 18.2.0 | React DOM renderer |
| `react-scripts` | 5.0.1 | Create React App scripts |
| `socket.io-client` | 4.7.2 | WebSocket client library |
| `dotenv` | 16.3.1 | Environment variables loader |
| `electron` | 28.0.0 | Desktop app framework |
| `concurrently` | 8.2.0 | Run multiple commands simultaneously |
| `wait-on` | 7.0.1 | Wait for resources (HTTP/files) |
| `electron-builder` | 24.6.3 | Build and package Electron apps |

### Step 3: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Folders

```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á folder structure
mkdir -p public/assets
mkdir -p src/components
mkdir -p src/services
mkdir -p src/utils
mkdir -p src/styles
```

## 2.3 Configuration Files

### üìÑ package.json (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢)

```json
{
  "name": "agent-wallboard-desktop",
  "version": "3.2.0",
  "description": "Agent Desktop Application - Complete with Comments",
  "main": "main.js",
  "homepage": "./",
  "author": "Your Name",
  "license": "MIT",
  
  "scripts": {
    // Development Scripts
    "start": "react-scripts start",
    // ‡πÄ‡∏£‡∏¥‡πà‡∏° React development server ‡∏ö‡∏ô port 3000
    
    "build": "react-scripts build",
    // Build production-ready React app
    
    "electron": "electron .",
    // ‡∏£‡∏±‡∏ô Electron ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡∏ï‡πâ‡∏≠‡∏á build React ‡∏Å‡πà‡∏≠‡∏ô)
    
    "electron-dev": "concurrently \"npm start\" \"wait-on http://localhost:3000 && electron .\"",
    // Development mode: ‡∏£‡∏±‡∏ô React ‡πÅ‡∏•‡∏∞ Electron ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
    // 1. npm start - ‡πÄ‡∏£‡∏¥‡πà‡∏° React dev server
    // 2. wait-on - ‡∏£‡∏≠‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤ React ‡∏à‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°
    // 3. electron . - ‡πÄ‡∏£‡∏¥‡πà‡∏° Electron
    
    // Production Build Scripts
    "dist": "npm run build && electron-builder",
    // Build ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OS ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    
    "dist:win": "npm run build && electron-builder --win",
    // Build ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Windows (.exe)
    
    "dist:mac": "npm run build && electron-builder --mac",
    // Build ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö macOS (.dmg)
    
    "dist:linux": "npm run build && electron-builder --linux",
    // Build ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Linux (.AppImage, .deb)
    
    "postinstall": "electron-builder install-app-deps"
    // ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á native dependencies ‡∏´‡∏•‡∏±‡∏á npm install
  },
  
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-scripts": "5.0.1",
    "socket.io-client": "^4.7.2",
    "dotenv": "^16.3.1"
  },
  
  "devDependencies": {
    "electron": "^28.0.0",
    "concurrently": "^8.2.0",
    "wait-on": "^7.0.1",
    "electron-builder": "^24.6.3"
  },
  
  // Electron Builder Configuration
  "build": {
    "appId": "com.wallboard.agent",
    "productName": "Agent Wallboard",
    
    // ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞ include ‡πÉ‡∏ô build
    "files": [
      "build/**/*",      // React build output
      "main.js",         // Electron main process
      "preload.js",      // Preload script
      "public/assets/**/*" // Icons ‡πÅ‡∏•‡∏∞ assets
    ],
    
    "directories": {
      "buildResources": "public/assets"
    },
    
    // Windows Configuration
    "win": {
      "target": ["nsis"],  // NSIS installer
      "icon": "public/assets/icon.png"
    },
    
    // macOS Configuration
    "mac": {
      "target": ["dmg"],   // DMG installer
      "icon": "public/assets/icon.png",
      "category": "public.app-category.business"
    },
    
    // Linux Configuration
    "linux": {
      "target": ["AppImage", "deb"],
      "icon": "public/assets/icon.png",
      "category": "Office"
    }
  },
  
  // Supported Browsers
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version"
    ]
  }
}
```

### üìÑ .env.example (Template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Environment Variables)

```bash
# ===========================================
# Agent Desktop App - Environment Variables
# ===========================================

# API Configuration
# -----------------
# URL ‡∏Ç‡∏≠‡∏á Backend API Server
# Development: http://localhost:3001/api
# Production: ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô URL ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á server
REACT_APP_API_URL=http://localhost:3001/api

# WebSocket Configuration
# -----------------------
# URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö WebSocket connection
# ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Backend Socket.io server
REACT_APP_SOCKET_URL=http://localhost:3001

# Application Environment
# -----------------------
# development | production | test
NODE_ENV=development

# Electron Development Mode
# -------------------------
# true = ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localhost:3000
# false = ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å build folder
ELECTRON_IS_DEV=true

# Optional: Logging Level
# ----------------------
# debug | info | warn | error
# LOG_LEVEL=debug
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ .env:**
```bash
# 1. Copy template
cp .env.example .env

# 2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
nano .env

# 3. ‡πÑ‡∏ü‡∏•‡πå .env ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å commit (‡πÉ‡∏ô .gitignore)
```

### üìÑ .gitignore (‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£ commit)

```
# ===========================================
# Agent Desktop App - Git Ignore
# ===========================================

# Dependencies
# -----------
node_modules/          # npm packages
/.pnp
.pnp.js

# Testing
# -------
/coverage             # Test coverage reports

# Production Builds
# ----------------
/build                # React build output
/dist                 # Electron build output
out/                  # Alternative build folder

# Environment Variables
# ---------------------
.env                  # Local environment (‡∏°‡∏µ sensitive data)
.env.local
.env.development.local
.env.test.local
.env.production.local

# Logs
# ----
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*

# Editor Directories
# -----------------
.idea/                # IntelliJ IDEA
.vscode/              # Visual Studio Code
*.swp                 # Vim
*.swo
*~

# OS Files
# --------
.DS_Store             # macOS
Thumbs.db             # Windows

# Optional: Local Database Files
# ------------------------------
# *.db
# *.sqlite
```

## 2.4 ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Icons

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ Placeholder Online

```bash
# ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î placeholder icons
curl -L -o public/assets/icon.png "https://placehold.co/256x256/667eea/FFFFFF.png?text=Agent"
curl -L -o public/assets/tray-icon.png "https://placehold.co/32x32/667eea/FFFFFF.png?text=A"
```

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ ImageMagick

```bash
# ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ImageMagick ‡∏Å‡πà‡∏≠‡∏ô
# macOS: brew install imagemagick
# Ubuntu: sudo apt-get install imagemagick

# ‡∏™‡∏£‡πâ‡∏≤‡∏á icon 256x256
convert -size 256x256 xc:#667eea -gravity center -pointsize 72 -fill white -annotate +0+0 "A" public/assets/icon.png

# ‡∏™‡∏£‡πâ‡∏≤‡∏á tray icon 32x32
convert -size 32x32 xc:#667eea -gravity center -pointsize 20 -fill white -annotate +0+0 "A" public/assets/tray-icon.png
```

### üìÑ public/assets/README.txt

```
Agent Wallboard Desktop App - Icon Assets
==========================================

Required Files:
--------------
1. icon.png (256x256px) - Main application icon
   - ‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏≠‡∏õ‡∏Ø
   - ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Taskbar/Dock
   - ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö installer

2. tray-icon.png (32x32px) - System tray icon
   - ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô System Tray (Windows)
   - ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Menu Bar (macOS)
   - ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô monochrome ‡∏´‡∏£‡∏∑‡∏≠ simple design

Recommended Specifications:
--------------------------
Format: PNG with transparency
Main Icon: 256x256px, 72 DPI
Tray Icon: 32x32px or 16x16px, 72 DPI
Color Space: RGB

Design Tips:
-----------
- Simple ‡πÅ‡∏•‡∏∞ recognizable
- Good contrast
- ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (16x16) ‡∏ñ‡∏∂‡∏á‡πÉ‡∏´‡∏ç‡πà (256x256)
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á light ‡πÅ‡∏•‡∏∞ dark themes

Tools:
------
1. Online: https://www.favicon-generator.org/
2. Photoshop, GIMP, Sketch, Figma
3. Command line: ImageMagick
```

## 2.5 ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô Application

### Development Mode

```bash
# Terminal 1: Start Backend Server
cd backend-server
npm run dev

# Terminal 2: Start Agent Desktop App
cd agent-desktop
npm run electron-dev
```

**‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
1. `npm run electron-dev` ‡∏à‡∏∞‡∏£‡∏±‡∏ô `concurrently`
2. `npm start` ‡πÄ‡∏£‡∏¥‡πà‡∏° React dev server (port 3000)
3. `wait-on http://localhost:3000` ‡∏£‡∏≠ React ‡∏û‡∏£‡πâ‡∏≠‡∏°
4. `electron .` ‡πÄ‡∏£‡∏¥‡πà‡∏° Electron ‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localhost:3000

### Production Build

```bash
# Build React app
npm run build

# Test production build
npm run electron

# Create installer
npm run dist          # Current OS
npm run dist:win      # Windows
npm run dist:mac      # macOS
npm run dist:linux    # Linux
```

---

<a name="section-3"></a>
# Section 3: Electron Core Files

## 3.1 main.js - Electron Main Process

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** 
- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Native OS features (windows, menus, tray)
- ‡πÄ‡∏õ‡πá‡∏ô Backend ‡∏Ç‡∏≠‡∏á Electron (Node.js environment)
- ‡πÑ‡∏°‡πà‡∏°‡∏µ access ‡πÑ‡∏õ‡∏¢‡∏±‡∏á DOM

### üìÑ main.js (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)

```javascript
/**
 * ==============================================
 * ELECTRON MAIN PROCESS
 * ==============================================
 * 
 * ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Node.js environment
 * ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å:
 * 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Browser Window
 * 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ System Tray
 * 3. Handle IPC (Inter-Process Communication)
 * 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Native OS features
 * 
 * ‚ö†Ô∏è WARNING: ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô UI code ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
 * UI ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô React (renderer process)
 */

// ===========================================
// 1. LOAD ENVIRONMENT VARIABLES
// ===========================================
// ‡πÇ‡∏´‡∏•‡∏î .env file ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏™‡∏°‡∏≠
require('dotenv').config();

// ===========================================
// 2. IMPORT ELECTRON MODULES
// ===========================================
const { 
  app,              // Application lifecycle
  BrowserWindow,    // Create windows
  Tray,            // System tray
  Menu,            // Context menus
  ipcMain,         // IPC from renderer
  Notification     // Desktop notifications
} = require('electron');
const path = require('path');

// ===========================================
// 3. DETERMINE ENVIRONMENT
// ===========================================
/**
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Development ‡∏´‡∏£‡∏∑‡∏≠ Production mode
 * Development: ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å localhost:3000 (React dev server)
 * Production: ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å build folder (static files)
 */
const isDev = process.env.ELECTRON_IS_DEV === 'true' || 
              process.env.NODE_ENV === 'development' ||
              !app.isPackaged; // app.isPackaged = false ‡πÉ‡∏ô dev mode

// ===========================================
// 4. GLOBAL VARIABLES
// ===========================================
let mainWindow;  // Main application window
let tray;        // System tray instance

// Log startup info
console.log('üöÄ Starting Agent Wallboard Desktop App');
console.log('üì¶ Environment:', isDev ? 'DEVELOPMENT' : 'PRODUCTION');
console.log('üìÅ App Path:', app.getAppPath());

// ===========================================
// 5. IPC HANDLERS
// ===========================================
/**
 * IPC = Inter-Process Communication
 * ‡πÉ‡∏ä‡πâ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Main Process ‡∏Å‡∏±‡∏ö Renderer Process
 * 
 * Pattern: ipcMain.handle() + ipcRenderer.invoke()
 * - handle: ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≤‡∏Å renderer ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö
 * - invoke: ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≤‡∏Å renderer ‡πÅ‡∏•‡∏∞‡∏£‡∏≠ response
 */

/**
 * Handler: show-notification
 * ‡πÅ‡∏™‡∏î‡∏á Desktop Notification
 * 
 * @param {Object} event - IPC event object
 * @param {Object} data - { title, body }
 * @returns {Object} { success: boolean, error?: string }
 */
ipcMain.handle('show-notification', async (event, { title, body }) => {
  try {
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á Notification object
    const notification = new Notification({
      title: title,
      body: body,
      icon: path.join(__dirname, 'public/assets/icon.png'),
      // Optional properties:
      // silent: false,          // ‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
      // timeoutType: 'default'  // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏™‡∏î‡∏á
    });
    
    // ‡πÅ‡∏™‡∏î‡∏á notification
    notification.show();
    
    // Optional: Handle notification click
    notification.on('click', () => {
      if (mainWindow) {
        mainWindow.show();
        mainWindow.focus();
      }
    });
    
    return { success: true };
  } catch (error) {
    console.error('‚ùå Notification error:', error);
    return { 
      success: false, 
      error: error.message 
    };
  }
});

/**
 * Handler: minimize-to-tray
 * ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà System Tray
 */
ipcMain.handle('minimize-to-tray', () => {
  if (mainWindow) {
    mainWindow.hide(); // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á (‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î)
    return { success: true };
  }
  return { success: false };
});

/**
 * Handler: show-app
 * ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å System Tray
 */
ipcMain.handle('show-app', () => {
  if (mainWindow) {
    mainWindow.show();   // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
    mainWindow.focus();  // Focus ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
    return { success: true };
  }
  return { success: false };
});

/**
 * Handler: get-app-version
 * ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡∏à‡∏≤‡∏Å package.json
 */
ipcMain.handle('get-app-version', () => {
  return app.getVersion(); // ‡∏à‡∏≤‡∏Å package.json version field
});

// ===========================================
// 6. CREATE MAIN WINDOW FUNCTION
// ===========================================
/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ
 * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏≠‡∏ô app ready
 */
function createWindow() {
  /**
   * BrowserWindow Configuration
   * ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å
   */
  mainWindow = new BrowserWindow({
    // Window Dimensions
    width: 400,           // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    height: 700,          // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    minWidth: 350,        // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏™‡∏∏‡∏î
    minHeight: 600,
    maxWidth: 500,        // ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∏‡∏î
    
    // Window Appearance
    icon: path.join(__dirname, 'public/assets/icon.png'),
    backgroundColor: '#667eea',  // ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏ì‡∏∞‡πÇ‡∏´‡∏•‡∏î
    
    // Window Behavior
    show: false,          // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏£‡∏≠ ready-to-show)
    resizable: true,      // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏î‡πâ
    maximizable: false,   // ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠
    frame: true,          // ‡πÅ‡∏™‡∏î‡∏á title bar

    /**
     * Web Preferences
     * ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞ features
     */
    webPreferences: {
      // Security Settings
      nodeIntegration: false,      // ‡∏´‡πâ‡∏≤‡∏° require('xxx') ‡πÉ‡∏ô renderer
      contextIsolation: true,      // ‡πÅ‡∏¢‡∏Å context ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á main/renderer
      
      // Preload Script
      preload: path.join(__dirname, 'preload.js'),  // Bridge script
      
      // Development Tools
      devTools: isDev              // ‡πÄ‡∏õ‡∏¥‡∏î DevTools ‡πÉ‡∏ô dev mode
    }
  });

  /**
   * Load Application URL
   * Development: ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å React dev server
   * Production: ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å build folder
   */
  const startUrl = isDev 
    ? 'http://localhost:3000'                           // Dev mode
    : `file://${path.join(__dirname, 'build/index.html')}`; // Production
  
  console.log('üì° Loading URL:', startUrl);
  mainWindow.loadURL(startUrl);

  /**
   * Event: ready-to-show
   * ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö)
   */
  mainWindow.once('ready-to-show', () => {
    console.log('‚úÖ Window ready to show');
    mainWindow.show();
    
    // ‡πÄ‡∏õ‡∏¥‡∏î DevTools ‡πÉ‡∏ô development mode
    if (isDev) {
      mainWindow.webContents.openDevTools();
    }
  });

  /**
   * Event: close
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
   * ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏õ‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà Tray ‡πÅ‡∏ó‡∏ô
   */
  mainWindow.on('close', (event) => {
    if (!app.isQuiting) {
      event.preventDefault();  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á
      mainWindow.hide();       // ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
      
      // ‡πÅ‡∏™‡∏î‡∏á Notification ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
      if (!global.hasShownTrayNotification) {
        if (tray) {
          tray.displayBalloon({
            title: 'Agent Wallboard',
            content: 'Application minimized to tray'
          });
        }
        global.hasShownTrayNotification = true;
      }
    }
  });

  /**
   * Event: did-fail-load
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏ì‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
   */
  mainWindow.webContents.on('did-fail-load', (event, errorCode, errorDescription) => {
    console.error('‚ùå Failed to load:', errorCode, errorDescription);
    
    // ‡πÉ‡∏ô production ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
    if (!isDev) {
      mainWindow.loadURL(`file://${path.join(__dirname, 'build/index.html')}`);
    }
  });
}

// ===========================================
// 7. CREATE SYSTEM TRAY
// ===========================================
/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á System Tray Icon
 * Windows: ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô System Tray (‡∏•‡πà‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤)
 * macOS: ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô Menu Bar (‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤)
 * Linux: ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô System Tray
 */

function createTray() {
  try {
    const trayIconPath = path.join(__dirname, 'public/assets/tray-icon.png');
    console.log('üìç Creating tray icon:', trayIconPath);
    
    /**
     * ‡∏™‡∏£‡πâ‡∏≤‡∏á Tray Instance
     * @param {string} trayIconPath - Path ‡πÑ‡∏õ‡∏¢‡∏±‡∏á icon file
     */
    tray = new Tray(trayIconPath);
    
    /**
     * ‡∏™‡∏£‡πâ‡∏≤‡∏á Context Menu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Tray
     * ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ right-click ‡∏ö‡∏ô tray icon
     */
    const contextMenu = Menu.buildFromTemplate([
      { 
        label: 'Show App',
        click: () => {
          if (mainWindow) {
            mainWindow.show();
            mainWindow.focus();
          }
        }
      },
      { type: 'separator' },  // ‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á
      { 
        label: `Version ${app.getVersion()}`,
        enabled: false  // ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å
      },
      { type: 'separator' },
      { 
        label: 'Quit',
        click: () => {
          app.isQuiting = true;  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á
          app.quit();
        }
      }
    ]);
    
    // Set context menu ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö tray
    tray.setContextMenu(contextMenu);
    
    // Set tooltip (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ hover)
    tray.setToolTip('Agent Wallboard');
    
    /**
     * Event: double-click
     * Double-click ‡∏ö‡∏ô tray icon ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
     */
    tray.on('double-click', () => {
      if (mainWindow) {
        mainWindow.show();
        mainWindow.focus();
      }
    });
    
    console.log('‚úÖ Tray icon created successfully');
  } catch (error) {
    console.error('‚ùå Tray creation failed:', error);
    console.log('‚ö†Ô∏è  Application will continue without tray icon');
    // ‡πÑ‡∏°‡πà throw error - ‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ tray
  }
}

// ===========================================
// 8. APP LIFECYCLE EVENTS
// ===========================================

/**
 * Event: ready
 * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ Electron ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á windows
 * ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ event ‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å BrowserWindow APIs
 */
app.whenReady().then(() => {
  console.log('üéâ App is ready');
  createWindow();  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å
  createTray();    // ‡∏™‡∏£‡πâ‡∏≤‡∏á system tray
});

/**
 * Event: window-all-closed
 * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
 * 
 * macOS: ‡πÅ‡∏≠‡∏õ‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÅ‡∏°‡πâ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏°‡∏î (standard behavior)
 * Windows/Linux: ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ
 */
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {  // darwin = macOS
    app.quit();
  }
});

/**
 * Event: activate
 * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà Dock icon (macOS)
 * 
 * Behavior: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
 *           ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
 */
app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createWindow();  // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á = ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
  } else if (mainWindow) {
    mainWindow.show();  // ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß = ‡πÅ‡∏™‡∏î‡∏á
  }
});

// ===========================================
// 9. PREVENT MULTIPLE INSTANCES
// ===========================================
/**
 * Single Instance Lock
 * ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
 * 
 * Behavior:
 * - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ instance ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà ‚Üí ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà
 * - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡πâ‡∏≥ ‚Üí Focus ‡πÑ‡∏õ‡∏ó‡∏µ‡πà instance ‡πÄ‡∏î‡∏¥‡∏°
 */
const gotTheLock = app.requestSingleInstanceLock();

if (!gotTheLock) {
  console.log('‚ö†Ô∏è  Another instance is already running');
  app.quit();  // ‡∏õ‡∏¥‡∏î‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ
} else {
  /**
   * Event: second-instance
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏õ‡∏¥‡∏î instance ‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏á
   * 
   * @param {Event} event
   * @param {string[]} commandLine - Command line arguments
   * @param {string} workingDirectory - Working directory
   */
  app.on('second-instance', (event, commandLine, workingDirectory) => {
    console.log('‚ö†Ô∏è  Second instance detected, focusing main window');
    
    // Focus ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å
    if (mainWindow) {
      if (mainWindow.isMinimized()) {
        mainWindow.restore();  // Restore ‡∏ñ‡πâ‡∏≤ minimize
      }
      mainWindow.show();
      mainWindow.focus();
    }
  });
}

// ===========================================
// 10. ERROR HANDLING
// ===========================================
/**
 * Global Error Handlers
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ errors ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å catch
 */

/**
 * Uncaught Exception Handler
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ synchronous errors ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ try-catch
 */
process.on('uncaughtException', (error) => {
  console.error('üí• Uncaught exception:', error);
  // ‡πÉ‡∏ô production ‡∏≠‡∏≤‡∏à‡∏à‡∏∞ log ‡πÑ‡∏õ‡∏¢‡∏±‡∏á error tracking service
  // ‡πÄ‡∏ä‡πà‡∏ô Sentry, Bugsnag, etc.
});

/**
 * Unhandled Rejection Handler
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Promise rejections ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ .catch()
 */
process.on('unhandledRejection', (error) => {
  console.error('üí• Unhandled rejection:', error);
});

/**
 * Warning Handler (Optional)
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Node.js warnings
 */
process.on('warning', (warning) => {
  console.warn('‚ö†Ô∏è  Warning:', warning.name, warning.message);
});
```

---

## 3.2 preload.js - Security Bridge

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:**
- ‡πÄ‡∏õ‡πá‡∏ô Bridge ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Main Process (Node.js) ‡∏Å‡∏±‡∏ö Renderer Process (Browser)
- ‡πÉ‡∏ä‡πâ `contextBridge` ‡πÄ‡∏û‡∏∑‡πà‡∏≠ expose APIs ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô direct access ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Node.js APIs

### üìÑ preload.js (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)

```javascript
/**
 * ==============================================
 * ELECTRON PRELOAD SCRIPT
 * ==============================================
 * 
 * ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô Renderer Process (React) ‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î
 * 
 * ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å:
 * 1. ‡πÄ‡∏õ‡πá‡∏ô Security Bridge ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Main ‡πÅ‡∏•‡∏∞ Renderer
 * 2. Expose APIs ‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏´‡πâ Renderer ‡πÉ‡∏ä‡πâ
 * 3. ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô direct access ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Node.js modules
 * 
 * ‚ö†Ô∏è SECURITY CONSIDERATIONS:
 * - ‡∏´‡πâ‡∏≤‡∏° expose ‡∏ó‡∏±‡πâ‡∏á require() ‡∏´‡∏£‡∏∑‡∏≠ process
 * - ‡∏´‡πâ‡∏≤‡∏° expose modules ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô fs, child_process
 * - Expose ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ specific functions ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
 * - ‡πÉ‡∏ä‡πâ contextBridge ‡πÄ‡∏™‡∏°‡∏≠ (‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ window.xxx = yyy)
 */

// ===========================================
// 1. IMPORT ELECTRON MODULES
// ===========================================
const { contextBridge, ipcRenderer } = require('electron');

/**
 * contextBridge - ‡∏™‡∏£‡πâ‡∏≤‡∏á bridge ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á contexts
 * ipcRenderer - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Main Process
 */

// ===========================================
// 2. EXPOSE ELECTRON APIs
// ===========================================
/**
 * exposeInMainWorld()
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á global object ‡πÉ‡∏ô window ‡∏Ç‡∏≠‡∏á Renderer Process
 * 
 * @param {string} apiKey - ‡∏ä‡∏∑‡πà‡∏≠ object (‡πÄ‡∏ä‡πà‡∏ô 'electronAPI')
 * @param {Object} api - APIs ‡∏ó‡∏µ‡πà‡∏à‡∏∞ expose
 * 
 * ‡πÉ‡∏ô React ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ú‡πà‡∏≤‡∏ô: window.electronAPI.functionName()
 */
contextBridge.exposeInMainWorld('electronAPI', {
  
  // ===========================================
  // NOTIFICATION API
  // ===========================================
  /**
   * showNotification()
   * ‡πÅ‡∏™‡∏î‡∏á Desktop Notification
   * 
   * @param {string} title - ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ notification
   * @param {string} body - ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ notification
   * @returns {Promise<Object>} { success: boolean, error?: string }
   * 
   * Usage in React:
   * ```javascript
   * await window.electronAPI.showNotification(
   *   'New Message',
   *   'You have a new message from SP001'
   * );
   * ```
   */
  showNotification: (title, body) => {
    return ipcRenderer.invoke('show-notification', { title, body });
  },
  
  // ===========================================
  // WINDOW MANAGEMENT APIs
  // ===========================================
  /**
   * minimizeToTray()
   * ‡∏ã‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà System Tray
   * 
   * @returns {Promise<Object>} { success: boolean }
   * 
   * Usage:
   * ```javascript
   * await window.electronAPI.minimizeToTray();
   * ```
   */
  minimizeToTray: () => {
    return ipcRenderer.invoke('minimize-to-tray');
  },
  
  /**
   * showApp()
   * ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å System Tray
   * 
   * @returns {Promise<Object>} { success: boolean }
   */
  showApp: () => {
    return ipcRenderer.invoke('show-app');
  },
  
  // ===========================================
  // APP INFO APIs
  // ===========================================
  /**
   * getAppVersion()
   * ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ
   * 
   * @returns {Promise<string>} version (‡πÄ‡∏ä‡πà‡∏ô "3.2.0")
   * 
   * Usage:
   * ```javascript
   * const version = await window.electronAPI.getAppVersion();
   * console.log('App version:', version);
   * ```
   */
  getAppVersion: () => {
    return ipcRenderer.invoke('get-app-version');
  },
  
  // ===========================================
  // ENVIRONMENT INFO (Read-only)
  // ===========================================
  /**
   * isElectron
   * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Electron ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
   * 
   * ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö conditional logic:
   * ```javascript
   * if (window.electronAPI?.isElectron) {
   *   // ‡πÉ‡∏ä‡πâ Electron-specific features
   * } else {
   *   // ‡πÉ‡∏ä‡πâ Web APIs
   * }
   * ```
   */
  isElectron: true,
  
  /**
   * platform
   * ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£
   * - 'win32' = Windows
   * - 'darwin' = macOS
   * - 'linux' = Linux
   * 
   * Usage:
   * ```javascript
   * if (window.electronAPI.platform === 'darwin') {
   *   // macOS-specific code
   * }
   * ```
   */
  platform: process.platform,
  
  /**
   * isDevelopment
   * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Development mode ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
   */
  isDevelopment: process.env.NODE_ENV === 'development'
});

// ===========================================
// 3. ADDITIONAL SECURITY
// ===========================================
/**
 * ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Node.js integration
 * (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô main.js webPreferences ‡πÅ‡∏•‡πâ‡∏ß)
 */
// nodeIntegration: false
// contextIsolation: true

/**
 * ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á APIs ‡∏ó‡∏µ‡πà ‚ùå ‡∏´‡πâ‡∏≤‡∏° expose:
 * 
 * ‚ùå BAD - Dangerous APIs:
 * ```javascript
 * contextBridge.exposeInMainWorld('dangerousAPI', {
 *   require: require,              // ‡∏´‡πâ‡∏≤‡∏°! access ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ
 *   process: process,              // ‡∏´‡πâ‡∏≤‡∏°! access ‡∏ó‡∏∏‡∏Å env ‡πÑ‡∏î‡πâ
 *   fs: require('fs'),            // ‡∏´‡πâ‡∏≤‡∏°! ‡∏≠‡πà‡∏≤‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ
 *   exec: require('child_process').exec  // ‡∏´‡πâ‡∏≤‡∏°! ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ
 * });
 * ```
 * 
 * ‚úÖ GOOD - Safe APIs:
 * ```javascript
 * contextBridge.exposeInMainWorld('safeAPI', {
 *   readSpecificFile: () => ipcRenderer.invoke('read-specific-file'),
 *   getAppInfo: () => ({ version: app.getVersion() })
 * });
 * ```
 */

// ===========================================
// 4. LOGGING
// ===========================================
/**
 * Log ‡πÄ‡∏°‡∏∑‡πà‡∏≠ preload script ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
 * ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô debugging
 */
console.log('üîê Preload script loaded');
console.log('üì¶ Platform:', process.platform);
console.log('üîß Node version:', process.versions.node);
console.log('‚ö° Electron version:', process.versions.electron);
console.log('üåê Chrome version:', process.versions.chrome);

// ===========================================
// 5. ADVANCED: EVENT LISTENERS (Optional)
// ===========================================
/**
 * ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ listen events ‡∏à‡∏≤‡∏Å Main Process
 * ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ pattern ‡∏ô‡∏µ‡πâ:
 * 
 * ```javascript
 * contextBridge.exposeInMainWorld('electronAPI', {
 *   // Send to main
 *   sendToMain: (channel, data) => {
 *     ipcRenderer.send(channel, data);
 *   },
 *   
 *   // Receive from main
 *   onMainMessage: (channel, callback) => {
 *     ipcRenderer.on(channel, (event, ...args) => callback(...args));
 *   },
 *   
 *   // Remove listener
 *   removeListener: (channel, callback) => {
 *     ipcRenderer.removeListener(channel, callback);
 *   }
 * });
 * ```
 * 
 * Usage in React:
 * ```javascript
 * useEffect(() => {
 *   const handler = (data) => {
 *     console.log('Received from main:', data);
 *   };
 *   
 *   window.electronAPI.onMainMessage('update-available', handler);
 *   
 *   return () => {
 *     window.electronAPI.removeListener('update-available', handler);
 *   };
 * }, []);
 * ```
 */

// ===========================================
// 6. SECURITY BEST PRACTICES SUMMARY
// ===========================================
/**
 * ‚úÖ DO:
 * - ‡πÉ‡∏ä‡πâ contextBridge.exposeInMainWorld()
 * - Expose ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ functions ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
 * - Validate input parameters
 * - Return promises ‡πÅ‡∏ó‡∏ô callbacks
 * - Log errors ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡πà‡∏á sensitive data
 * 
 * ‚ùå DON'T:
 * - Expose require() ‡∏´‡∏£‡∏∑‡∏≠ modules ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
 * - Expose process object
 * - ‡πÉ‡∏´‡πâ access ‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á filesystem
 * - ‡∏£‡∏±‡∏ô arbitrary commands
 * - ‡∏™‡πà‡∏á sensitive data ‡∏ú‡πà‡∏≤‡∏ô IPC
 */
```

---

## 3.3 ‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£ IPC (Inter-Process Communication)

### Diagram: IPC Communication Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    RENDERER PROCESS                      ‚îÇ
‚îÇ                     (React / UI)                         ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  Component:                                              ‚îÇ
‚îÇ  const notify = async () => {                            ‚îÇ
‚îÇ    await window.electronAPI.showNotification(...)        ‚îÇ
‚îÇ  }                                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ IPC Invoke
                         ‚îÇ (Async)
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    PRELOAD SCRIPT                        ‚îÇ
‚îÇ                   (Security Bridge)                      ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  contextBridge.exposeInMainWorld('electronAPI', {        ‚îÇ
‚îÇ    showNotification: (title, body) =>                    ‚îÇ
‚îÇ      ipcRenderer.invoke('show-notification', {...})      ‚îÇ
‚îÇ  })                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ IPC Channel
                         ‚îÇ 'show-notification'
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    MAIN PROCESS                          ‚îÇ
‚îÇ                     (Node.js)                            ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ipcMain.handle('show-notification', async (e, data) => {‚îÇ
‚îÇ    const notification = new Notification(...)            ‚îÇ
‚îÇ    notification.show()                                   ‚îÇ
‚îÇ    return { success: true }                              ‚îÇ
‚îÇ  })                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô IPC ‡πÉ‡∏ô React

```javascript
// ‡πÉ‡∏ô React Component
import { useEffect } from 'react';

function MyComponent() {
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Electron ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  const isElectron = window.electronAPI?.isElectron;
  
  useEffect(() => {
    if (isElectron) {
      // ‡πÅ‡∏™‡∏î‡∏á notification ‡πÄ‡∏°‡∏∑‡πà‡∏≠ component mount
      showWelcomeNotification();
    }
  }, [isElectron]);
  
  const showWelcomeNotification = async () => {
    try {
      const result = await window.electronAPI.showNotification(
        'Welcome!',
        'Agent Desktop App is ready'
      );
      
      if (result.success) {
        console.log('Notification shown');
      }
    } catch (error) {
      console.error('Notification error:', error);
    }
  };
  
  const handleMinimize = async () => {
    if (isElectron) {
      await window.electronAPI.minimizeToTray();
    }
  };
  
  return (
    <div>
      <button onClick={handleMinimize}>
        Minimize to Tray
      </button>
    </div>
  );
}
```

---

# Section 4: React Application Structure

<a name="section-4"></a>

## 4.1 React Entry Point ‡πÅ‡∏•‡∏∞ App Structure

### ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á React Application

```
React Application Architecture
‚îú‚îÄ‚îÄ index.js (Entry Point)
‚îÇ   ‚îî‚îÄ‚îÄ Mounts React to DOM
‚îÇ       ‚îî‚îÄ‚îÄ Wraps with ErrorBoundary
‚îÇ           ‚îî‚îÄ‚îÄ Renders <App />
‚îÇ
‚îî‚îÄ‚îÄ App.js (Main Container)
    ‚îú‚îÄ‚îÄ State Management (useState, useRef)
    ‚îú‚îÄ‚îÄ Side Effects (useEffect)
    ‚îú‚îÄ‚îÄ Event Handlers (useCallback)
    ‚îî‚îÄ‚îÄ Component Tree
        ‚îú‚îÄ‚îÄ LoginForm (Not logged in)
        ‚îî‚îÄ‚îÄ Dashboard (Logged in)
            ‚îú‚îÄ‚îÄ AgentInfo
            ‚îú‚îÄ‚îÄ StatusPanel
            ‚îî‚îÄ‚îÄ MessagePanel
```

---

## 4.2 index.js - React Entry Point

### üìÑ src/index.js

```javascript
/**
 * ==============================================
 * REACT ENTRY POINT
 * ==============================================
 * 
 * ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á React Application
 * 
 * ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:
 * 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á React Root
 * 2. Mount React App ‡πÑ‡∏õ‡∏¢‡∏±‡∏á DOM
 * 3. Wrap App ‡∏î‡πâ‡∏ß‡∏¢ ErrorBoundary
 * 4. Enable React.StrictMode (development checks)
 */

// ===========================================
// IMPORTS
// ===========================================
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import ErrorBoundary from './components/ErrorBoundary';

// ===========================================
// HIDE LOADING SCREEN
// ===========================================
/**
 * ‡∏ã‡πà‡∏≠‡∏ô Loading Screen ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô index.html
 * ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° class 'app-loaded' ‡πÑ‡∏õ‡∏¢‡∏±‡∏á <body>
 * 
 * CSS ‡πÉ‡∏ô index.html:
 * .app-loaded #loading-screen { display: none; }
 */
document.body.classList.add('app-loaded');

// ===========================================
// CREATE REACT ROOT
// ===========================================
/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Root ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö React 18
 * ‡πÄ‡∏õ‡πá‡∏ô concurrent rendering mode ‡πÉ‡∏´‡∏°‡πà
 * 
 * @see https://react.dev/blog/2022/03/29/react-v18#new-root-api
 */
const root = ReactDOM.createRoot(
  document.getElementById('root') // Element ‡πÉ‡∏ô public/index.html
);

// ===========================================
// RENDER APPLICATION
// ===========================================
/**
 * Render React Application
 * 
 * Structure:
 * React.StrictMode
 * ‚îî‚îÄ‚îÄ ErrorBoundary (Catch rendering errors)
 *     ‚îî‚îÄ‚îÄ App (Main application)
 */
root.render(
  /**
   * React.StrictMode
   * ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô development checks:
   * - ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤ deprecated APIs
   * - ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô side effects ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
   * - ‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏≤ legacy string ref
   * - Render 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á (dev only) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤ bugs
   * 
   * ‚ö†Ô∏è StrictMode ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô development mode ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
   */
  <React.StrictMode>
    {/**
     * ErrorBoundary
     * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ errors ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÉ‡∏ô component tree
     * ‡πÅ‡∏™‡∏î‡∏á fallback UI ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£ crash ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ
     */}
    <ErrorBoundary>
      {/**
       * App Component
       * Main application component
       */}
      <App />
    </ErrorBoundary>
  </React.StrictMode>
);

// ===========================================
// STARTUP LOGGING
// ===========================================
/**
 * Log ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
 * ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏ô debugging ‡πÅ‡∏•‡∏∞ monitoring
 */
console.log('üöÄ Agent Wallboard Desktop App - Started');
console.log('üì¶ Version:', process.env.REACT_APP_VERSION || '3.2.0');
console.log('üåç Environment:', process.env.NODE_ENV);
console.log('üîó API URL:', process.env.REACT_APP_API_URL);
console.log('‚ö° Socket URL:', process.env.REACT_APP_SOCKET_URL);

// ===========================================
// PERFORMANCE MONITORING (Optional)
// ===========================================
/**
 * ‡πÉ‡∏ä‡πâ Web Vitals API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î performance
 * (‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á web-vitals package)
 * 
 * ```bash
 * npm install web-vitals
 * ```
 * 
 * ```javascript
 * import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';
 * 
 * function sendToAnalytics(metric) {
 *   console.log(metric);
 *   // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á analytics service
 * }
 * 
 * getCLS(sendToAnalytics);  // Cumulative Layout Shift
 * getFID(sendToAnalytics);  // First Input Delay
 * getFCP(sendToAnalytics);  // First Contentful Paint
 * getLCP(sendToAnalytics);  // Largest Contentful Paint
 * getTTFB(sendToAnalytics); // Time to First Byte
 * ```
 */
```

---

## 4.3 App.js - Main Application Component

### State Management Strategy

```
App State Architecture
‚îú‚îÄ‚îÄ Authentication State
‚îÇ   ‚îú‚îÄ‚îÄ isLoggedIn (boolean)
‚îÇ   ‚îú‚îÄ‚îÄ agent (object | null)
‚îÇ   ‚îî‚îÄ‚îÄ status (string)
‚îÇ
‚îú‚îÄ‚îÄ Data State
‚îÇ   ‚îú‚îÄ‚îÄ messages (array)
‚îÇ   ‚îî‚îÄ‚îÄ loadingMessages (boolean)
‚îÇ
‚îú‚îÄ‚îÄ Connection State
‚îÇ   ‚îú‚îÄ‚îÄ connectionStatus (string)
‚îÇ   ‚îî‚îÄ‚îÄ error (string | null)
‚îÇ
‚îî‚îÄ‚îÄ Refs (Stable References)
    ‚îú‚îÄ‚îÄ socketRef (WebSocket instance)
    ‚îî‚îÄ‚îÄ isLoggedInRef (Prevent stale closures)
```

### üìÑ src/App.js (Part 1: Setup & State)

```javascript
/**
 * ==============================================
 * MAIN APPLICATION COMPONENT
 * ==============================================
 * 
 * App.js ‡∏Ñ‡∏∑‡∏≠ Container Component ‡∏´‡∏•‡∏±‡∏Å
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£:
 * 1. Authentication State
 * 2. WebSocket Connection
 * 3. Message Management
 * 4. Status Updates
 * 5. Component Composition
 */

// ===========================================
// IMPORTS
// ===========================================
import React, { useState, useEffect, useCallback, useRef } from 'react';

// Components
import LoginForm from './components/LoginForm';
import AgentInfo from './components/AgentInfo';
import StatusPanel from './components/StatusPanel';
import MessagePanel from './components/MessagePanel';

// Services
import { 
  setAuthToken, 
  getMessages, 
  updateAgentStatus,
  logoutAgent 
} from './services/api';
import { 
  connectSocket, 
  disconnectSocket, 
  sendStatusUpdate
} from './services/socket';
import { 
  showDesktopNotification, 
  requestNotificationPermission 
} from './services/notifications';

// Utils
import logger from './utils/logger';

// Styles
import './styles/App.css';
import './styles/components.css';

// ===========================================
// MAIN APP COMPONENT
// ===========================================
function App() {
  
  // ===========================================
  // 1. STATE DECLARATIONS
  // ===========================================
  
  /**
   * Authentication State
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£ login ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• user
   */
  
  // Login status
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  
  // Agent data (‡∏à‡∏≤‡∏Å login response)
  const [agent, setAgent] = useState(null);
  /**
   * agent structure:
   * {
   *   agentCode: string,
   *   agentName: string,
   *   teamId: number,
   *   teamName: string,
   *   role: string,
   *   email: string
   * }
   */
  
  // Current status
  const [status, setStatus] = useState('Offline');
  // Possible values: 'Available', 'Busy', 'Break', 'Offline'
  
  /**
   * Data State
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô UI
   */
  
  // Messages array
  const [messages, setMessages] = useState([]);
  /**
   * message structure:
   * {
   *   _id: string,
   *   fromCode: string,
   *   toCode: string,
   *   content: string,
   *   type: 'direct' | 'broadcast',
   *   priority: 'high' | 'normal' | 'low',
   *   isRead: boolean,
   *   timestamp: Date
   * }
   */
  
  // Loading state for messages
  const [loadingMessages, setLoadingMessages] = useState(false);
  
  /**
   * Connection State
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
   */
  
  // WebSocket connection status
  const [connectionStatus, setConnectionStatus] = useState('disconnected');
  // Possible values: 'connected', 'disconnected', 'error'
  
  // Error message
  const [error, setError] = useState(null);
  
  // ===========================================
  // 2. REFS DECLARATIONS
  // ===========================================
  /**
   * Refs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà trigger re-render
   * ‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô stale closures
   */
  
  // WebSocket instance
  const socketRef = useRef(null);
  
  // isLoggedIn reference (for socket event handlers)
  const isLoggedInRef = useRef(false);
  /**
   * ‡πÄ‡∏Å‡πá‡∏ö isLoggedIn ‡πÉ‡∏ô ref ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:
   * - Socket event handlers ‡πÄ‡∏õ‡πá‡∏ô closures
   * - ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á state ‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏î‡πâ (stale closure)
   * - ref ‡∏à‡∏∞ update ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ re-render
   */
  
  // ===========================================
  // 3. SYNC REF WITH STATE
  // ===========================================
  /**
   * Update ref ‡πÄ‡∏°‡∏∑‡πà‡∏≠ state ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
   * ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ socket handlers ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠
   */
  useEffect(() => {
    isLoggedInRef.current = isLoggedIn;
  }, [isLoggedIn]);
  
  // ===========================================
  // 4. INITIALIZATION EFFECT
  // ===========================================
  /**
   * Run once on mount
   * Request notification permission
   */
  useEffect(() => {
    requestNotificationPermission();
    logger.info('App initialized');
    
    // Cleanup on unmount
    return () => {
      logger.info('App unmounting');
    };
  }, []);
  
```

### üìÑ src/App.js (Part 2: Load Messages Function)

```javascript
  // ===========================================
  // 5. LOAD MESSAGES FUNCTION
  // ===========================================
  /**
   * loadMessages()
   * ‡πÇ‡∏´‡∏•‡∏î message history ‡∏à‡∏≤‡∏Å backend
   * 
   * @param {string} agentCode - Agent code
   * 
   * Flow:
   * 1. Set loading state
   * 2. Call API to get messages
   * 3. Update messages state
   * 4. Handle errors
   * 5. Clear loading state
   */
  const loadMessages = useCallback(async (agentCode) => {
    setLoadingMessages(true);
    
    try {
      logger.log('Loading existing messages for', agentCode);
      
      // API call: GET /api/messages/agent/:agentCode
      const messagesData = await getMessages(agentCode, 50);
      
      if (messagesData.success) {
        const messageList = messagesData.messages || [];
        logger.log('Loaded', messageList.length, 'messages');
        
        // Update state
        setMessages(messageList);
      } else {
        logger.error('Failed to load messages:', messagesData.error);
      }
      
    } catch (error) {
      logger.error('Failed to load messages:', error);
      
      // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡πÉ‡∏´‡πâ user ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà critical
      // ‡πÅ‡∏Ñ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ history messages
      
    } finally {
      setLoadingMessages(false);
    }
  }, []); // No dependencies - stable function
  
  // ===========================================
  // 6. WEBSOCKET CONNECTION EFFECT
  // ===========================================
  /**
   * Setup ‡πÅ‡∏•‡∏∞ Cleanup WebSocket connection
   * 
   * Dependencies: [isLoggedIn, agent]
   * - ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ login
   * - ‡∏ï‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠ logout
   * 
   * ‚ö†Ô∏è CRITICAL: Cleanup function ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
   * ‡∏°‡∏¥‡∏â‡∏∞‡∏ô‡∏±‡πâ‡∏ô‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î memory leaks
   */
  useEffect(() => {
    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agent ‡πÉ‡∏´‡πâ skip
    if (!isLoggedIn || !agent) {
      return;
    }

    logger.log('Setting up WebSocket connection for', agent.agentCode);
    
    // ===========================================
    // 6.1 CONNECT SOCKET
    // ===========================================
    const socket = connectSocket(agent.agentCode);
    socketRef.current = socket;
    
    if (!socket) {
      logger.error('Failed to create socket connection');
      return;
    }

    // ===========================================
    // 6.2 DEFINE EVENT HANDLERS
    // ===========================================
    /**
     * ‡πÄ‡∏Å‡πá‡∏ö handlers ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô object
     * ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£ register/unregister
     */
    const handlers = {
      /**
       * Event: connect
       * ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
       */
      connect: () => {
        logger.log('WebSocket connected');
        setConnectionStatus('connected');
        setError(null);
      },
      
      /**
       * Event: disconnect
       * ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≤‡∏î
       * @param {string} reason - ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
       */
      disconnect: (reason) => {
        logger.log('WebSocket disconnected:', reason);
        setConnectionStatus('disconnected');
        
        // Disconnect reasons:
        // - 'io server disconnect' = server ‡∏õ‡∏¥‡∏î connection
        // - 'io client disconnect' = client ‡∏õ‡∏¥‡∏î connection
        // - 'ping timeout' = timeout
        // - 'transport close' = transport layer ‡∏õ‡∏¥‡∏î
        // - 'transport error' = transport error
      },
      
      /**
       * Event: connect_error
       * Error ‡∏ï‡∏≠‡∏ô‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
       */
      connect_error: (error) => {
        logger.error('WebSocket connection error:', error);
        setConnectionStatus('error');
        setError('Failed to connect to server');
      },

      /**
       * Event: reconnect
       * ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
       * @param {number} attemptNumber - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°
       */
      reconnect: (attemptNumber) => {
        logger.log('WebSocket reconnected after', attemptNumber, 'attempts');
        setConnectionStatus('connected');
        setError(null);
      },
      
      /**
       * Event: connection_success
       * Authentication ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (custom event ‡∏à‡∏≤‡∏Å backend)
       */
      connection_success: (data) => {
        logger.log('WebSocket authentication successful:', data);
      },

      /**
       * Event: connection_error
       * Authentication ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
       */
      connection_error: (error) => {
        logger.error('Connection error from server:', error);
        setError(error.message || 'Connection error');
      },
      
      /**
       * Event: status_updated
       * Status update ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
       */
      status_updated: (data) => {
        logger.log('Status updated:', data);
        setStatus(data.status);
      },

      /**
       * Event: status_error
       * Status update ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
       */
      status_error: (error) => {
        logger.error('Status error from server:', error);
        setError(error.message || 'Status update failed');
      },
      
      /**
       * Event: new_message
       * ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà
       * 
       * ‚ö†Ô∏è IMPORTANT: ‡πÉ‡∏ä‡πâ ref ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö login status
       * ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ handler ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô closure ‡∏≠‡∏≤‡∏à‡πÑ‡∏î‡πâ state ‡πÄ‡∏Å‡πà‡∏≤
       */
      new_message: (message) => {
        logger.log('New message received:', message);
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á login ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        if (isLoggedInRef.current) {
          // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î
          setMessages(prev => [message, ...prev]);
          
          // ‡πÅ‡∏™‡∏î‡∏á desktop notification
          showDesktopNotification(
            `Message from ${message.fromCode}`,
            message.content
          );
        }
      },

      /**
       * Event: message_sent
       * ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö supervisor)
       */
      message_sent: (data) => {
        logger.log('Message sent confirmation:', data);
      },

      /**
       * Event: message_error
       * ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
       */
      message_error: (error) => {
        logger.error('Message error from server:', error);
      },
      
      /**
       * Event: agent_connected
       * Agent ‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö supervisor)
       */
      agent_connected: (data) => {
        logger.log('Agent connected:', data);
      },

      /**
       * Event: agent_disconnected
       * Agent ‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
       */
      agent_disconnected: (data) => {
        logger.log('Agent disconnected:', data);
      }
    };

    // ===========================================
    // 6.3 REGISTER EVENT HANDLERS
    // ===========================================
    /**
     * Register ‡∏ó‡∏∏‡∏Å handler ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ
     */
    Object.entries(handlers).forEach(([event, handler]) => {
      socket.on(event, handler);
    });

    // ===========================================
    // 6.4 CLEANUP FUNCTION
    // ===========================================
    /**
     * ‚ö†Ô∏è CRITICAL: Cleanup ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô memory leaks
     * 
     * ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠:
     * - Component unmount
     * - Dependencies ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô (re-run effect)
     * 
     * ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥:
     * 1. Unregister event handlers ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
     * 2. Disconnect socket
     * 3. Clear refs
     * 4. Update state
     */
    return () => {
      logger.log('Cleaning up WebSocket connection');
      
      // 1. Unregister all handlers
      Object.entries(handlers).forEach(([event, handler]) => {
        socket.off(event, handler);
      });
      
      // 2. Disconnect socket
      disconnectSocket();
      
      // 3. Clear ref
      socketRef.current = null;
      
      // 4. Update state
      setConnectionStatus('disconnected');
    };
  }, [isLoggedIn, agent]); // Dependencies

```

### üìÑ src/App.js (Part 3: Event Handlers)

```javascript
  // ===========================================
  // 7. LOGIN HANDLER
  // ===========================================
  /**
   * handleLogin()
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
   * 
   * @param {Object} agentData - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agent ‡∏à‡∏≤‡∏Å API
   * @param {string} token - JWT token
   * 
   * Flow:
   * 1. Log success
   * 2. Save token
   * 3. Update states
   * 4. Load messages
   * 
   * Called from: LoginForm component
   */
  const handleLogin = useCallback(async (agentData, token) => {
    logger.log('Login successful:', agentData);
    
    // 1. Save JWT token to api service
    setAuthToken(token);
    
    // 2. Update authentication state
    setAgent(agentData);
    setIsLoggedIn(true);
    setStatus('Available'); // Default status after login
    setError(null);
    
    // 3. Load message history
    // ‡πÉ‡∏ä‡πâ await ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
    await loadMessages(agentData.agentCode);
    
    // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: WebSocket ‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å useEffect ‡∏à‡∏∞ trigger ‡πÄ‡∏°‡∏∑‡πà‡∏≠ isLoggedIn ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
    
  }, [loadMessages]); // Dependency: loadMessages function

  // ===========================================
  // 8. LOGOUT HANDLER
  // ===========================================
  /**
   * handleLogout()
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£ logout
   * 
   * Flow:
   * 1. Call logout API
   * 2. Disconnect WebSocket
   * 3. Clear all states
   * 4. Clear token
   * 
   * Called from: Dashboard logout button
   */
  const handleLogout = useCallback(async () => {
    logger.log('Logging out');
    
    try {
      // 1. Call logout API
      // ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á logout ‡∏ó‡∏µ‡πà client
      await logoutAgent();
      logger.log('Logout API called successfully');
    } catch (error) {
      logger.error('Logout API call failed:', error);
      // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á throw error ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞ logout ‡∏≠‡∏¢‡∏π‡πà‡∏î‡∏µ
    }
    
    // 2. Disconnect WebSocket
    // Cleanup function ‡πÉ‡∏ô useEffect ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    // ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å disconnect ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡πÉ‡∏à
    disconnectSocket();
    
    // 3. Reset all states to initial values
    setIsLoggedIn(false);
    setAgent(null);
    setStatus('Offline');
    setMessages([]);
    setConnectionStatus('disconnected');
    setError(null);
    setLoadingMessages(false);
    
    // 4. Token ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å clear ‡πÉ‡∏ô logoutAgent() ‡πÅ‡∏•‡πâ‡∏ß
    
    logger.log('Logout completed');
  }, []); // No dependencies - stable function

  // ===========================================
  // 9. STATUS CHANGE HANDLER
  // ===========================================
  /**
   * handleStatusChange()
   * ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á agent
   * 
   * @param {string} newStatus - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà
   * 
   * Strategy: WebSocket First, HTTP Fallback
   * 1. Try WebSocket (fast, real-time)
   * 2. If WebSocket not connected, use HTTP API (reliable)
   * 
   * Flow:
   * 1. Optimistic update (update UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)
   * 2. Try send via WebSocket
   * 3. If fail, fallback to HTTP
   * 4. On error, revert to previous status
   * 
   * Called from: StatusPanel component
   */
  const handleStatusChange = useCallback(async (newStatus) => {
    // Guard: ‡∏ï‡πâ‡∏≠‡∏á login ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agent
    if (!agent) {
      logger.warn('Cannot change status: not logged in');
      return;
    }
    
    logger.log('Changing status to:', newStatus);
    
    // ‡πÄ‡∏Å‡πá‡∏ö status ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö revert ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏î error)
    const previousStatus = status;
    
    // ==========================================
    // OPTIMISTIC UPDATE
    // ==========================================
    /**
     * Update UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á request
     * ‡∏ó‡∏≥‡πÉ‡∏´‡πâ UI ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å responsive
     * ‡∏ñ‡πâ‡∏≤ request ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏à‡∏∞ revert ‡∏Å‡∏•‡∏±‡∏ö
     */
    setStatus(newStatus);
    
    try {
      // ==========================================
      // METHOD 1: TRY WEBSOCKET FIRST
      // ==========================================
      /**
       * WebSocket = Fast, Real-time
       * ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà connected (network issue)
       */
      const socketSuccess = sendStatusUpdate(agent.agentCode, newStatus);
      
      if (socketSuccess) {
        logger.log('Status update sent via WebSocket');
        // ‚úÖ Success - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°
        // Backend ‡∏à‡∏∞ broadcast ‡πÑ‡∏õ‡∏¢‡∏±‡∏á supervisors
        // ‡πÅ‡∏•‡∏∞‡∏à‡∏∞‡∏™‡πà‡∏á 'status_updated' event ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
        
      } else {
        // ==========================================
        // METHOD 2: HTTP FALLBACK
        // ==========================================
        /**
         * WebSocket ‡πÑ‡∏°‡πà available
         * ‡πÉ‡∏ä‡πâ HTTP API ‡πÅ‡∏ó‡∏ô (reliable ‡πÅ‡∏ï‡πà‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤)
         */
        logger.log('WebSocket not connected, using HTTP API fallback');
        
        // API call: PUT /api/agents/:agentCode/status
        await updateAgentStatus(agent.agentCode, newStatus);
        
        logger.log('Status updated via HTTP API');
        // ‚úÖ Success via HTTP
      }
      
    } catch (error) {
      // ==========================================
      // ERROR HANDLING
      // ==========================================
      logger.error('Status update failed:', error);
      
      // Revert to previous status
      setStatus(previousStatus);
      
      // Show error to user
      setError('Failed to update status. Please try again.');
      
      // Auto-clear error after 3 seconds
      setTimeout(() => setError(null), 3000);
    }
  }, [agent, status]); // Dependencies

  // ===========================================
  // 10. ERROR CLEAR HANDLER
  // ===========================================
  /**
   * clearError()
   * ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error
   * 
   * Called from: Error banner close button
   */
  const clearError = useCallback(() => {
    setError(null);
  }, []); // No dependencies

  // ===========================================
  // 11. RENDER
  // ===========================================
  return (
    <div className="app">
      
      {/* ==========================================
          CONNECTION STATUS BAR
          ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket
          ========================================== */}
      <div className={`connection-status ${connectionStatus}`}>
        <div className="status-indicator"></div>
        <span>
          {connectionStatus === 'connected' && 'Connected'}
          {connectionStatus === 'disconnected' && 'Disconnected'}
          {connectionStatus === 'error' && 'Connection Error'}
        </span>
      </div>

      {/* ==========================================
          ERROR BANNER
          ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
          ========================================== */}
      {error && (
        <div className="error-banner">
          <span>{error}</span>
          <button 
            onClick={clearError} 
            className="error-close" 
            aria-label="Close error"
          >
            √ó
          </button>
        </div>
      )}

      {/* ==========================================
          MAIN CONTENT
          ‡πÅ‡∏™‡∏î‡∏á LoginForm ‡∏´‡∏£‡∏∑‡∏≠ Dashboard ‡∏ï‡∏≤‡∏° login status
          ========================================== */}
      {!isLoggedIn ? (
        // ==========================================
        // LOGIN VIEW
        // ==========================================
        /**
         * ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login
         * 
         * Props:
         * - onLogin: callback ‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
         */
        <LoginForm onLogin={handleLogin} />
        
      ) : (
        // ==========================================
        // DASHBOARD VIEW
        // ==========================================
        /**
         * ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡πÅ‡∏•‡πâ‡∏ß
         * 
         * ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢:
         * 1. Header (AgentInfo + Logout button)
         * 2. StatusPanel (Status control)
         * 3. MessagePanel (Message list)
         */
        <div className="dashboard">
          
          {/* Dashboard Header */}
          <div className="dashboard-header">
            {/* Agent Information */}
            <AgentInfo 
              agent={agent}      // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agent
              status={status}    // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            />
            
            {/* Logout Button */}
            <button 
              onClick={handleLogout} 
              className="logout-btn"
              aria-label="Logout"
            >
              Logout
            </button>
          </div>
          
          {/* Status Control Panel */}
          <StatusPanel 
            currentStatus={status}           // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            onStatusChange={handleStatusChange}  // Handler ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            disabled={connectionStatus !== 'connected'}  // Disable ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà connected
          />
          
          {/* Message Panel */}
          <MessagePanel 
            messages={messages}        // Array ‡∏Ç‡∏≠‡∏á messages
            agentCode={agent?.agentCode}  // Agent code (optional chaining)
            loading={loadingMessages}  // Loading state
          />
        </div>
      )}
    </div>
  );
}

// ===========================================
// EXPORT
// ===========================================
export default App;

/**
 * ==============================================
 * COMPONENT LIFECYCLE SUMMARY
 * ==============================================
 * 
 * 1. MOUNT
 *    - Initialize states
 *    - Request notification permission
 *    - Render LoginForm
 * 
 * 2. LOGIN
 *    - handleLogin() called
 *    - Save token, update states
 *    - Load messages
 *    - WebSocket useEffect triggers
 *    - Connect socket
 *    - Register event handlers
 *    - Render Dashboard
 * 
 * 3. RUNTIME
 *    - Receive messages via WebSocket
 *    - Update status
 *    - Handle errors
 * 
 * 4. LOGOUT
 *    - handleLogout() called
 *    - Call logout API
 *    - WebSocket cleanup triggers
 *    - Unregister handlers
 *    - Disconnect socket
 *    - Clear states
 *    - Render LoginForm
 * 
 * 5. UNMOUNT
 *    - All useEffect cleanups run
 *    - Socket disconnected
 *    - Resources freed
 */
```

---

## 4.4 State Management Best Practices

### Why use useCallback?

```javascript
/**
 * WITHOUT useCallback
 * ‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Function ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà render
 */
function App() {
  const [count, setCount] = useState(0);
  
  // Function ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á = child re-render ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  const handleClick = () => {
    setCount(count + 1);
  };
  
  return <ChildComponent onClick={handleClick} />;
}

/**
 * WITH useCallback
 * ‚úÖ ‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤: Function stable = child ‡πÑ‡∏°‡πà re-render ‡∏ñ‡πâ‡∏≤ props ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
 */
function App() {
  const [count, setCount] = useState(0);
  
  // Function ‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤ dependencies ‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
  const handleClick = useCallback(() => {
    setCount(prev => prev + 1); // ‡πÉ‡∏ä‡πâ functional update
  }, []); // Empty deps = never changes
  
  return <ChildComponent onClick={handleClick} />;
}
```

### Why use useRef for isLoggedIn?

```javascript
/**
 * ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Stale Closure
 */
function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  
  useEffect(() => {
    const socket = io();
    
    // ‚ùå Handler ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏î‡πâ isLoggedIn = false ‡∏ï‡∏•‡∏≠‡∏î
    // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏õ‡πá‡∏ô closure ‡∏Ç‡∏≠‡∏á initial render
    socket.on('message', (msg) => {
      if (isLoggedIn) {  // ‡πÄ‡∏õ‡πá‡∏ô false ‡πÄ‡∏™‡∏°‡∏≠!
        console.log(msg);
      }
    });
    
    return () => socket.disconnect();
  }, []); // Empty deps = run once
  
  // ‡∏ï‡πà‡∏≠‡∏°‡∏≤ isLoggedIn ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô true
  // ‡πÅ‡∏ï‡πà handler ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤
}

/**
 * ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏î‡πâ‡∏ß‡∏¢ useRef
 */
function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const isLoggedInRef = useRef(false);
  
  // Sync ref with state
  useEffect(() => {
    isLoggedInRef.current = isLoggedIn;
  }, [isLoggedIn]);
  
  useEffect(() => {
    const socket = io();
    
    // ‚úÖ ‡πÉ‡∏ä‡πâ ref = ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠
    socket.on('message', (msg) => {
      if (isLoggedInRef.current) {  // ‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î!
        console.log(msg);
      }
    });
    
    return () => socket.disconnect();
  }, []);
}
```

### Optimistic Updates Pattern

```javascript
/**
 * Optimistic Update Pattern
 * ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡πà‡∏á request
 * ‡∏ó‡∏≥‡πÉ‡∏´‡πâ UI ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å fast ‡πÅ‡∏•‡∏∞ responsive
 */

const handleStatusChange = async (newStatus) => {
  const previousStatus = status;
  
  // 1. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Optimistic)
  setStatus(newStatus);
  
  try {
    // 2. ‡∏™‡πà‡∏á request
    await updateStatus(newStatus);
    // ‚úÖ Success - UI ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
    
  } catch (error) {
    // ‚ùå Error - Revert ‡∏Å‡∏•‡∏±‡∏ö
    setStatus(previousStatus);
    showError('Update failed');
  }
};

/**
 * ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ Optimistic Updates?
 * 
 * ‚úÖ ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
 * - Operation ‡∏°‡∏µ success rate ‡∏™‡∏π‡∏á
 * - User expect immediate feedback
 * - Error ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ revert ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢
 * 
 * ‚ùå ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
 * - Operation ‡∏°‡∏µ side effects ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
 * - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ revert ‡πÑ‡∏î‡πâ
 * - Need confirmation ‡∏Å‡πà‡∏≠‡∏ô
 */
```

---

## 4.5 Error Handling Strategy

### Error Categories

```javascript
/**
 * 1. Network Errors (‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ backend)
 * - ‡πÅ‡∏™‡∏î‡∏á connection status
 * - ‡πÉ‡∏´‡πâ retry
 * - Graceful degradation
 */

/**
 * 2. Authentication Errors (token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏)
 * - Auto logout
 * - Redirect to login
 * - Clear sensitive data
 */

/**
 * 3. Validation Errors (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
 * - ‡πÅ‡∏™‡∏î‡∏á error ‡∏Ç‡πâ‡∏≤‡∏á input
 * - ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á request
 * - ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡πà‡∏≠‡∏ô
 */

/**
 * 4. Server Errors (backend error)
 * - ‡πÅ‡∏™‡∏î‡∏á error message
 * - Log for debugging
 * - ‡πÉ‡∏´‡πâ retry
 */

/**
 * 5. Unexpected Errors (bugs)
 * - ErrorBoundary ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
 * - Show fallback UI
 * - Log to monitoring service
 */
```

### Error Display Strategy

```javascript
/**
 * Error Display Hierarchy
 */

// 1. Inline Errors (‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ö input)
<input />
{error && <span className="error">{error}</span>}

// 2. Banner Errors (‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î)
{error && (
  <div className="error-banner">
    {error}
    <button onClick={clearError}>√ó</button>
  </div>
)}

// 3. Modal Errors (critical, block UI)
{criticalError && (
  <Modal>
    <h2>Error</h2>
    <p>{criticalError}</p>
    <button onClick={handleFix}>Fix</button>
  </Modal>
)}

// 4. Toast Notifications (temporary)
{toast && (
  <Toast autoHide={3000}>
    {toast.message}
  </Toast>
)}
```

---

# Section 5: Components ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

<a name="section-5"></a>

## 5.1 ErrorBoundary Component

### ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Error Boundary

```
Error Boundary Concept
‚îú‚îÄ‚îÄ Wraps Component Tree
‚îú‚îÄ‚îÄ Catches JavaScript Errors
‚îú‚îÄ‚îÄ Logs Error Information
‚îú‚îÄ‚îÄ Displays Fallback UI
‚îî‚îÄ‚îÄ Prevents Entire App Crash

Without Error Boundary:
Error ‚Üí White Screen ‚Üí Bad UX

With Error Boundary:
Error ‚Üí Fallback UI ‚Üí Good UX
```

### üìÑ src/components/ErrorBoundary.js

```javascript
/**
 * ==============================================
 * ERROR BOUNDARY COMPONENT
 * ==============================================
 * 
 * React Error Boundary ‡πÄ‡∏õ‡πá‡∏ô Class Component
 * ‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö errors ‡πÉ‡∏ô component tree
 * 
 * ‡∏à‡∏±‡∏ö errors:
 * ‚úÖ Rendering errors
 * ‚úÖ Lifecycle method errors
 * ‚úÖ Constructor errors
 * 
 * ‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö errors:
 * ‚ùå Event handlers (‡πÉ‡∏ä‡πâ try-catch ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤)
 * ‚ùå Async code (‡πÉ‡∏ä‡πâ .catch())
 * ‚ùå Server-side rendering
 * ‚ùå Errors ‡πÉ‡∏ô Error Boundary ‡πÄ‡∏≠‡∏ág
 * 
 * @see https://react.dev/reference/react/Component#catching-rendering-errors-with-an-error-boundary
 */

import React from 'react';

class ErrorBoundary extends React.Component {
  
  // ===========================================
  // CONSTRUCTOR
  // ===========================================
  /**
   * Initialize state
   * 
   * @param {Object} props - Component props
   */
  constructor(props) {
    super(props);
    
    // State ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö error information
    this.state = { 
      hasError: false,      // ‡∏°‡∏µ error ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      error: null,          // Error object
      errorInfo: null       // Error info (component stack)
    };
  }

  // ===========================================
  // STATIC METHOD: getDerivedStateFromError
  // ===========================================
  /**
   * Update state ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î error
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Å‡πà‡∏≠‡∏ô render fallback UI
   * 
   * ‚ö†Ô∏è ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ side effects ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡πÑ‡∏°‡πà‡∏°‡∏µ logging)
   * ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö update state ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
   * 
   * @param {Error} error - Error object ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô
   * @returns {Object} New state
   * 
   * @static
   */
  static getDerivedStateFromError(error) {
    // Update state ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á fallback UI
    return { 
      hasError: true, 
      error 
    };
  }

  // ===========================================
  // LIFECYCLE: componentDidCatch
  // ===========================================
  /**
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å render fallback UI
   * ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö side effects (logging)
   * 
   * @param {Error} error - Error object
   * @param {Object} errorInfo - Component stack trace
   * 
   * errorInfo.componentStack ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
   * ```
   * in ComponentThatThrows (created by App)
   * in ErrorBoundary (created by App)
   * in div (created by App)
   * in App
   * ```
   */
  componentDidCatch(error, errorInfo) {
    // Log error details to console
    console.error('ErrorBoundary caught an error:', error, errorInfo);
    
    // Update state with error info
    this.setState({
      error,
      errorInfo
    });
    
    // TODO: Send to error tracking service
    // Example with Sentry:
    // Sentry.captureException(error, { extra: errorInfo });
    
    // Example with custom API:
    // fetch('/api/errors', {
    //   method: 'POST',
    //   body: JSON.stringify({
    //     error: error.toString(),
    //     stack: error.stack,
    //     componentStack: errorInfo.componentStack
    //   })
    // });
  }

  // ===========================================
  // HANDLER: handleReload
  // ===========================================
  /**
   * Reload entire application
   * ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç error ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏ì‡∏µ
   */
  handleReload = () => {
    window.location.reload();
  };

  // ===========================================
  // HANDLER: handleReset
  // ===========================================
  /**
   * Reset error boundary state
   * ‡∏•‡∏≠‡∏á render children ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
   * 
   * ‚ö†Ô∏è ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç error ‡∏ñ‡πâ‡∏≤ error ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å:
   * - Props ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ú‡∏¥‡∏î
   * - External state ‡∏ú‡∏¥‡∏î
   */
  handleReset = () => {
    this.setState({
      hasError: false,
      error: null,
      errorInfo: null
    });
  };

  // ===========================================
  // RENDER
  // ===========================================
  /**
   * Render logic:
   * - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ error ‚Üí ‡πÅ‡∏™‡∏î‡∏á fallback UI
   * - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ error ‚Üí ‡πÅ‡∏™‡∏î‡∏á children ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
   */
  render() {
    if (this.state.hasError) {
      // ===========================================
      // FALLBACK UI (Error Screen)
      // ===========================================
      return (
        <div style={{
          minHeight: '100vh',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
          padding: '20px'
        }}>
          <div style={{
            background: 'white',
            padding: '40px',
            borderRadius: '16px',
            maxWidth: '500px',
            width: '100%',
            textAlign: 'center',
            boxShadow: '0 10px 40px rgba(0,0,0,0.2)'
          }}>
            
            {/* Error Icon */}
            <div style={{ 
              fontSize: '48px', 
              marginBottom: '20px' 
            }}>
              ‚ö†Ô∏è
            </div>
            
            {/* Error Title */}
            <h2 style={{ 
              margin: '0 0 16px 0',
              color: '#333',
              fontSize: '24px'
            }}>
              Something went wrong
            </h2>
            
            {/* Error Message */}
            <p style={{ 
              color: '#666', 
              fontSize: '14px',
              marginBottom: '24px',
              lineHeight: '1.6'
            }}>
              The application encountered an unexpected error. 
              Please try reloading the application.
            </p>
            
            {/* Error Details (Collapsible) */}
            {this.state.error && (
              <details style={{
                marginBottom: '24px',
                textAlign: 'left',
                background: '#f5f5f5',
                padding: '12px',
                borderRadius: '8px',
                fontSize: '12px',
                maxHeight: '150px',
                overflow: 'auto'
              }}>
                <summary style={{ 
                  cursor: 'pointer',
                  fontWeight: '600',
                  marginBottom: '8px',
                  color: '#666'
                }}>
                  Error Details
                </summary>
                
                {/* Error Message and Stack */}
                <pre style={{ 
                  margin: 0,
                  whiteSpace: 'pre-wrap',
                  wordBreak: 'break-word',
                  color: '#d32f2f'
                }}>
                  {/* Error name and message */}
                  {this.state.error.toString()}
                  
                  {/* Component stack (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) */}
                  {this.state.errorInfo && 
                   this.state.errorInfo.componentStack}
                </pre>
              </details>
            )}
            
            {/* Action Buttons */}
            <div style={{
              display: 'flex',
              gap: '12px',
              justifyContent: 'center'
            }}>
              
              {/* Reload Button */}
              <button 
                onClick={this.handleReload}
                style={{
                  padding: '12px 24px',
                  background: '#667eea',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  transition: 'all 0.2s'
                }}
                onMouseOver={(e) => {
                  e.target.style.background = '#5568d3';
                }}
                onMouseOut={(e) => {
                  e.target.style.background = '#667eea';
                }}
              >
                Reload Application
              </button>
              
              {/* Try Again Button */}
              <button 
                onClick={this.handleReset}
                style={{
                  padding: '12px 24px',
                  background: '#f0f0f0',
                  color: '#333',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '600',
                  cursor: 'pointer',
                  transition: 'all 0.2s'
                }}
                onMouseOver={(e) => {
                  e.target.style.background = '#e0e0e0';
                }}
                onMouseOut={(e) => {
                  e.target.style.background = '#f0f0f0';
                }}
              >
                Try Again
              </button>
            </div>
          </div>
        </div>
      );
    }

    // ===========================================
    // NORMAL RENDER (No Error)
    // ===========================================
    /**
     * ‡πÑ‡∏°‡πà‡∏°‡∏µ error ‚Üí render children ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
     */
    return this.props.children;
  }
}

export default ErrorBoundary;

/**
 * ==============================================
 * USAGE EXAMPLES
 * ==============================================
 */

/**
 * Example 1: Wrap entire app
 * ```jsx
 * <ErrorBoundary>
 *   <App />
 * </ErrorBoundary>
 * ```
 */

/**
 * Example 2: Wrap specific routes
 * ```jsx
 * <Router>
 *   <ErrorBoundary>
 *     <Route path="/dashboard" component={Dashboard} />
 *   </ErrorBoundary>
 *   <ErrorBoundary>
 *     <Route path="/settings" component={Settings} />
 *   </ErrorBoundary>
 * </Router>
 * ```
 */

/**
 * Example 3: Multiple boundaries with different fallbacks
 * ```jsx
 * <ErrorBoundary fallback={<MainErrorUI />}>
 *   <Header />
 *   <ErrorBoundary fallback={<SidebarError />}>
 *     <Sidebar />
 *   </ErrorBoundary>
 *   <ErrorBoundary fallback={<ContentError />}>
 *     <Content />
 *   </ErrorBoundary>
 * </ErrorBoundary>
 * ```
 */

/**
 * ==============================================
 * TESTING ERROR BOUNDARY
 * ==============================================
 */

/**
 * Create a component that throws error:
 * ```jsx
 * function BuggyComponent() {
 *   throw new Error('Test error!');
 *   return <div>Never rendered</div>;
 * }
 * 
 * // Use it to test
 * <ErrorBoundary>
 *   <BuggyComponent />
 * </ErrorBoundary>
 * ```
 */

/**
 * Test with button click:
 * ```jsx
 * function BuggyButton() {
 *   const [shouldThrow, setShouldThrow] = useState(false);
 *   
 *   if (shouldThrow) {
 *     throw new Error('Button clicked!');
 *   }
 *   
 *   return (
 *     <button onClick={() => setShouldThrow(true)}>
 *       Throw Error
 *     </button>
 *   );
 * }
 * ```
 */
```

---

## 5.2 LoginForm Component

### Login Flow Diagram

```
LoginForm Flow
‚îú‚îÄ‚îÄ 1. Component Mount
‚îÇ   ‚îî‚îÄ‚îÄ Check server health
‚îÇ
‚îú‚îÄ‚îÄ 2. User Input
‚îÇ   ‚îú‚îÄ‚îÄ Type agent code
‚îÇ   ‚îú‚îÄ‚îÄ Validate format (AG001)
‚îÇ   ‚îî‚îÄ‚îÄ Enable/disable submit
‚îÇ
‚îú‚îÄ‚îÄ 3. Submit
‚îÇ   ‚îú‚îÄ‚îÄ Validate input
‚îÇ   ‚îú‚îÄ‚îÄ Call login API
‚îÇ   ‚îú‚îÄ‚îÄ Show loading state
‚îÇ   ‚îî‚îÄ‚îÄ Handle response
‚îÇ
‚îî‚îÄ‚îÄ 4. Result
    ‚îú‚îÄ‚îÄ Success ‚Üí Call onLogin callback
    ‚îî‚îÄ‚îÄ Error ‚Üí Show error message
```

### üìÑ src/components/LoginForm.js

```javascript
/**
 * ==============================================
 * LOGIN FORM COMPONENT
 * ==============================================
 * 
 * Form ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö login ‡∏î‡πâ‡∏ß‡∏¢ Agent Code
 * 
 * Features:
 * - Server health check
 * - Input validation
 * - Loading state
 * - Error handling
 * - Retry mechanism
 * 
 * Props:
 * - onLogin: (agentData, token) => void
 */

import React, { useState, useEffect } from 'react';
import { loginAgent, checkServerHealth } from '../services/api';
import { validateAgentCode } from '../utils/validation';

function LoginForm({ onLogin }) {
  
  // ===========================================
  // STATE
  // ===========================================
  
  // Input value
  const [agentCode, setAgentCode] = useState('');
  
  // Loading state (submitting form)
  const [loading, setLoading] = useState(false);
  
  // Error message
  const [error, setError] = useState('');
  
  // Server status
  const [serverStatus, setServerStatus] = useState('unknown');
  // Values: 'online' | 'offline' | 'unknown'

  // ===========================================
  // EFFECT: CHECK SERVER HEALTH ON MOUNT
  // ===========================================
  /**
   * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ backend server ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏≠‡∏ô mount
   */
  useEffect(() => {
    checkHealth();
  }, []);

  // ===========================================
  // FUNCTION: CHECK HEALTH
  // ===========================================
  /**
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å health check API
   * 
   * Endpoint: GET /health
   * Response: { status: 'OK', timestamp, ... }
   */
  const checkHealth = async () => {
    try {
      await checkServerHealth();
      setServerStatus('online');
      setError(''); // Clear previous errors
      
    } catch (error) {
      setServerStatus('offline');
      setError('Backend server is not running. Please start the server first.');
    }
  };

  // ===========================================
  // HANDLER: FORM SUBMIT
  // ===========================================
  /**
   * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£ submit form
   * 
   * Flow:
   * 1. Prevent default form submit
   * 2. Validate input
   * 3. Call login API
   * 4. Handle response
   * 5. Call onLogin callback or show error
   * 
   * @param {Event} e - Form submit event
   */
  const handleSubmit = async (e) => {
    e.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô page reload
    
    // ===========================================
    // VALIDATION
    // ===========================================
    /**
     * Validate agent code format
     * Expected: AG001, SP001, etc.
     */
    const validationError = validateAgentCode(agentCode);
    if (validationError) {
      setError(validationError);
      return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏ñ‡πâ‡∏≤ validation ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô
    }

    // ===========================================
    // SUBMIT
    // ===========================================
    setLoading(true);
    setError(''); // Clear previous errors

    try {
      // API call: POST /api/auth/login
      const result = await loginAgent(agentCode.toUpperCase());
      
      // ===========================================
      // SUCCESS
      // ===========================================
      if (result.success) {
        /**
         * result.data structure:
         * {
         *   user: { agentCode, agentName, ... },
         *   token: 'jwt-token-string'
         * }
         */
        
        // Call parent callback with user data and token
        onLogin(result.data.user, result.data.token);
        
        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Component ‡∏à‡∏∞ unmount ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ
        // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ App.js ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á Dashboard ‡πÅ‡∏ó‡∏ô
        
      } else {
        // ===========================================
        // API ERROR
        // ===========================================
        setError(result.error || 'Login failed');
      }
      
    } catch (err) {
      // ===========================================
      // NETWORK ERROR
      // ===========================================
      console.error('Login error:', err);
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó error
      if (err.message.includes('fetch')) {
        // Fetch API error = ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ server
        setError('Cannot connect to server. Please check if backend is running.');
        setServerStatus('offline');
        
      } else {
        // Error ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
        setError(err.message || 'Network error. Please check your connection.');
      }
      
    } finally {
      // ===========================================
      // CLEANUP
      // ===========================================
      setLoading(false); // Clear loading state ‡πÄ‡∏™‡∏°‡∏≠
    }
  };

  // ===========================================
  // HANDLER: RETRY CONNECTION
  // ===========================================
  /**
   * ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ server ‡πÉ‡∏´‡∏°‡πà
   */
  const handleRetry = () => {
    setError('');
    checkHealth();
  };

  // ===========================================
  // RENDER
  // ===========================================
  return (
    <div className="login-container">
      <div className="login-form">
        
        {/* ===========================================
            HEADER
            =========================================== */}
        <div className="login-header">
          <h2>Agent Login</h2>
          <p>Enter your agent code to continue</p>
          
          {/* Server Status Indicator */}
          <div className={`server-status ${serverStatus}`}>
            <span className="status-dot"></span>
            <span>Server: {serverStatus}</span>
          </div>
        </div>
        
        {/* ===========================================
            FORM
            =========================================== */}
        <form onSubmit={handleSubmit}>
          
          {/* Input Group */}
          <div className="form-group">
            <label htmlFor="agentCode">Agent Code</label>
            <input
              id="agentCode"
              type="text"
              placeholder="e.g., AG001"
              value={agentCode}
              onChange={(e) => {
                // Convert to uppercase ‡πÅ‡∏•‡∏∞ clear error
                setAgentCode(e.target.value.toUpperCase());
                if (error) setError(''); // Clear error on input
              }}
              disabled={loading || serverStatus === 'offline'}
              maxLength={5} // AG001 = 5 characters
              autoFocus     // Focus ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏û‡∏≠ component ‡πÇ‡∏´‡∏•‡∏î
            />
          </div>
          
          {/* Submit Button */}
          <button 
            type="submit" 
            disabled={
              loading || 
              !agentCode.trim() ||  // ‡∏´‡πâ‡∏≤‡∏° submit ‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á
              serverStatus === 'offline'
            }
            className="login-btn"
          >
            {loading ? 'Signing in...' : 'Sign In'}
          </button>
          
          {/* ===========================================
              ERROR MESSAGE
              =========================================== */}
          {error && (
            <div className="error-message">
              <span>‚ö†Ô∏è</span> {error}
              
              {/* Retry Button (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ server offline) */}
              {serverStatus === 'offline' && (
                <button 
                  type="button" 
                  onClick={handleRetry} 
                  className="retry-btn"
                >
                  Retry Connection
                </button>
              )}
            </div>
          )}
        </form>
        
        {/* ===========================================
            FOOTER (Help Text)
            =========================================== */}
        <div className="login-footer">
          <p>Sample codes: AG001, AG002, AG003</p>
          <p className="help-text">
            Need help? Check if backend server is running on port 3001
          </p>
        </div>
        
      </div>
    </div>
  );
}

export default LoginForm;

/**
 * ==============================================
 * VALIDATION RULES
 * ==============================================
 * 
 * Agent Code Format: ^[A-Z]{2}\d{3}$
 * 
 * Examples:
 * ‚úÖ AG001 - Valid
 * ‚úÖ SP001 - Valid
 * ‚úÖ TL001 - Valid
 * ‚ùå AG01 - Too short
 * ‚ùå AGT001 - Too many letters
 * ‚ùå ag001 - Lowercase (auto-convert)
 * ‚ùå A1001 - Wrong pattern
 */

/**
 * ==============================================
 * ACCESSIBILITY FEATURES
 * ==============================================
 * 
 * 1. Label with htmlFor - Screen reader support
 * 2. autoFocus - Keyboard users
 * 3. Disabled states - Prevent invalid submission
 * 4. Error messages - Clear feedback
 * 5. Loading states - Visual feedback
 */

/**
 * ==============================================
 * ERROR HANDLING STRATEGY
 * ==============================================
 * 
 * 1. Validation Errors (Client-side)
 *    - ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á request
 *    - Immediate feedback
 *    - ‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏µ‡∏¢ network request
 * 
 * 2. API Errors (Server response)
 *    - Invalid credentials
 *    - Account locked
 *    - Server errors
 * 
 * 3. Network Errors (Connection failed)
 *    - Server offline
 *    - No internet
 *    - Timeout
 * 
 * 4. Unexpected Errors
 *    - Caught by ErrorBoundary
 */
```

---

## 5.3 AgentInfo Component

### üìÑ src/components/AgentInfo.js

```javascript
/**
 * ==============================================
 * AGENT INFO COMPONENT
 * ==============================================
 * 
 * ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Agent ‡∏ó‡∏µ‡πà login ‡∏≠‡∏¢‡∏π‡πà
 * 
 * Features:
 * - Avatar display
 * - Agent name and code
 * - Team information
 * - Current status indicator
 * 
 * Props:
 * - agent: { agentCode, agentName, teamId, teamName, ... }
 * - status: 'Available' | 'Busy' | 'Break' | 'Offline'
 */

import React from 'react';

function AgentInfo({ agent, status }) {
  
  // ===========================================
  // GUARD: NULL CHECK
  // ===========================================
  /**
   * ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• agent ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏∞‡πÑ‡∏£
   * ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô error ‡∏à‡∏≤‡∏Å undefined properties
   */
  if (!agent) return null;

  // ===========================================
  // HELPER: GET STATUS COLOR
  // ===========================================
  /**
   * ‡πÅ‡∏õ‡∏•‡∏á status ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ
   * ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö status indicator dot
   * 
   * @param {string} status - Status name
   * @returns {string} Hex color code
   */
  const getStatusColor = (status) => {
    const colors = {
      Available: '#4CAF50',  // Green
      Busy: '#FF9800',       // Orange
      Break: '#2196F3',      // Blue
      Offline: '#9E9E9E'     // Gray
    };
    return colors[status] || colors.Offline;
  };

  // ===========================================
  // RENDER
  // ===========================================
  return (
    <div className="agent-info">
      
      {/* ===========================================
          AVATAR
          Simple emoji-based avatar
          ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏à‡∏£‡∏¥‡∏á‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ image ‡∏´‡∏£‡∏∑‡∏≠ initials
          =========================================== */}
      <div className="agent-avatar">
        <span>üë§</span>
      </div>
      
      {/* ===========================================
          AGENT DETAILS
          =========================================== */}
      <div className="agent-details">
        
        {/* Agent Name */}
        <h3 className="agent-name">
          {agent.agentName}
        </h3>
        
        {/* Meta Information (Code & Team) */}
        <div className="agent-meta">
          
          {/* Agent Code */}
          <div className="agent-code">
            <span className="label">Code:</span>
            <span className="value">{agent.agentCode}</span>
          </div>
          
          {/* Team Name */}
          <div className="agent-team">
            <span className="label">Team:</span>
            <span className="value">
              {agent.teamName || 'N/A'}
            </span>
          </div>
        </div>
        
        {/* Current Status */}
        <div className="agent-status">
          {/* Status Indicator Dot */}
          <span 
            className="status-dot"
            style={{ 
              backgroundColor: getStatusColor(status) 
            }}
          ></span>
          
          {/* Status Text */}
          <span className="status-text">{status}</span>
        </div>
      </div>
      
    </div>
  );
}

export default AgentInfo;

/**
 * ==============================================
 * COMPONENT STRUCTURE
 * ==============================================
 * 
 * agent-info
 * ‚îú‚îÄ‚îÄ agent-avatar (üë§)
 * ‚îî‚îÄ‚îÄ agent-details
 *     ‚îú‚îÄ‚îÄ agent-name (John Doe)
 *     ‚îú‚îÄ‚îÄ agent-meta
 *     ‚îÇ   ‚îú‚îÄ‚îÄ agent-code (AG001)
 *     ‚îÇ   ‚îî‚îÄ‚îÄ agent-team (Sales Team)
 *     ‚îî‚îÄ‚îÄ agent-status
 *         ‚îú‚îÄ‚îÄ status-dot (‚óè)
 *         ‚îî‚îÄ‚îÄ status-text (Available)
 */

/**
 * ==============================================
 * STYLING CONSIDERATIONS
 * ==============================================
 * 
 * CSS ‡∏Ñ‡∏ß‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£:
 * 1. Responsive layout (mobile-friendly)
 * 2. Text overflow (ellipsis for long names)
 * 3. Status color transitions
 * 4. Accessibility (contrast ratios)
 */

/**
 * ==============================================
 * POSSIBLE ENHANCEMENTS
 * ==============================================
 * 
 * 1. Profile Picture
 *    - Upload avatar image
 *    - Use initials as fallback
 *    - Gravatar integration
 * 
 * 2. Additional Info
 *    - Email (on hover/click)
 *    - Phone extension
 *    - Role badge
 *    - Online duration
 * 
 * 3. Status Animation
 *    - Pulse animation for status dot
 *    - Transition effects
 * 
 * 4. Dropdown Menu
 *    - Profile settings
 *    - View history
 *    - Change password
 */
```

---

## 5.4 StatusPanel Component

### Status Update Strategy

```
Status Update Flow
‚îú‚îÄ‚îÄ User clicks status button
‚îú‚îÄ‚îÄ Optimistic UI update (immediate)
‚îú‚îÄ‚îÄ Send via WebSocket (fast)
‚îÇ   ‚îú‚îÄ‚îÄ Success ‚Üí Done
‚îÇ   ‚îî‚îÄ‚îÄ Fail ‚Üí HTTP Fallback
‚îî‚îÄ‚îÄ Update MongoDB (backend)
```

### üìÑ src/components/StatusPanel.js

```javascript
/**
 * ==============================================
 * STATUS PANEL COMPONENT
 * ==============================================
 * 
 * Panel ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á Agent
 * 
 * Features:
 * - 4 status buttons (Available, Busy, Break, Offline)
 * - Visual feedback (active state)
 * - Disabled state (when not connected)
 * - Icon + Label design
 * 
 * Props:
 * - currentStatus: string - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
 * - onStatusChange: (newStatus) => void - Callback
 * - disabled: boolean - ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
 */

import React from 'react';

function StatusPanel({ currentStatus, onStatusChange, disabled = false }) {
  
  // ===========================================
  // STATUS DEFINITIONS
  // ===========================================
  /**
   * ‡∏Å‡∏≥‡∏´‡∏ô‡∏î statuses ‡∏ó‡∏µ‡πà‡∏°‡∏µ
   * ‡πÅ‡∏ï‡πà‡∏•‡∏∞ status ‡∏°‡∏µ:
   * - key: ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô value
   * - label: ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô button
   * - color: ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á button
   * - icon: emoji icon
   */
  const statuses = [
    { 
      key: 'Available', 
      label: 'Available', 
      color: '#4CAF50',  // Green
      icon: '‚úì' 
    },
    { 
      key: 'Busy', 
      label: 'Busy', 
      color: '#FF9800',  // Orange
      icon: '‚è±' 
    },
    { 
      key: 'Break', 
      label: 'Break', 
      color: '#2196F3',  // Blue
      icon: '‚òï' 
    },
    { 
      key: 'Offline', 
      label: 'Offline', 
      color: '#9E9E9E',  // Gray
      icon: '‚è∏' 
    }
  ];

  // ===========================================
  // RENDER
  // ===========================================
  return (
    <div className="status-panel">
      
      {/* ===========================================
          HEADER
          =========================================== */}
      <div className="status-header">
        <h3>Status Control</h3>
        
        {/* Current Status Badge */}
        <div className="current-status">
          Current: 
          <span 
            className="status-badge" 
            style={{ 
              backgroundColor: statuses.find(
                s => s.key === currentStatus
              )?.color 
            }}
          >
            {currentStatus}
          </span>
        </div>
      </div>
      
      {/* ===========================================
          STATUS BUTTONS GRID
          2x2 grid layout
          =========================================== */}
      <div className="status-buttons">
        {statuses.map(status => (
          <button
            key={status.key}
            
            // Classes for styling
            className={`status-btn ${
              status.key === currentStatus ? 'active' : ''
            }`}
            
            // Click handler
            onClick={() => onStatusChange(status.key)}
            
            // Disabled state
            disabled={disabled}
            
            // Inline styles (dynamic color)
            style={{ 
              backgroundColor: status.color,
              opacity: disabled 
                ? 0.5 
                : (status.key === currentStatus ? 1 : 0.8)
            }}
            
            // Accessibility
            aria-label={`Set status to ${status.label}`}
            aria-pressed={status.key === currentStatus}
          >
            {/* Icon */}
            <span className="status-icon">{status.icon}</span>
            
            {/* Label */}
            <span className="status-label">{status.label}</span>
          </button>
        ))}
      </div>
      
      {/* ===========================================
          WARNING MESSAGE (when disabled)
          =========================================== */}
      {disabled && (
        <div className="status-warning">
          ‚ö†Ô∏è Not connected to server - Status updates unavailable
        </div>
      )}
      
    </div>
  );
}

export default StatusPanel;

/**
 * ==============================================
 * COMPONENT BEHAVIOR
 * ==============================================
 * 
 * Active Button:
 * - Higher opacity (1.0)
 * - Scale effect (CSS transform)
 * - White border (CSS box-shadow)
 * 
 * Inactive Button:
 * - Lower opacity (0.8)
 * - Hover effect (darker)
 * - Click effect (scale down)
 * 
 * Disabled State:
 * - All buttons 50% opacity
 * - No hover effects
 * - Cursor: not-allowed
 * - Warning message shown
 */

/**
 * ==============================================
 * ACCESSIBILITY FEATURES
 * ==============================================
 * 
 * 1. aria-label
 *    - Screen readers announce button purpose
 *    - Example: "Set status to Available"
 * 
 * 2. aria-pressed
 *    - Indicates which button is active
 *    - true = current status
 *    - false = other statuses
 * 
 * 3. disabled attribute
 *    - Prevents clicks when not connected
 *    - Screen readers announce disabled state
 * 
 * 4. Visual feedback
 *    - Color coding (don't rely on color alone)
 *    - Icons provide additional context
 *    - Text labels are clear
 */

/**
 * ==============================================
 * STATUS MEANINGS
 * ==============================================
 * 
 * Available (Green ‚úì)
 * - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
 * - ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö calls ‡πÑ‡∏î‡πâ
 * - Default status ‡∏´‡∏•‡∏±‡∏á login
 * 
 * Busy (Orange ‚è±)
 * - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
 * - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
 * - After Call Work (ACW)
 * 
 * Break (Blue ‚òï)
 * - ‡∏û‡∏±‡∏Å‡πÄ‡∏ö‡∏£‡∏Å
 * - ‡∏ó‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß, ‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥
 * - ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
 * 
 * Offline (Gray ‚è∏)
 * - ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß
 * - ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏≠‡∏≠‡∏Å
 * - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤
 */

/**
 * ==============================================
 * POSSIBLE ENHANCEMENTS
 * ==============================================
 * 
 * 1. Custom Statuses
 *    - ‡πÉ‡∏´‡πâ admin ‡πÄ‡∏û‡∏¥‡πà‡∏° status ‡πÄ‡∏≠‡∏á
 *    - ‡πÄ‡∏ä‡πà‡∏ô "Training", "Meeting"
 * 
 * 2. Status Duration
 *    - ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô status ‡∏ô‡∏±‡πâ‡∏ô
 *    - "Available for 15m"
 * 
 * 3. Auto Status
 *    - Auto Busy ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ call
 *    - Auto Available ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö call
 * 
 * 4. Status History
 *    - ‡πÅ‡∏™‡∏î‡∏á timeline ‡∏Ç‡∏≠‡∏á status changes
 *    - Export report
 * 
 * 5. Scheduled Status
 *    - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏ß‡∏•‡∏≤ break ‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤
 *    - Auto change status ‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
 */
```

---

## 5.5 MessagePanel Component

### Message Display Strategy

```
MessagePanel Architecture
‚îú‚îÄ‚îÄ Header (Title + Unread count)
‚îú‚îÄ‚îÄ Message List (Scrollable)
‚îÇ   ‚îú‚îÄ‚îÄ Each Message Card
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ From info
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Priority indicator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Content
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Meta (time, type)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Mark as read button
‚îÇ   ‚îî‚îÄ‚îÄ Auto-scroll to bottom
‚îî‚îÄ‚îÄ Empty state (No messages)
```

### üìÑ src/components/MessagePanel.js (Part 1)

```javascript
/**
 * ==============================================
 * MESSAGE PANEL COMPONENT
 * ==============================================
 * 
 * ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà Agent ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
 * 
 * Features:
 * - Message list (scrollable)
 * - Unread indicator
 * - Mark as read
 * - Priority colors
 * - Auto-scroll to new messages
 * - Loading state
 * - Empty state
 * 
 * Props:
 * - messages: Array<Message> - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
 * - agentCode: string - ‡∏£‡∏´‡∏±‡∏™ agent
 * - loading: boolean - ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
 */

import React, { useEffect, useRef, useState } from 'react';
import { formatTime, getTimeAgo } from '../utils/dateUtils';
import { markMessageAsRead } from '../services/api';

function MessagePanel({ messages, agentCode, loading = false }) {
  
  // ===========================================
  // REF: MESSAGES END
  // ===========================================
  /**
   * Ref ‡πÑ‡∏õ‡∏¢‡∏±‡∏á element ‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á message list
   * ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö auto-scroll
   */
  const messagesEndRef = useRef(null);
  
  // ===========================================
  // STATE: MARKING READ
  // ===========================================
  /**
   * Set ‡∏Ç‡∏≠‡∏á message IDs ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á mark as read
   * ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ mark ‡∏ã‡πâ‡∏≥‡∏Ç‡∏ì‡∏∞‡∏£‡∏≠ API response
   */
  const [markingRead, setMarkingRead] = useState(new Set());

  // ===========================================
  // FUNCTION: SCROLL TO BOTTOM
  // ===========================================
  /**
   * Scroll ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
   * ‡πÉ‡∏ä‡πâ smooth scroll ‡πÄ‡∏û‡∏∑‡πà‡∏≠ UX ‡∏ó‡∏µ‡πà‡∏î‡∏µ
   */
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ 
      behavior: 'smooth' 
    });
  };

  // ===========================================
  // EFFECT: AUTO-SCROLL ON NEW MESSAGE
  // ===========================================
  /**
   * Scroll ‡πÑ‡∏õ‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ message ‡πÉ‡∏´‡∏°‡πà
   * Dependencies: [messages]
   */
  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  // ===========================================
  // HANDLER: MARK AS READ
  // ===========================================
  /**
   * Mark message ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
   * 
   * Flow:
   * 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á mark ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
   * 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° ID ‡πÄ‡∏Ç‡πâ‡∏≤ Set (prevent duplicate)
   * 3. Call API
   * 4. Success ‚Üí Log
   * 5. Error ‚Üí Log error
   * 6. Finally ‚Üí ‡∏•‡∏ö ID ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Set
   * 
   * @param {string} messageId - MongoDB _id
   */
  const handleMarkAsRead = async (messageId) => {
    // Guard: ‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á mark ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
    if (markingRead.has(messageId)) return;

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° ID ‡πÄ‡∏Ç‡πâ‡∏≤ Set
    setMarkingRead(prev => new Set(prev).add(messageId));

    try {
      // API call: PUT /api/messages/:messageId/read
      await markMessageAsRead(messageId);
      console.log('Message marked as read:', messageId);
      
      // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á update local state
      // ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ message ‡∏à‡∏∞ update ‡∏à‡∏≤‡∏Å WebSocket event
      // ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≤‡∏Å page refresh
      
    } catch (error) {
      console.error('Failed to mark message as read:', error);
      // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á error ‡πÉ‡∏´‡πâ user ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà critical
      
    } finally {
      // ‡∏•‡∏ö ID ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å Set
      setMarkingRead(prev => {
        const newSet = new Set(prev);
        newSet.delete(messageId);
        return newSet;
      });
    }
  };

  // ===========================================
  // HELPER: GET PRIORITY COLOR
  // ===========================================
  /**
   * ‡πÅ‡∏õ‡∏•‡∏á priority ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ
   * 
   * @param {string} priority - 'high' | 'normal' | 'low'
   * @returns {string} Hex color
   */
  const getPriorityColor = (priority) => {
    const colors = {
      high: '#f44336',    // Red
      normal: '#2196f3',  // Blue
      low: '#9e9e9e'      // Gray
    };
    return colors[priority] || colors.normal;
  };

  // ===========================================
  // COMPUTED: UNREAD COUNT
  // ===========================================
  /**
   * ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô
   */
  const unreadCount = messages.filter(m => !m.isRead).length;

  // ... (‡∏ï‡πà‡∏≠‡πÉ‡∏ô Part 2 - Render)
```

### üìÑ src/components/MessagePanel.js (Part 2: Render)

```javascript
  // ===========================================
  // RENDER
  // ===========================================
  return (
    <div className="message-panel">
      
      {/* ===========================================
          HEADER
          =========================================== */}
      <div className="message-header">
        <h3>
          Messages ({messages.length})
          
          {/* Unread Badge */}
          {unreadCount > 0 && (
            <span className="unread-badge">
              {unreadCount} unread
            </span>
          )}
        </h3>
        
        {/* Scroll to Bottom Button */}
        {messages.length > 0 && (
          <button 
            onClick={scrollToBottom}
            className="scroll-btn"
            title="Scroll to bottom"
            aria-label="Scroll to bottom"
          >
            ‚¨áÔ∏è
          </button>
        )}
      </div>
      
      {/* ===========================================
          MESSAGE LIST
          =========================================== */}
      <div className="message-list">
        
        {/* ===========================================
            LOADING STATE
            =========================================== */}
        {loading ? (
          <div className="loading-messages">
            <div className="loading-spinner"></div>
            <p>Loading messages...</p>
          </div>
          
        /* ===========================================
            EMPTY STATE (No Messages)
            =========================================== */
        ) : messages.length === 0 ? (
          <div className="no-messages">
            <div className="no-messages-icon">üì≠</div>
            <p>No messages yet</p>
            <small>Messages from supervisors will appear here</small>
          </div>
          
        /* ===========================================
            MESSAGES (Has Data)
            =========================================== */
        ) : (
          <>
            {messages.map((message, index) => (
              <div 
                key={message._id || index}
                className={`message-item ${message.type} ${
                  message.isRead ? 'read' : 'unread'
                }`}
              >
                
                {/* ===========================================
                    MESSAGE TOP (From + Priority)
                    =========================================== */}
                <div className="message-top">
                  {/* From Info */}
                  <div className="message-from">
                    <span className="from-label">From:</span>
                    <strong>{message.fromCode}</strong>
                  </div>
                  
                  {/* Priority Indicator */}
                  <div className="message-priority">
                    <span 
                      className="priority-indicator"
                      style={{ 
                        backgroundColor: getPriorityColor(message.priority) 
                      }}
                      title={`Priority: ${message.priority}`}
                      aria-label={`Priority: ${message.priority}`}
                    >
                      {/* Priority Emoji */}
                      {message.priority === 'high' ? 'üî¥' : 
                       message.priority === 'low' ? 'üîµ' : '‚ö™'}
                    </span>
                  </div>
                </div>
                
                {/* ===========================================
                    MESSAGE CONTENT
                    =========================================== */}
                <div className="message-content">
                  {message.content}
                </div>
                
                {/* ===========================================
                    MESSAGE FOOTER (Meta + Actions)
                    =========================================== */}
                <div className="message-footer">
                  
                  {/* Meta Information */}
                  <div className="message-meta">
                    {/* Message Type */}
                    <span className="message-type">
                      {message.type === 'broadcast' 
                        ? 'üì¢ Broadcast' 
                        : 'üí¨ Direct'}
                    </span>
                    
                    {/* Time */}
                    <span className="message-time">
                      {formatTime(message.timestamp)}
                    </span>
                    
                    {/* Time Ago */}
                    <span className="time-ago">
                      {getTimeAgo(message.timestamp)}
                    </span>
                  </div>
                  
                  {/* Mark as Read Button */}
                  {!message.isRead && (
                    <button
                      className="mark-read-btn"
                      onClick={() => handleMarkAsRead(message._id)}
                      disabled={markingRead.has(message._id)}
                      title="Mark as read"
                      aria-label="Mark message as read"
                    >
                      {/* Show loading or checkmark */}
                      {markingRead.has(message._id) ? '‚è≥' : '‚úì'}
                    </button>
                  )}
                </div>
                
              </div>
            ))}
            
            {/* Scroll anchor (invisible element at bottom) */}
            <div ref={messagesEndRef} />
          </>
        )}
      </div>
      
    </div>
  );
}

export default MessagePanel;

/**
 * ==============================================
 * MESSAGE STRUCTURE
 * ==============================================
 * 
 * Message Object:
 * {
 *   _id: string,              // MongoDB ID
 *   fromCode: string,         // ‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á (SP001)
 *   toCode: string,           // ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (AG001)
 *   toTeamId: number,         // ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ team
 *   content: string,          // ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
 *   type: 'direct' | 'broadcast',  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
 *   priority: 'high' | 'normal' | 'low',
 *   isRead: boolean,          // ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
 *   readAt: Date,             // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô
 *   timestamp: Date           // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á
 * }
 */

/**
 * ==============================================
 * STYLING FEATURES
 * ==============================================
 * 
 * Message Card States:
 * 
 * 1. Unread Message
 *    - Blue left border
 *    - Light blue background
 *    - Unread badge visible
 *    - Mark as read button shown
 * 
 * 2. Read Message
 *    - Gray border
 *    - White background
 *    - No badge
 *    - No mark as read button
 * 
 * 3. Broadcast Message
 *    - Orange left border
 *    - Different icon (üì¢)
 * 
 * 4. Direct Message
 *    - Blue left border
 *    - Direct icon (üí¨)
 * 
 * 5. Hover State
 *    - Slight elevation
 *    - Darker background
 *    - Transform: translateY(-2px)
 */

/**
 * ==============================================
 * PERFORMANCE CONSIDERATIONS
 * ==============================================
 * 
 * 1. Virtualization (for many messages)
 *    - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ > 100 messages
 *    - ‡πÉ‡∏ä‡πâ react-window ‡∏´‡∏£‡∏∑‡∏≠ react-virtualized
 *    - Render ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô
 * 
 * 2. Pagination
 *    - Load messages ‡∏ó‡∏µ‡∏•‡∏∞ 50
 *    - Infinite scroll
 *    - Load more button
 * 
 * 3. Memoization
 *    - React.memo() ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö MessageItem
 *    - useMemo() ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö sorted/filtered lists
 * 
 * 4. Debounce
 *    - Scroll events
 *    - Mark as read API calls
 */

/**
 * ==============================================
 * ACCESSIBILITY
 * ==============================================
 * 
 * 1. Semantic HTML
 *    - Use <article> for messages
 *    - Use <time> for timestamps
 * 
 * 2. ARIA Labels
 *    - aria-label for icon buttons
 *    - aria-live for new messages
 * 
 * 3. Keyboard Navigation
 *    - Tab through messages
 *    - Enter to mark as read
 *    - Escape to close
 * 
 * 4. Screen Readers
 *    - Announce unread count
 *    - Read message content
 *    - Announce status changes
 */
```

---

# Section 6: Services Layer

<a name="section-6"></a>

## 6.1 Services Layer Overview

### Service Architecture

```
Services Layer
‚îú‚îÄ‚îÄ api.js (HTTP Communication)
‚îÇ   ‚îú‚îÄ‚îÄ REST API calls
‚îÇ   ‚îú‚îÄ‚îÄ Token management
‚îÇ   ‚îî‚îÄ‚îÄ Error handling
‚îÇ
‚îú‚îÄ‚îÄ socket.js (WebSocket Communication)
‚îÇ   ‚îú‚îÄ‚îÄ Real-time connection
‚îÇ   ‚îú‚îÄ‚îÄ Event management
‚îÇ   ‚îî‚îÄ‚îÄ Reconnection logic
‚îÇ
‚îî‚îÄ‚îÄ notifications.js (Desktop Notifications)
    ‚îú‚îÄ‚îÄ Electron API integration
    ‚îú‚îÄ‚îÄ Browser Notification API
    ‚îî‚îÄ‚îÄ Permission handling
```

### Communication Flow

```
Component Layer
      ‚Üì
Service Layer (Abstraction)
      ‚Üì
      ‚îú‚îÄ‚Üí api.js ‚Üí Backend REST API
      ‚îú‚îÄ‚Üí socket.js ‚Üí Backend WebSocket
      ‚îî‚îÄ‚Üí notifications.js ‚Üí OS Notification System
```

---

## 6.2 API Service (HTTP Communication)

### üìÑ src/services/api.js

```javascript
/**
 * ==============================================
 * API SERVICE
 * ==============================================
 * 
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å REST API ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
 * 
 * Features:
 * - Token management (in-memory)
 * - Authentication headers
 * - Error handling
 * - Type-safe responses
 * 
 * Security:
 * - ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö token ‡πÉ‡∏ô localStorage
 * - Token ‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ refresh page (‡∏ï‡πâ‡∏≠‡∏á login ‡πÉ‡∏´‡∏°‡πà)
 * - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô XSS attacks
 */

// ===========================================
// CONFIGURATION
// ===========================================
/**
 * Base URL ‡∏à‡∏≤‡∏Å environment variable
 * Development: http://localhost:3001/api
 * Production: https://api.yourdomain.com/api
 */
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';

// ===========================================
// TOKEN MANAGEMENT
// ===========================================
/**
 * ‡πÄ‡∏Å‡πá‡∏ö JWT token ‡πÉ‡∏ô memory (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà localStorage)
 * 
 * ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:
 * - ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤ (‡πÑ‡∏°‡πà‡∏°‡∏µ XSS ‡πÑ‡∏î‡πâ)
 * - Auto-clear ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î tab
 * 
 * ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:
 * - ‡∏´‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ refresh page
 * - ‡∏ï‡πâ‡∏≠‡∏á login ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
 */
let authToken = null;

/**
 * setAuthToken()
 * ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å token ‡∏´‡∏•‡∏±‡∏á login
 * 
 * @param {string} token - JWT token
 */
export const setAuthToken = (token) => {
  authToken = token;
  console.log('Auth token set');
};

/**
 * clearAuthToken()
 * ‡∏•‡∏ö token ‡∏´‡∏•‡∏±‡∏á logout
 */
export const clearAuthToken = () => {
  authToken = null;
  console.log('Auth token cleared');
};

/**
 * getAuthToken()
 * ‡∏î‡∏∂‡∏á token ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
 * 
 * @returns {string|null} Current token
 */
export const getAuthToken = () => authToken;

// ===========================================
// AUTHENTICATION APIS
// ===========================================

/**
 * loginAgent()
 * Login ‡∏î‡πâ‡∏ß‡∏¢ Agent Code
 * 
 * @param {string} agentCode - Agent code (e.g., AG001)
 * @returns {Promise<Object>} Response object
 * 
 * Response structure:
 * {
 *   success: boolean,
 *   data: {
 *     user: {
 *       agentCode: string,
 *       agentName: string,
 *       teamId: number,
 *       teamName: string,
 *       role: string,
 *       email: string
 *     },
 *     token: string
 *   },
 *   error?: string
 * }
 * 
 * Endpoint: POST /api/auth/login
 */
export const loginAgent = async (agentCode) => {
  try {
    const response = await fetch(`${API_BASE_URL}/auth/login`, {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json' 
      },
      body: JSON.stringify({ agentCode })
    });

    const data = await response.json();
    
    // Check HTTP status
    if (!response.ok) {
      throw new Error(data.error || 'Login failed');
    }
    
    // Save token if present
    if (data.data?.token) {
      setAuthToken(data.data.token);
    }
    
    return data;
    
  } catch (error) {
    console.error('Login API Error:', error);
    throw error; // Re-throw to caller
  }
};

/**
 * logoutAgent()
 * Logout ‡πÅ‡∏•‡∏∞ invalidate token
 * 
 * @returns {Promise<Object>} Response object
 * 
 * Endpoint: POST /api/auth/logout
 */
export const logoutAgent = async () => {
  try {
    const response = await fetch(`${API_BASE_URL}/auth/logout`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      }
    });

    const data = await response.json();
    
    // Clear token regardless of response
    clearAuthToken();
    
    return data;
    
  } catch (error) {
    console.error('Logout API Error:', error);
    
    // Clear token even on error
    clearAuthToken();
    
    throw error;
  }
};

// ===========================================
// MESSAGE APIS
// ===========================================

/**
 * getMessages()
 * ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á agent
 * 
 * @param {string} agentCode - Agent code
 * @param {number} limit - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (default: 50)
 * @param {boolean} unreadOnly - ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô (default: false)
 * @returns {Promise<Object>} Response object
 * 
 * Response structure:
 * {
 *   success: boolean,
 *   agentCode: string,
 *   messages: Array<Message>,
 *   count: number
 * }
 * 
 * Message structure:
 * {
 *   _id: string,
 *   fromCode: string,
 *   toCode: string,
 *   content: string,
 *   type: 'direct' | 'broadcast',
 *   priority: 'high' | 'normal' | 'low',
 *   isRead: boolean,
 *   timestamp: Date
 * }
 * 
 * Endpoint: GET /api/messages/agent/:agentCode
 */
export const getMessages = async (agentCode, limit = 50, unreadOnly = false) => {
  try {
    // Guard: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ token
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    // Build URL with query parameters
    const url = `${API_BASE_URL}/messages/agent/${agentCode}?limit=${limit}&unreadOnly=${unreadOnly}`;
    
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${authToken}`
      }
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to get messages');
    }
    
    return data;
    
  } catch (error) {
    console.error('Get Messages API Error:', error);
    throw error;
  }
};

/**
 * markMessageAsRead()
 * Mark ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß
 * 
 * @param {string} messageId - MongoDB _id
 * @returns {Promise<Object>} Response object
 * 
 * Response structure:
 * {
 *   success: boolean,
 *   data: {
 *     messageId: string,
 *     isRead: boolean,
 *     readAt: Date
 *   }
 * }
 * 
 * Endpoint: PUT /api/messages/:messageId/read
 */
export const markMessageAsRead = async (messageId) => {
  try {
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    const response = await fetch(`${API_BASE_URL}/messages/${messageId}/read`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${authToken}`
      }
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to mark message as read');
    }
    
    return data;
    
  } catch (error) {
    console.error('Mark Read API Error:', error);
    throw error;
  }
};

// ===========================================
// AGENT STATUS APIS
// ===========================================

/**
 * updateAgentStatus()
 * ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á agent
 * 
 * ‚ö†Ô∏è ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ HTTP Fallback
 * ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ WebSocket ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
 * 
 * @param {string} agentCode - Agent code
 * @param {string} status - New status
 * @returns {Promise<Object>} Response object
 * 
 * Status values:
 * - 'Available'
 * - 'Busy'
 * - 'Break'
 * - 'Offline'
 * 
 * Response structure:
 * {
 *   success: boolean,
 *   data: {
 *     agentCode: string,
 *     status: string,
 *     timestamp: Date,
 *     teamId: number
 *   }
 * }
 * 
 * Endpoint: PUT /api/agents/:agentCode/status
 */
export const updateAgentStatus = async (agentCode, status) => {
  try {
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    const response = await fetch(`${API_BASE_URL}/agents/${agentCode}/status`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      },
      body: JSON.stringify({ status })
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to update status');
    }
    
    return data;
    
  } catch (error) {
    console.error('Update Status API Error:', error);
    throw error;
  }
};

/**
 * getStatusHistory()
 * ‡∏î‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
 * 
 * @param {string} agentCode - Agent code
 * @param {number} limit - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (default: 50)
 * @returns {Promise<Object>} Response object
 * 
 * Response structure:
 * {
 *   success: boolean,
 *   agentCode: string,
 *   history: Array<StatusRecord>,
 *   count: number
 * }
 * 
 * StatusRecord structure:
 * {
 *   _id: string,
 *   agentCode: string,
 *   status: string,
 *   timestamp: Date,
 *   teamId: number,
 *   duration: number
 * }
 * 
 * Endpoint: GET /api/agents/:agentCode/history
 */
export const getStatusHistory = async (agentCode, limit = 50) => {
  try {
    if (!authToken) {
      throw new Error('Not authenticated');
    }

    const response = await fetch(
      `${API_BASE_URL}/agents/${agentCode}/history?limit=${limit}`, 
      {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${authToken}`
        }
      }
    );

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error(data.error || 'Failed to get status history');
    }
    
    return data;
    
  } catch (error) {
    console.error('Get Status History API Error:', error);
    throw error;
  }
};

// ===========================================
// HEALTH CHECK API
// ===========================================

/**
 * checkServerHealth()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ backend server ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
 * 
 * ‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ token (public endpoint)
 * 
 * @returns {Promise<Object>} Response object
 * 
 * Response structure:
 * {
 *   status: 'OK',
 *   timestamp: string,
 *   uptime: number,
 *   memory: {
 *     used: string,
 *     total: string
 *   }
 * }
 * 
 * Endpoint: GET /health
 */
export const checkServerHealth = async () => {
  try {
    // Remove /api from base URL for health endpoint
    const healthUrl = API_BASE_URL.replace('/api', '/health');
    
    const response = await fetch(healthUrl, {
      method: 'GET'
    });

    const data = await response.json();
    
    if (!response.ok) {
      throw new Error('Server health check failed');
    }
    
    return data;
    
  } catch (error) {
    console.error('Health Check Error:', error);
    throw error;
  }
};

/**
 * ==============================================
 * ERROR HANDLING STRATEGY
 * ==============================================
 * 
 * 1. Network Errors (fetch fails)
 *    - throw error with message
 *    - Caller handles UI update
 * 
 * 2. HTTP Errors (4xx, 5xx)
 *    - Parse error from response
 *    - throw with server message
 * 
 * 3. Authentication Errors (401)
 *    - Could auto-logout
 *    - Could refresh token
 *    - Currently: throw error
 * 
 * 4. Validation Errors (400)
 *    - Return error details
 *    - Component shows inline
 */

/**
 * ==============================================
 * SECURITY BEST PRACTICES
 * ==============================================
 * 
 * ‚úÖ DO:
 * - Store token in memory (not localStorage)
 * - Use HTTPS in production
 * - Validate all inputs
 * - Handle errors properly
 * - Clear token on logout
 * 
 * ‚ùå DON'T:
 * - Store token in localStorage (XSS risk)
 * - Send token in URL params
 * - Log sensitive data
 * - Trust client-side validation only
 */

/**
 * ==============================================
 * USAGE EXAMPLES
 * ==============================================
 */

/**
 * Example 1: Login
 * ```javascript
 * try {
 *   const result = await loginAgent('AG001');
 *   if (result.success) {
 *     console.log('User:', result.data.user);
 *     console.log('Token saved automatically');
 *   }
 * } catch (error) {
 *   console.error('Login failed:', error.message);
 * }
 * ```
 */

/**
 * Example 2: Get Messages
 * ```javascript
 * try {
 *   const result = await getMessages('AG001', 50, false);
 *   console.log('Messages:', result.messages);
 * } catch (error) {
 *   if (error.message === 'Not authenticated') {
 *     // Redirect to login
 *   }
 * }
 * ```
 */

/**
 * Example 3: Update Status with Retry
 * ```javascript
 * const updateStatusWithRetry = async (code, status, maxRetries = 3) => {
 *   for (let i = 0; i < maxRetries; i++) {
 *     try {
 *       return await updateAgentStatus(code, status);
 *     } catch (error) {
 *       if (i === maxRetries - 1) throw error;
 *       await new Promise(r => setTimeout(r, 1000 * (i + 1)));
 *     }
 *   }
 * };
 * ```
 */
```

---

## 6.3 Socket Service (WebSocket Communication)

### üìÑ src/services/socket.js

```javascript
/**
 * ==============================================
 * SOCKET SERVICE
 * ==============================================
 * 
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ WebSocket connection ‡∏î‡πâ‡∏ß‡∏¢ Socket.io
 * 
 * Features:
 * - Connection management
 * - Auto-reconnection
 * - Event handling
 * - Connection status tracking
 * 
 * Pattern: Singleton
 * - ‡∏°‡∏µ socket instance ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
 * - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô multiple connections
 */

import io from 'socket.io-client';

// ===========================================
// CONFIGURATION
// ===========================================
/**
 * Socket.io server URL
 * ‡∏à‡∏≤‡∏Å environment variable
 */
const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';

// ===========================================
// SOCKET INSTANCE (Singleton)
// ===========================================
/**
 * Global socket instance
 * null = ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
 */
let socket = null;

// ===========================================
// CONNECT SOCKET
// ===========================================
/**
 * connectSocket()
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WebSocket
 * 
 * @param {string} agentCode - Agent code for authentication
 * @returns {Socket} Socket.io instance
 * 
 * Features:
 * - Disconnect existing socket first
 * - Create new connection with config
 * - Setup event listeners
 * - Return socket instance
 * 
 * Connection Options:
 * - query: data ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏Å‡∏±‡∏ö connection
 * - timeout: connection timeout (20s)
 * - reconnection: auto-reconnect enabled
 * - reconnectionAttempts: max retry (5)
 * - reconnectionDelay: delay between retries (1s)
 * - reconnectionDelayMax: max delay (5s)
 */
export const connectSocket = (agentCode) => {
  // ===========================================
  // 1. DISCONNECT EXISTING
  // ===========================================
  /**
   * ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ socket ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ disconnect ‡∏Å‡πà‡∏≠‡∏ô
   * ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô memory leaks ‡πÅ‡∏•‡∏∞ multiple connections
   */
  if (socket) {
    disconnectSocket();
  }

  console.log('Connecting to WebSocket...', SOCKET_URL);

  // ===========================================
  // 2. CREATE NEW CONNECTION
  // ===========================================
  /**
   * ‡∏™‡∏£‡πâ‡∏≤‡∏á Socket.io connection
   * 
   * io(url, options)
   * @param {string} url - WebSocket server URL
   * @param {Object} options - Connection options
   */
  socket = io(SOCKET_URL, {
    // Query parameters (sent with connection)
    query: { 
      agentCode: agentCode.toUpperCase(),
      type: 'agent' // ‡∏ö‡∏≠‡∏Å backend ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô agent (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà supervisor)
    },
    
    // Connection timeout (milliseconds)
    timeout: 20000, // 20 seconds
    
    // Reconnection settings
    reconnection: true,              // Enable auto-reconnect
    reconnectionAttempts: 5,         // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ï‡πà‡∏≠
    reconnectionDelay: 1000,         // Delay ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á (1s)
    reconnectionDelayMax: 5000,      // Delay ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (5s)
    
    // Transport settings (optional)
    // transports: ['websocket', 'polling'] // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏≠‡∏á
  });

  // ===========================================
  // 3. SETUP CORE EVENT LISTENERS
  // ===========================================
  /**
   * Event listeners ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
   * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö monitoring connection status
   */
  
  /**
   * Event: connect
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
   */
  socket.on('connect', () => {
    console.log('WebSocket connected:', socket.id);
    
    // ‡∏™‡πà‡∏á authentication event
    // Backend ‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞ register agent
    socket.emit('agent_connect', { 
      agentCode: agentCode.toUpperCase() 
    });
  });

  /**
   * Event: disconnect
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≤‡∏î
   * 
   * @param {string} reason - ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà disconnect
   * 
   * Possible reasons:
   * - 'io server disconnect' - Server ‡∏õ‡∏¥‡∏î connection
   * - 'io client disconnect' - Client ‡∏õ‡∏¥‡∏î (‡πÄ‡∏£‡∏≤)
   * - 'ping timeout' - Heartbeat timeout
   * - 'transport close' - Transport layer ‡∏õ‡∏¥‡∏î
   * - 'transport error' - Transport error
   */
  socket.on('disconnect', (reason) => {
    console.log('WebSocket disconnected:', reason);
    
    // Auto-reconnect ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    // ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô 'io server disconnect' ‡πÅ‡∏•‡∏∞ 'io client disconnect'
  });

  /**
   * Event: connect_error
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î error ‡∏Ç‡∏ì‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
   * 
   * @param {Error} error - Error object
   */
  socket.on('connect_error', (error) => {
    console.error('WebSocket connection error:', error);
    // Component ‡∏ó‡∏µ‡πà listen event ‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á error UI
  });

  /**
   * Event: reconnect
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ reconnect ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
   * 
   * @param {number} attemptNumber - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°
   */
  socket.on('reconnect', (attemptNumber) => {
    console.log('WebSocket reconnected after', attemptNumber, 'attempts');
  });

  /**
   * Event: reconnect_error
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á reconnect ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
   * 
   * @param {Error} error - Error object
   */
  socket.on('reconnect_error', (error) => {
    console.error('WebSocket reconnection error:', error);
  });

  /**
   * Event: reconnect_failed
   * ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ reconnect ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
   * (‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏ö reconnectionAttempts)
   */
  socket.on('reconnect_failed', () => {
    console.error('WebSocket reconnection failed after all attempts');
  });

  // ===========================================
  // 4. SETUP APPLICATION EVENT LISTENERS
  // ===========================================
  /**
   * Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö application logic
   * Custom events ‡∏à‡∏≤‡∏Å backend
   */
  
  /**
   * Event: connection_error
   * Custom event ‡∏à‡∏≤‡∏Å backend
   * ‡πÄ‡∏°‡∏∑‡πà‡∏≠ authentication ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
   */
  socket.on('connection_error', (error) => {
    console.error('Connection error from server:', error);
  });

  /**
   * Event: status_error
   * Status update ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
   */
  socket.on('status_error', (error) => {
    console.error('Status update error from server:', error);
  });

  /**
   * Event: message_error
   * Message operation ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
   */
  socket.on('message_error', (error) => {
    console.error('Message error from server:', error);
  });

  // ===========================================
  // 5. DEBUG: EXPOSE TO WINDOW (DEV ONLY)
  // ===========================================
  /**
   * ‡πÄ‡∏Å‡πá‡∏ö socket instance ‡πÉ‡∏ô window
   * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debugging ‡πÉ‡∏ô browser console
   * 
   * Usage in console:
   * ```javascript
   * window.socket.emit('update_status', { ... })
   * window.socket.on('new_message', console.log)
   * ```
   */
  if (process.env.NODE_ENV === 'development') {
    window.socket = socket;
  }

  // ===========================================
  // 6. RETURN SOCKET
  // ===========================================
  return socket;
};

// ===========================================
// DISCONNECT SOCKET
// ===========================================
/**
 * disconnectSocket()
 * ‡∏õ‡∏¥‡∏î connection ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
 * 
 * Important:
 * - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å disconnect() ‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡πà‡∏≠‡∏ô unmount
 * - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô memory leaks
 * - ‡∏•‡∏ö reference
 */
export const disconnectSocket = () => {
  if (socket) {
    console.log('Disconnecting WebSocket...');
    
    // Disconnect socket
    socket.disconnect();
    
    // Clear references
    socket = null;
    
    if (process.env.NODE_ENV === 'development') {
      window.socket = null;
    }
  }
};

// ===========================================
// SEND STATUS UPDATE
// ===========================================
/**
 * sendStatusUpdate()
 * ‡∏™‡πà‡∏á status update ‡∏ú‡πà‡∏≤‡∏ô WebSocket
 * 
 * @param {string} agentCode - Agent code
 * @param {string} status - New status
 * @returns {boolean} Success flag
 * 
 * Returns:
 * - true: ‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (socket connected)
 * - false: ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (socket not connected)
 * 
 * Usage:
 * ```javascript
 * const success = sendStatusUpdate('AG001', 'Busy');
 * if (!success) {
 *   // Fallback to HTTP API
 * }
 * ```
 */
export const sendStatusUpdate = (agentCode, status) => {
  // Guard: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö socket connection
  if (socket && socket.connected) {
    console.log('Sending status update via WebSocket:', { agentCode, status });
    
    // Emit event to server
    socket.emit('update_status', {
      agentCode: agentCode.toUpperCase(),
      status: status
    });
    
    return true; // Success
  }
  
  // Socket not connected
  console.warn('Socket not connected, cannot send status update');
  return false; // Failed
};

// ===========================================
// UTILITY FUNCTIONS
// ===========================================

/**
 * isSocketConnected()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ socket ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
 * 
 * @returns {boolean} Connection status
 */
export const isSocketConnected = () => {
  return socket && socket.connected;
};

/**
 * getSocket()
 * ‡∏î‡∏∂‡∏á socket instance ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
 * 
 * @returns {Socket|null} Socket instance
 * 
 * Usage:
 * ```javascript
 * const socket = getSocket();
 * if (socket) {
 *   socket.on('custom_event', handler);
 * }
 * ```
 */
export const getSocket = () => socket;

/**
 * ==============================================
 * EVENT FLOW DIAGRAM
 * ==============================================
 * 
 * Connection Flow:
 * ----------------
 * connectSocket(agentCode)
 *   ‚Üì
 * io.connect(url, options)
 *   ‚Üì
 * 'connect' event ‚Üí emit('agent_connect')
 *   ‚Üì
 * Backend validates
 *   ‚Üì
 * 'connection_success' event
 *   ‚Üì
 * Ready to use
 * 
 * Disconnection Flow:
 * -------------------
 * Component unmount
 *   ‚Üì
 * disconnectSocket()
 *   ‚Üì
 * socket.disconnect()
 *   ‚Üì
 * 'disconnect' event
 *   ‚Üì
 * Clean up
 * 
 * Reconnection Flow:
 * ------------------
 * Connection lost
 *   ‚Üì
 * 'disconnect' event
 *   ‚Üì
 * Auto-reconnect attempts (1-5)
 *   ‚Üì
 * Success? ‚Üí 'reconnect' event
 * Failed? ‚Üí 'reconnect_failed' event
 */

/**
 * ==============================================
 * WEBSOCKET VS HTTP
 * ==============================================
 * 
 * Use WebSocket when:
 * ‚úÖ Real-time updates needed
 * ‚úÖ Low latency required
 * ‚úÖ Bi-directional communication
 * ‚úÖ Frequent updates (status, messages)
 * 
 * Use HTTP when:
 * ‚úÖ One-time requests
 * ‚úÖ Large data transfer
 * ‚úÖ File uploads
 * ‚úÖ WebSocket not available
 * ‚úÖ Need request/response pattern
 * 
 * Our Strategy:
 * - WebSocket: Status updates, Messages
 * - HTTP: Login, History, File operations
 * - Fallback: HTTP when WebSocket fails
 */

/**
 * ==============================================
 * TROUBLESHOOTING
 * ==============================================
 * 
 * Problem: Connection timeout
 * Solution:
 * - Check backend is running
 * - Check SOCKET_URL is correct
 * - Check firewall settings
 * - Increase timeout value
 * 
 * Problem: Frequent disconnections
 * Solution:
 * - Check network stability
 * - Increase reconnectionDelay
 * - Check server resources
 * - Monitor connection events
 * 
 * Problem: Events not received
 * Solution:
 * - Check event name spelling
 * - Verify backend emits event
 * - Check event listener registration
 * - Use browser DevTools ‚Üí WS tab
 * 
 * Problem: Memory leaks
 * Solution:
 * - Call disconnectSocket() on unmount
 * - Remove event listeners properly
 * - Clear socket reference
 * - Check for closure issues
 */
```

---

## 6.4 Notifications Service

### üìÑ src/services/notifications.js

```javascript
/**
 * ==============================================
 * NOTIFICATIONS SERVICE
 * ==============================================
 * 
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Desktop Notifications
 * 
 * Features:
 * - Electron API integration (preferred)
 * - Browser Notification API fallback
 * - Permission management
 * - Error handling
 * 
 * Platform Support:
 * - Electron: Full support via IPC
 * - Chrome: Web Notification API
 * - Firefox: Web Notification API
 * - Safari: Limited support
 */

// ===========================================
// SHOW DESKTOP NOTIFICATION
// ===========================================
/**
 * showDesktopNotification()
 * ‡πÅ‡∏™‡∏î‡∏á notification ‡∏ö‡∏ô desktop
 * 
 * @param {string} title - Notification title
 * @param {string} body - Notification body/message
 * @returns {Promise<void>}
 * 
 * Strategy:
 * 1. Try Electron API first (preferred)
 * 2. Fallback to Browser Notification API
 * 3. Log error if both fail
 * 
 * Example:
 * ```javascript
 * await showDesktopNotification(
 *   'New Message',
 *   'You have a message from SP001'
 * );
 * ```
 */
export const showDesktopNotification = async (title, body) => {
  try {
    // ===========================================
    // METHOD 1: ELECTRON API (Preferred)
    // ===========================================
    /**
     * ‡∏ñ‡πâ‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Electron
     * ‡πÉ‡∏ä‡πâ IPC ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÉ‡∏´‡πâ Main Process
     * 
     * ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:
     * - Native OS notifications
     * - Better integration
     * - More features (icon, actions)
     * - No permission popup
     */
    if (window.electronAPI && window.electronAPI.showNotification) {
      await window.electronAPI.showNotification(title, body);
      return; // Success, done
    }
    
    // ===========================================
    // METHOD 2: BROWSER NOTIFICATION API
    // ===========================================
    /**
     * ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Electron (dev mode)
     * ‡πÉ‡∏ä‡πâ Browser Notification API
     * 
     * Requirements:
     * - Permission must be 'granted'
     * - HTTPS (not required for localhost)
     */
    if ('Notification' in window && Notification.permission === 'granted') {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á Notification object
      new Notification(title, {
        body: body,                          // ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
        icon: '/assets/icon.png',           // Icon path
        badge: '/assets/tray-icon.png',     // Badge icon
        // Optional properties:
        // tag: 'unique-id',                 // Group notifications
        // requireInteraction: false,        // Auto-close
        // silent: false,                    // Play sound
        // vibrate: [200, 100, 200]         // Vibration pattern (mobile)
      });
    }
    
  } catch (error) {
    // ===========================================
    // ERROR HANDLING
    // ===========================================
    /**
     * ‡πÑ‡∏°‡πà throw error
     * ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ notification ‡πÑ‡∏°‡πà critical
     * ‡πÅ‡∏Ñ‡πà log ‡πÄ‡∏û‡∏∑‡πà‡∏≠ debugging
     */
    console.error('Notification error:', error);
  }
};

// ===========================================
// REQUEST NOTIFICATION PERMISSION
// ===========================================
/**
 * requestNotificationPermission()
 * ‡∏Ç‡∏≠ permission ‡πÅ‡∏™‡∏î‡∏á notifications
 * 
 * @returns {Promise<string>} Permission status
 * 
 * Permission values:
 * - 'granted' - ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß
 * - 'denied' - ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
 * - 'default' - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏≤‡∏°
 * 
 * Usage:
 * ```javascript
 * const permission = await requestNotificationPermission();
 * if (permission === 'granted') {
 *   // Can show notifications
 * }
 * ```
 * 
 * Best Practice:
 * - ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏≠‡∏ô app start
 * - ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ö‡πà‡∏≠‡∏¢ (annoying)
 * - Explain why need permission
 */
export const requestNotificationPermission = async () => {
  // ===========================================
  // CHECK BROWSER SUPPORT
  // ===========================================
  /**
   * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ browser support Notification API
   * Electron ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠ permission (handled by OS)
   */
  if (!('Notification' in window)) {
    console.warn('This browser does not support notifications');
    return 'denied'; // Not supported = denied
  }

  // ===========================================
  // CHECK CURRENT PERMISSION
  // ===========================================
  /**
   * ‡∏ñ‡πâ‡∏≤ permission ‡πÄ‡∏õ‡πá‡∏ô 'default' (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏≤‡∏°)
   * ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á permission dialog
   */
  if (Notification.permission === 'default') {
    try {
      // Request permission (shows browser dialog)
      const permission = await Notification.requestPermission();
      console.log('Notification permission:', permission);
      return permission;
      
    } catch (error) {
      console.error('Failed to request notification permission:', error);
      return 'denied';
    }
  }

  // ===========================================
  // RETURN CURRENT PERMISSION
  // ===========================================
  /**
   * ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß return ‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
   * - 'granted' = ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡πâ‡∏ß
   * - 'denied' = ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß
   */
  console.log('Current notification permission:', Notification.permission);
  return Notification.permission;
};

/**
 * ==============================================
 * NOTIFICATION OPTIONS
 * ==============================================
 * 
 * Standard Options:
 * {
 *   body: string,              // Message text
 *   icon: string,              // Icon URL
 *   badge: string,             // Badge icon URL
 *   image: string,             // Large image URL
 *   tag: string,               // Unique ID (for grouping)
 *   data: any,                 // Custom data
 *   requireInteraction: bool,  // Don't auto-close
 *   silent: bool,              // No sound
 *   timestamp: number,         // Unix timestamp
 *   vibrate: number[],         // Vibration pattern
 *   actions: Array,            // Action buttons
 *   dir: 'ltr'|'rtl'|'auto',  // Text direction
 *   lang: string,              // Language code
 *   renotify: bool            // Vibrate again
 * }
 * 
 * Action Example:
 * ```javascript
 * actions: [
 *   {
 *     action: 'view',
 *     title: 'View Message',
 *     icon: '/icons/view.png'
 *   },
 *   {
 *     action: 'dismiss',
 *     title: 'Dismiss'
 *   }
 * ]
 * ```
 */

/**
 * ==============================================
 * NOTIFICATION EVENTS
 * ==============================================
 * 
 * Events available on Notification object:
 * 
 * 1. onclick
 *    - User clicks notification
 *    - Focus window, navigate to content
 * 
 * 2. onclose
 *    - Notification closed
 *    - Clean up resources
 * 
 * 3. onerror
 *    - Error showing notification
 *    - Log error
 * 
 * 4. onshow
 *    - Notification shown
 *    - Track impression
 * 
 * Example:
 * ```javascript
 * const notification = new Notification('Title', { body: 'Message' });
 * 
 * notification.onclick = () => {
 *   window.focus();
 *   notification.close();
 * };
 * 
 * notification.onclose = () => {
 *   console.log('Notification closed');
 * };
 * ```
 */

/**
 * ==============================================
 * ADVANCED: NOTIFICATION MANAGER
 * ==============================================
 * 
 * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö application ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
 * ‡∏≠‡∏≤‡∏à‡∏™‡∏£‡πâ‡∏≤‡∏á NotificationManager class:
 * 
 * ```javascript
 * class NotificationManager {
 *   constructor() {
 *     this.notifications = new Map();
 *   }
 * 
 *   show(id, title, body, options = {}) {
 *     // Close existing notification with same id
 *     this.close(id);
 * 
 *     const notification = new Notification(title, {
 *       body,
 *       tag: id,
 *       ...options
 *     });
 * 
 *     this.notifications.set(id, notification);
 *     return notification;
 *   }
 * 
 *   close(id) {
 *     const notification = this.notifications.get(id);
 *     if (notification) {
 *       notification.close();
 *       this.notifications.delete(id);
 *     }
 *   }
 * 
 *   closeAll() {
 *     this.notifications.forEach(n => n.close());
 *     this.notifications.clear();
 *   }
 * }
 * 
 * // Usage:
 * const manager = new NotificationManager();
 * manager.show('msg-1', 'New Message', 'Hello!');
 * manager.close('msg-1');
 * ```
 */

/**
 * ==============================================
 * PLATFORM-SPECIFIC NOTES
 * ==============================================
 * 
 * Windows:
 * - Notifications show in Action Center
 * - Click opens application
 * - Sound can be customized
 * 
 * macOS:
 * - Notifications show in Notification Center
 * - Click focuses application
 * - Sound follows system settings
 * 
 * Linux:
 * - Depends on desktop environment
 * - Usually in notification area
 * - Varies by distro
 * 
 * Browser:
 * - Depends on browser implementation
 * - May have time limit
 * - May require HTTPS
 */

/**
 * ==============================================
 * PRIVACY CONSIDERATIONS
 * ==============================================
 * 
 * ‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á:
 * - ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÉ‡∏ô notification
 * - User ‡∏≠‡∏≤‡∏à‡πÅ‡∏ä‡∏£‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
 * - Notification ‡∏≠‡∏≤‡∏à‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô history
 * - ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏ä‡πâ generic message
 * 
 * ‚ùå Bad:
 * "John Doe (555-1234) - Overdue payment $5000"
 * 
 * ‚úÖ Good:
 * "New notification - Click to view details"
 */
```

---

# Section 7: Utilities ‡πÅ‡∏•‡∏∞ Helpers

<a name="section-7"></a>

## 7.1 Utilities Overview

### Utilities Architecture

```
Utilities Layer
‚îú‚îÄ‚îÄ logger.js (Logging System)
‚îÇ   ‚îú‚îÄ‚îÄ Development logging
‚îÇ   ‚îú‚îÄ‚îÄ Production logging
‚îÇ   ‚îî‚îÄ‚îÄ Log levels
‚îÇ
‚îú‚îÄ‚îÄ validation.js (Input Validation)
‚îÇ   ‚îú‚îÄ‚îÄ Agent code validation
‚îÇ   ‚îú‚îÄ‚îÄ Message validation
‚îÇ   ‚îî‚îÄ‚îÄ Custom validators
‚îÇ
‚îî‚îÄ‚îÄ dateUtils.js (Date/Time Formatting)
    ‚îú‚îÄ‚îÄ Time formatting
    ‚îú‚îÄ‚îÄ Relative time (time ago)
    ‚îî‚îÄ‚îÄ Duration calculation
```

---

## 7.2 Logger Utility

### üìÑ src/utils/logger.js

```javascript
/**
 * ==============================================
 * LOGGER UTILITY
 * ==============================================
 * 
 * Centralized logging system
 * 
 * Features:
 * - Environment-aware (dev/prod)
 * - Multiple log levels
 * - Consistent format
 * - Easy to extend
 * 
 * Benefits:
 * - Easy to disable logs in production
 * - Consistent log format
 * - Easy to add analytics tracking
 * - Easy to switch to external service
 */

// ===========================================
// ENVIRONMENT DETECTION
// ===========================================
/**
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö environment
 * true = development mode
 * false = production mode
 */
const isDev = process.env.NODE_ENV === 'development';

// ===========================================
// LOGGER OBJECT
// ===========================================
/**
 * Logger with multiple levels
 * 
 * Logging Strategy:
 * - Development: Log everything
 * - Production: Log errors only
 */
export const logger = {
  
  /**
   * log()
   * General purpose logging
   * 
   * @param {...any} args - Arguments to log
   * 
   * Usage:
   * ```javascript
   * logger.log('User logged in:', userData);
   * logger.log('Status:', status, 'Time:', timestamp);
   * ```
   * 
   * Output:
   * [LOG] User logged in: { agentCode: 'AG001', ... }
   */
  log: (...args) => {
    if (isDev) {
      console.log('[LOG]', ...args);
    }
  },
  
  /**
   * info()
   * Information messages
   * ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö important events
   * 
   * @param {...any} args - Arguments to log
   * 
   * Usage:
   * ```javascript
   * logger.info('App initialized');
   * logger.info('WebSocket connected to:', url);
   * ```
   * 
   * Output:
   * [INFO] App initialized
   */
  info: (...args) => {
    if (isDev) {
      console.info('[INFO]', ...args);
    }
  },
  
  /**
   * warn()
   * Warning messages
   * ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö potential problems
   * 
   * @param {...any} args - Arguments to log
   * 
   * Usage:
   * ```javascript
   * logger.warn('Socket not connected, using HTTP fallback');
   * logger.warn('Rate limit approaching:', remaining);
   * ```
   * 
   * Output:
   * [WARN] Socket not connected, using HTTP fallback
   */
  warn: (...args) => {
    if (isDev) {
      console.warn('[WARN]', ...args);
    }
  },
  
  /**
   * error()
   * Error messages
   * 
   * ‚ö†Ô∏è ALWAYS LOGGED (even in production)
   * ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ errors ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ‡πÄ‡∏™‡∏°‡∏≠
   * 
   * @param {...any} args - Arguments to log
   * 
   * Usage:
   * ```javascript
   * logger.error('Login failed:', error);
   * logger.error('WebSocket error:', error.message);
   * ```
   * 
   * Output:
   * [ERROR] Login failed: Error: Invalid credentials
   */
  error: (...args) => {
    // Always log errors (even in production)
    console.error('[ERROR]', ...args);
  },
  
  /**
   * debug()
   * Debug messages
   * ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö detailed debugging
   * 
   * @param {...any} args - Arguments to log
   * 
   * Usage:
   * ```javascript
   * logger.debug('State updated:', prevState, nextState);
   * logger.debug('API response:', response.data);
   * ```
   * 
   * Output:
   * [DEBUG] State updated: {...} {...}
   */
  debug: (...args) => {
    if (isDev) {
      console.debug('[DEBUG]', ...args);
    }
  },
  
  /**
   * group()
   * Start console group
   * ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏° logs ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
   * 
   * @param {string} label - Group label
   * 
   * Usage:
   * ```javascript
   * logger.group('Login Process');
   * logger.log('Step 1: Validate input');
   * logger.log('Step 2: Call API');
   * logger.log('Step 3: Save token');
   * logger.groupEnd();
   * ```
   */
  group: (label) => {
    if (isDev) {
      console.group(label);
    }
  },
  
  /**
   * groupEnd()
   * End console group
   */
  groupEnd: () => {
    if (isDev) {
      console.groupEnd();
    }
  },
  
  /**
   * table()
   * Display data as table
   * ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö arrays ‡πÅ‡∏•‡∏∞ objects
   * 
   * @param {Array|Object} data - Data to display
   * 
   * Usage:
   * ```javascript
   * logger.table([
   *   { id: 1, name: 'John', status: 'Available' },
   *   { id: 2, name: 'Jane', status: 'Busy' }
   * ]);
   * ```
   */
  table: (data) => {
    if (isDev) {
      console.table(data);
    }
  }
};

export default logger;

/**
 * ==============================================
 * USAGE EXAMPLES
 * ==============================================
 */

/**
 * Example 1: Basic Logging
 * ```javascript
 * import logger from './utils/logger';
 * 
 * logger.log('Application started');
 * logger.info('User logged in');
 * logger.warn('Low memory');
 * logger.error('Failed to save');
 * ```
 */

/**
 * Example 2: Grouped Logging
 * ```javascript
 * logger.group('WebSocket Connection');
 * logger.log('Connecting to:', url);
 * logger.log('Auth token:', token ? 'Present' : 'Missing');
 * logger.log('Status:', connected ? 'Connected' : 'Disconnected');
 * logger.groupEnd();
 * ```
 */

/**
 * Example 3: Error Logging with Context
 * ```javascript
 * try {
 *   await loginAgent(agentCode);
 * } catch (error) {
 *   logger.error('Login failed', {
 *     agentCode,
 *     error: error.message,
 *     stack: error.stack,
 *     timestamp: new Date().toISOString()
 *   });
 * }
 * ```
 */

/**
 * ==============================================
 * ADVANCED: EXTERNAL LOGGING SERVICE
 * ==============================================
 * 
 * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production monitoring
 * ‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á logs ‡πÑ‡∏õ‡∏¢‡∏±‡∏á external services:
 * 
 * 1. Sentry (Error tracking)
 * ```javascript
 * import * as Sentry from '@sentry/react';
 * 
 * error: (...args) => {
 *   console.error('[ERROR]', ...args);
 *   
 *   // Send to Sentry
 *   if (!isDev) {
 *     Sentry.captureException(args[0]);
 *   }
 * }
 * ```
 * 
 * 2. LogRocket (Session replay)
 * ```javascript
 * import LogRocket from 'logrocket';
 * 
 * error: (...args) => {
 *   console.error('[ERROR]', ...args);
 *   
 *   if (!isDev) {
 *     LogRocket.captureException(args[0]);
 *   }
 * }
 * ```
 * 
 * 3. Custom Analytics
 * ```javascript
 * log: (...args) => {
 *   if (isDev) {
 *     console.log('[LOG]', ...args);
 *   }
 *   
 *   // Send to analytics
 *   analytics.track('log', {
 *     message: args[0],
 *     data: args.slice(1)
 *   });
 * }
 * ```
 */

/**
 * ==============================================
 * PERFORMANCE CONSIDERATIONS
 * ==============================================
 * 
 * Logging Impact:
 * - console.log() is synchronous
 * - Can slow down app if excessive
 * - Should be disabled in production
 * 
 * Best Practices:
 * 1. Log only what's necessary
 * 2. Use appropriate log levels
 * 3. Avoid logging in loops
 * 4. Disable in production (except errors)
 * 5. Consider async logging for heavy operations
 */
```

---

## 7.3 Validation Utility

### üìÑ src/utils/validation.js

```javascript
/**
 * ==============================================
 * VALIDATION UTILITY
 * ==============================================
 * 
 * Input validation functions
 * 
 * Features:
 * - Agent code validation
 * - Message validation
 * - Extensible validators
 * 
 * Pattern:
 * - Return null if valid
 * - Return error message if invalid
 */

// ===========================================
// VALIDATE AGENT CODE
// ===========================================
/**
 * validateAgentCode()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö format ‡∏Ç‡∏≠‡∏á Agent Code
 * 
 * @param {string} code - Agent code to validate
 * @returns {string|null} Error message or null if valid
 * 
 * Rules:
 * - Required (not empty)
 * - Format: ^[A-Z]{2}\d{3}$
 *   - 2 uppercase letters
 *   - 3 digits
 * - Examples: AG001, SP001, TL001
 * 
 * Valid:
 * ‚úÖ AG001
 * ‚úÖ SP001
 * ‚úÖ TL999
 * 
 * Invalid:
 * ‚ùå ag001 (lowercase)
 * ‚ùå A001 (only 1 letter)
 * ‚ùå AG01 (only 2 digits)
 * ‚ùå AGT001 (3 letters)
 * ‚ùå AG1234 (4 digits)
 * 
 * Usage:
 * ```javascript
 * const error = validateAgentCode(input);
 * if (error) {
 *   setError(error);
 *   return;
 * }
 * // Valid, proceed
 * ```
 */
export const validateAgentCode = (code) => {
  // ===========================================
  // CHECK 1: REQUIRED
  // ===========================================
  if (!code) {
    return 'Agent code is required';
  }
  
  // ===========================================
  // CHECK 2: NOT EMPTY (after trim)
  // ===========================================
  const trimmed = code.trim().toUpperCase();
  
  if (trimmed.length === 0) {
    return 'Agent code cannot be empty';
  }
  
  // ===========================================
  // CHECK 3: FORMAT (Regex)
  // ===========================================
  /**
   * Regex Pattern: ^[A-Z]{2}\d{3}$
   * 
   * Breakdown:
   * ^ - Start of string
   * [A-Z]{2} - Exactly 2 uppercase letters
   * \d{3} - Exactly 3 digits
   * $ - End of string
   * 
   * Test regex:
   * /^[A-Z]{2}\d{3}$/.test('AG001') // true
   * /^[A-Z]{2}\d{3}$/.test('AG01')  // false
   */
  const agentCodePattern = /^[A-Z]{2}\d{3}$/;
  
  if (!agentCodePattern.test(trimmed)) {
    return 'Agent code must be in format: AG001 or SP001';
  }
  
  // ===========================================
  // VALID
  // ===========================================
  return null; // No error = valid
};

// ===========================================
// VALIDATE MESSAGE
// ===========================================
/**
 * validateMessage()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á
 * 
 * @param {string} content - Message content
 * @returns {string|null} Error message or null if valid
 * 
 * Rules:
 * - Required (not empty)
 * - Max length: 500 characters
 * 
 * Usage:
 * ```javascript
 * const error = validateMessage(messageText);
 * if (error) {
 *   showError(error);
 *   return;
 * }
 * // Valid, send message
 * ```
 */
export const validateMessage = (content) => {
  // ===========================================
  // CHECK 1: REQUIRED
  // ===========================================
  if (!content || content.trim().length === 0) {
    return 'Message cannot be empty';
  }
  
  // ===========================================
  // CHECK 2: MAX LENGTH
  // ===========================================
  const maxLength = 500;
  
  if (content.length > maxLength) {
    return `Message is too long (max ${maxLength} characters)`;
  }
  
  // ===========================================
  // VALID
  // ===========================================
  return null;
};

// ===========================================
// VALIDATE EMAIL (Optional)
// ===========================================
/**
 * validateEmail()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö email format
 * 
 * @param {string} email - Email address
 * @returns {string|null} Error message or null if valid
 * 
 * Pattern: basic email validation
 * 
 * Note: Email validation ‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô
 * ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ basic version
 * ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ strict ‡πÉ‡∏ä‡πâ library ‡πÄ‡∏ä‡πà‡∏ô validator.js
 */
export const validateEmail = (email) => {
  if (!email) {
    return 'Email is required';
  }
  
  // Basic email pattern
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  
  if (!emailPattern.test(email)) {
    return 'Invalid email format';
  }
  
  return null;
};

// ===========================================
// VALIDATE PHONE (Optional)
// ===========================================
/**
 * validatePhone()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
 * 
 * @param {string} phone - Phone number
 * @returns {string|null} Error message or null if valid
 * 
 * Pattern: 10 digits (Thai format)
 * Example: 0812345678
 */
export const validatePhone = (phone) => {
  if (!phone) {
    return 'Phone number is required';
  }
  
  // Remove spaces and dashes
  const cleaned = phone.replace(/[\s-]/g, '');
  
  // Thai phone pattern: 10 digits starting with 0
  const phonePattern = /^0\d{9}$/;
  
  if (!phonePattern.test(cleaned)) {
    return 'Invalid phone number format (10 digits starting with 0)';
  }
  
  return null;
};

/**
 * ==============================================
 * CUSTOM VALIDATORS
 * ==============================================
 * 
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á validator ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á
 */

/**
 * createValidator()
 * Factory function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á validator
 * 
 * @param {Function} validationFn - Validation function
 * @returns {Function} Validator function
 * 
 * Usage:
 * ```javascript
 * const validateUsername = createValidator((value) => {
 *   if (!value) return 'Username is required';
 *   if (value.length < 3) return 'Username too short';
 *   if (!/^[a-zA-Z0-9_]+$/.test(value)) return 'Invalid characters';
 *   return null;
 * });
 * 
 * const error = validateUsername('ab'); // 'Username too short'
 * ```
 */
export const createValidator = (validationFn) => {
  return (value) => {
    try {
      return validationFn(value);
    } catch (error) {
      console.error('Validation error:', error);
      return 'Validation failed';
    }
  };
};

/**
 * ==============================================
 * COMPOSITE VALIDATORS
 * ==============================================
 * 
 * ‡∏£‡∏ß‡∏° validators ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß
 */

/**
 * composeValidators()
 * ‡∏£‡∏ß‡∏° validators ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
 * 
 * @param {...Function} validators - Validator functions
 * @returns {Function} Combined validator
 * 
 * Usage:
 * ```javascript
 * const validateField = composeValidators(
 *   required,
 *   minLength(3),
 *   maxLength(20),
 *   alphanumeric
 * );
 * 
 * const error = validateField(value);
 * ```
 */
export const composeValidators = (...validators) => {
  return (value) => {
    for (const validator of validators) {
      const error = validator(value);
      if (error) {
        return error; // Return first error found
      }
    }
    return null; // All validators passed
  };
};

/**
 * ==============================================
 * REUSABLE VALIDATOR BUILDERS
 * ==============================================
 */

/**
 * required()
 * Field must have value
 */
export const required = (message = 'This field is required') => {
  return (value) => {
    if (!value || (typeof value === 'string' && value.trim().length === 0)) {
      return message;
    }
    return null;
  };
};

/**
 * minLength()
 * Minimum length validator
 * 
 * @param {number} min - Minimum length
 * @param {string} message - Custom error message
 */
export const minLength = (min, message) => {
  return (value) => {
    if (value && value.length < min) {
      return message || `Minimum length is ${min} characters`;
    }
    return null;
  };
};

/**
 * maxLength()
 * Maximum length validator
 * 
 * @param {number} max - Maximum length
 * @param {string} message - Custom error message
 */
export const maxLength = (max, message) => {
  return (value) => {
    if (value && value.length > max) {
      return message || `Maximum length is ${max} characters`;
    }
    return null;
  };
};

/**
 * pattern()
 * Regex pattern validator
 * 
 * @param {RegExp} regex - Pattern to match
 * @param {string} message - Error message
 */
export const pattern = (regex, message = 'Invalid format') => {
  return (value) => {
    if (value && !regex.test(value)) {
      return message;
    }
    return null;
  };
};

/**
 * ==============================================
 * USAGE EXAMPLES
 * ==============================================
 */

/**
 * Example 1: Form Validation
 * ```javascript
 * const validateLoginForm = (formData) => {
 *   const errors = {};
 *   
 *   const agentCodeError = validateAgentCode(formData.agentCode);
 *   if (agentCodeError) errors.agentCode = agentCodeError;
 *   
 *   return Object.keys(errors).length > 0 ? errors : null;
 * };
 * 
 * const errors = validateLoginForm({ agentCode: 'AG001' });
 * if (errors) {
 *   // Show errors
 * } else {
 *   // Submit form
 * }
 * ```
 */

/**
 * Example 2: Real-time Validation
 * ```javascript
 * const handleInputChange = (e) => {
 *   const value = e.target.value;
 *   setAgentCode(value);
 *   
 *   // Validate on change
 *   const error = validateAgentCode(value);
 *   setError(error);
 * };
 * ```
 */

/**
 * Example 3: Composite Validation
 * ```javascript
 * const validatePassword = composeValidators(
 *   required('Password is required'),
 *   minLength(8, 'Password must be at least 8 characters'),
 *   pattern(/[A-Z]/, 'Must contain uppercase letter'),
 *   pattern(/[0-9]/, 'Must contain number')
 * );
 * 
 * const error = validatePassword('weak');
 * ```
 */
```

---

# Section 7: Utilities ‡πÅ‡∏•‡∏∞ Helpers (‡∏ï‡πà‡∏≠ - ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)

## 7.4 Date Utilities

### üìÑ src/utils/dateUtils.js

```javascript
/**
 * ==============================================
 * DATE UTILITIES
 * ==============================================
 * 
 * Date/Time formatting ‡πÅ‡∏•‡∏∞ calculation
 * 
 * Features:
 * - Time formatting (HH:mm)
 * - DateTime formatting
 * - Relative time (time ago)
 * - Duration calculation
 * 
 * ‡πÉ‡∏ä‡πâ native JavaScript Date API
 * ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏∂‡πà‡∏á libraries ‡πÄ‡∏ä‡πà‡∏ô moment.js
 */

// ===========================================
// FORMAT TIME
// ===========================================
/**
 * formatTime()
 * ‡πÅ‡∏õ‡∏•‡∏á timestamp ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ HH:mm
 * 
 * @param {Date|string|number} timestamp - Date object, ISO string, or Unix timestamp
 * @returns {string} Formatted time (e.g., "14:30")
 * 
 * Format: 24-hour format (HH:mm)
 * 
 * Usage:
 * ```javascript
 * formatTime(new Date())           // "14:30"
 * formatTime('2024-01-15T14:30:00') // "14:30"
 * formatTime(1705329000000)        // "14:30"
 * ```
 */
export const formatTime = (timestamp) => {
  try {
    // ‡πÅ‡∏õ‡∏•‡∏á input ‡πÄ‡∏õ‡πá‡∏ô Date object
    const date = new Date(timestamp);
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô valid date
    if (isNaN(date.getTime())) {
      return '--:--';
    }
    
    // Format time
    return date.toLocaleTimeString('en-US', {
      hour: '2-digit',      // 2 digits (01-23)
      minute: '2-digit',    // 2 digits (00-59)
      hour12: false         // 24-hour format
    });
    
  } catch (error) {
    console.error('formatTime error:', error);
    return '--:--'; // Fallback
  }
};

// ===========================================
// FORMAT DATE TIME
// ===========================================
/**
 * formatDateTime()
 * ‡πÅ‡∏õ‡∏•‡∏á timestamp ‡πÄ‡∏õ‡πá‡∏ô date ‡πÅ‡∏•‡∏∞ time
 * 
 * @param {Date|string|number} timestamp - Date object, ISO string, or Unix timestamp
 * @returns {string} Formatted datetime (e.g., "Jan 15, 2024, 14:30")
 * 
 * Format: MMM DD, YYYY, HH:mm
 * 
 * Usage:
 * ```javascript
 * formatDateTime(new Date())
 * // "Jan 15, 2024, 14:30"
 * ```
 */
export const formatDateTime = (timestamp) => {
  try {
    const date = new Date(timestamp);
    
    if (isNaN(date.getTime())) {
      return 'Invalid date';
    }
    
    // Format datetime
    return date.toLocaleString('en-US', {
      year: 'numeric',      // 2024
      month: 'short',       // Jan
      day: 'numeric',       // 15
      hour: '2-digit',      // 14
      minute: '2-digit',    // 30
      hour12: false         // 24-hour format
    });
    
  } catch (error) {
    console.error('formatDateTime error:', error);
    return 'Invalid date';
  }
};

// ===========================================
// GET TIME AGO (Relative Time)
// ===========================================
/**
 * getTimeAgo()
 * ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö relative (‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà)
 * 
 * @param {Date|string|number} timestamp - Date object, ISO string, or Unix timestamp
 * @returns {string} Relative time (e.g., "5m ago", "2h ago")
 * 
 * Format:
 * - < 1 minute: "just now"
 * - < 1 hour: "Xm ago" (X minutes)
 * - < 1 day: "Xh ago" (X hours)
 * - < 1 week: "Xd ago" (X days)
 * - >= 1 week: "Xw ago" (X weeks)
 * 
 * Usage:
 * ```javascript
 * getTimeAgo(new Date(Date.now() - 30000))     // "just now"
 * getTimeAgo(new Date(Date.now() - 300000))    // "5m ago"
 * getTimeAgo(new Date(Date.now() - 7200000))   // "2h ago"
 * getTimeAgo(new Date(Date.now() - 86400000))  // "1d ago"
 * ```
 */
export const getTimeAgo = (timestamp) => {
  try {
    // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Date objects
    const now = new Date();
    const time = new Date(timestamp);
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö valid date
    if (isNaN(time.getTime())) {
      return 'unknown';
    }
    
    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì difference (seconds)
    const diffInSeconds = Math.floor((now - time) / 1000);
    
    // Handle future dates
    if (diffInSeconds < 0) {
      return 'just now';
    }
    
    // ===========================================
    // < 1 MINUTE (0-59 seconds)
    // ===========================================
    if (diffInSeconds < 60) {
      return 'just now';
    }
    
    // ===========================================
    // < 1 HOUR (1-59 minutes)
    // ===========================================
    const diffInMinutes = Math.floor(diffInSeconds / 60);
    if (diffInMinutes < 60) {
      return `${diffInMinutes}m ago`;
    }
    
    // ===========================================
    // < 1 DAY (1-23 hours)
    // ===========================================
    const diffInHours = Math.floor(diffInMinutes / 60);
    if (diffInHours < 24) {
      return `${diffInHours}h ago`;
    }
    
    // ===========================================
    // < 1 WEEK (1-6 days)
    // ===========================================
    const diffInDays = Math.floor(diffInHours / 24);
    if (diffInDays < 7) {
      return `${diffInDays}d ago`;
    }
    
    // ===========================================
    // >= 1 WEEK
    // ===========================================
    const diffInWeeks = Math.floor(diffInDays / 7);
    return `${diffInWeeks}w ago`;
    
  } catch (error) {
    console.error('getTimeAgo error:', error);
    return 'unknown';
  }
};

// ===========================================
// GET DURATION
// ===========================================
/**
 * getDuration()
 * ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 2 timestamps
 * 
 * @param {Date|string|number} start - Start time
 * @param {Date|string|number} end - End time
 * @returns {number} Duration in seconds
 * 
 * Usage:
 * ```javascript
 * const start = new Date('2024-01-15T14:00:00');
 * const end = new Date('2024-01-15T15:30:00');
 * const duration = getDuration(start, end); // 5400 (seconds)
 * 
 * // Convert to minutes
 * const minutes = duration / 60; // 90 minutes
 * ```
 */
export const getDuration = (start, end) => {
  try {
    const startTime = new Date(start);
    const endTime = new Date(end);
    
    // Validate dates
    if (isNaN(startTime.getTime()) || isNaN(endTime.getTime())) {
      return 0;
    }
    
    // Calculate difference in seconds
    const diffInMs = endTime - startTime;
    return Math.floor(diffInMs / 1000);
    
  } catch (error) {
    console.error('getDuration error:', error);
    return 0;
  }
};

// ===========================================
// ADDITIONAL UTILITIES
// ===========================================

/**
 * formatDuration()
 * ‡πÅ‡∏õ‡∏•‡∏á seconds ‡πÄ‡∏õ‡πá‡∏ô human-readable format
 * 
 * @param {number} seconds - Duration in seconds
 * @returns {string} Formatted duration (e.g., "1h 30m")
 * 
 * Usage:
 * ```javascript
 * formatDuration(90)    // "1m 30s"
 * formatDuration(3665)  // "1h 1m"
 * formatDuration(86400) // "1d"
 * ```
 */
export const formatDuration = (seconds) => {
  if (seconds < 0) return '0s';
  
  const days = Math.floor(seconds / 86400);
  const hours = Math.floor((seconds % 86400) / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;
  
  const parts = [];
  
  if (days > 0) parts.push(`${days}d`);
  if (hours > 0) parts.push(`${hours}h`);
  if (minutes > 0) parts.push(`${minutes}m`);
  if (secs > 0 && days === 0) parts.push(`${secs}s`);
  
  return parts.length > 0 ? parts.join(' ') : '0s';
};

/**
 * isToday()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ date ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
 * 
 * @param {Date|string|number} date - Date to check
 * @returns {boolean} True if date is today
 */
export const isToday = (date) => {
  try {
    const inputDate = new Date(date);
    const today = new Date();
    
    return inputDate.getDate() === today.getDate() &&
           inputDate.getMonth() === today.getMonth() &&
           inputDate.getFullYear() === today.getFullYear();
  } catch {
    return false;
  }
};

/**
 * isYesterday()
 * ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ date ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
 * 
 * @param {Date|string|number} date - Date to check
 * @returns {boolean} True if date is yesterday
 */
export const isYesterday = (date) => {
  try {
    const inputDate = new Date(date);
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    
    return inputDate.getDate() === yesterday.getDate() &&
           inputDate.getMonth() === yesterday.getMonth() &&
           inputDate.getFullYear() === yesterday.getFullYear();
  } catch {
    return false;
  }
};

/**
 * formatDateSmart()
 * ‡πÅ‡∏™‡∏î‡∏á date ‡πÅ‡∏ö‡∏ö smart (Today, Yesterday, ‡∏´‡∏£‡∏∑‡∏≠ date)
 * 
 * @param {Date|string|number} date - Date to format
 * @returns {string} Formatted date
 * 
 * Output:
 * - Today: "Today, 14:30"
 * - Yesterday: "Yesterday, 14:30"
 * - Other: "Jan 15, 14:30"
 */
export const formatDateSmart = (date) => {
  try {
    const inputDate = new Date(date);
    const time = formatTime(inputDate);
    
    if (isToday(inputDate)) {
      return `Today, ${time}`;
    }
    
    if (isYesterday(inputDate)) {
      return `Yesterday, ${time}`;
    }
    
    // Format as MMM DD, HH:mm
    return inputDate.toLocaleString('en-US', {
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    });
    
  } catch (error) {
    return 'Invalid date';
  }
};

/**
 * ==============================================
 * USAGE EXAMPLES
 * ==============================================
 */

/**
 * Example 1: Message Timestamp
 * ```javascript
 * function MessageItem({ message }) {
 *   return (
 *     <div>
 *       <p>{message.content}</p>
 *       <span className="time">{formatTime(message.timestamp)}</span>
 *       <span className="ago">{getTimeAgo(message.timestamp)}</span>
 *     </div>
 *   );
 * }
 * ```
 */

/**
 * Example 2: Status Duration
 * ```javascript
 * function StatusBadge({ status }) {
 *   const duration = getDuration(status.startTime, new Date());
 *   const formatted = formatDuration(duration);
 *   
 *   return (
 *     <div>
 *       {status.name} - {formatted}
 *     </div>
 *   );
 * }
 * ```
 */

/**
 * Example 3: Smart Date Display
 * ```javascript
 * function ChatMessage({ message }) {
 *   return (
 *     <div>
 *       <p>{message.text}</p>
 *       <time>{formatDateSmart(message.createdAt)}</time>
 *     </div>
 *   );
 * }
 * ```
 */

/**
 * ==============================================
 * INTERNATIONALIZATION (i18n)
 * ==============================================
 * 
 * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö multi-language support:
 * 
 * ```javascript
 * export const formatTime = (timestamp, locale = 'en-US') => {
 *   return new Date(timestamp).toLocaleTimeString(locale, {
 *     hour: '2-digit',
 *     minute: '2-digit',
 *     hour12: false
 *   });
 * };
 * 
 * // Usage:
 * formatTime(date, 'th-TH') // ‡πÑ‡∏ó‡∏¢
 * formatTime(date, 'ja-JP') // Êó•Êú¨Ë™û
 * ```
 */

/**
 * ==============================================
 * TIMEZONE HANDLING
 * ==============================================
 * 
 * ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≤‡∏° timezone:
 * 
 * ```javascript
 * export const formatTimeWithTimezone = (timestamp, timezone) => {
 *   return new Date(timestamp).toLocaleTimeString('en-US', {
 *     hour: '2-digit',
 *     minute: '2-digit',
 *     timeZone: timezone,
 *     hour12: false
 *   });
 * };
 * 
 * // Usage:
 * formatTimeWithTimezone(date, 'Asia/Bangkok')
 * formatTimeWithTimezone(date, 'America/New_York')
 * ```
 */
```

---

## 7.5 Summary: Utilities Layer

**‡∏™‡∏£‡∏∏‡∏õ Section 7 - Utilities ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:**

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏ö:
1. ‚úÖ **logger.js** - Logging system
   - Development/Production modes
   - Multiple log levels (log, info, warn, error, debug)
   - Grouped logging
   - Table display

2. ‚úÖ **validation.js** - Input validation
   - Agent code validation (AG001 format)
   - Message validation (length, required)
   - Email validation
   - Phone validation
   - Reusable validators (required, minLength, maxLength, pattern)
   - Composite validators

3. ‚úÖ **dateUtils.js** - Date/Time utilities
   - Time formatting (HH:mm)
   - DateTime formatting
   - Relative time (time ago)
   - Duration calculation
   - Smart date display
   - Today/Yesterday detection

### ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô:

```javascript
// Example: Complete message validation and display
import logger from './utils/logger';
import { validateMessage } from './utils/validation';
import { formatTime, getTimeAgo } from './utils/dateUtils';

function sendMessage(content) {
  // 1. Validate
  const error = validateMessage(content);
  if (error) {
    logger.error('Validation failed:', error);
    return;
  }
  
  // 2. Send
  logger.log('Sending message:', content);
  const message = {
    content,
    timestamp: new Date()
  };
  
  // 3. Display
  logger.info('Message sent:', {
    time: formatTime(message.timestamp),
    ago: getTimeAgo(message.timestamp)
  });
}
```

---

# Section 8: Styling System

<a name="section-8"></a>

## 8.1 App.css - Core Application Styles

### üìÑ src/styles/App.css

```css
/* Reset & Base */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.app {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  max-width: 400px;
  margin: 0 auto;
  background: #f5f5f5;
  min-height: 100vh;
}

/* Connection Status */
.connection-status {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  font-size: 12px;
  font-weight: 500;
  color: white;
  transition: background-color 0.3s;
}

.connection-status.connected { background: #4caf50; }
.connection-status.disconnected { background: #9e9e9e; }
.connection-status.error { background: #f44336; }

.status-indicator {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* Error Banner */
.error-banner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f44336;
  color: white;
  padding: 12px 16px;
  font-size: 14px;
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from { transform: translateY(-100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.error-close {
  background: none;
  border: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background-color 0.2s;
}

.error-close:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* Login Container */
.login-container {
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.login-form {
  background: white;
  padding: 40px 30px;
  border-radius: 16px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  width: 100%;
  max-width: 320px;
  animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.login-header {
  text-align: center;
  margin-bottom: 30px;
}

.login-header h2 {
  margin: 0 0 8px 0;
  color: #333;
  font-size: 24px;
}

.login-header p {
  color: #666;
  font-size: 14px;
  margin: 0;
}

/* Server Status */
.server-status {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  margin-top: 12px;
  text-transform: uppercase;
}

.server-status.online {
  background: #e8f5e9;
  color: #2e7d32;
}

.server-status.offline {
  background: #ffebee;
  color: #c62828;
}

.server-status.unknown {
  background: #fff3e0;
  color: #f57c00;
}

.server-status .status-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: currentColor;
  animation: blink 2s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* Form */
.form-group {
  margin-bottom: 20px;
  text-align: left;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: #333;
  font-size: 14px;
}

.form-group input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 16px;
  transition: border-color 0.3s;
  font-family: monospace;
  letter-spacing: 1px;
}

.form-group input:focus {
  outline: none;
  border-color: #667eea;
}

.form-group input:disabled {
  background: #f5f5f5;
  cursor: not-allowed;
}

/* Buttons */
.login-btn {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}

.login-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.login-btn:active:not(:disabled) {
  transform: translateY(0);
}

.login-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
}

/* Error Message */
.error-message {
  margin-top: 16px;
  padding: 12px;
  background: #ffebee;
  border: 1px solid #ffcdd2;
  border-radius: 8px;
  color: #c62828;
  font-size: 13px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  animation: shake 0.5s;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.retry-btn {
  margin-top: 8px;
  padding: 6px 12px;
  background: #c62828;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  width: 100%;
}

.retry-btn:hover {
  background: #b71c1c;
}

/* Login Footer */
.login-footer {
  margin-top: 20px;
  text-align: center;
}

.login-footer p {
  color: #999;
  font-size: 12px;
  margin: 6px 0;
}

.help-text {
  color: #666 !important;
  font-size: 11px !important;
}

/* Dashboard */
.dashboard {
  background: white;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.dashboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e0e0e0;
  background: white;
}

.logout-btn {
  background: #f44336;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: background-color 0.2s, transform 0.2s;
}

.logout-btn:hover {
  background: #d32f2f;
  transform: translateY(-1px);
}

.logout-btn:active {
  transform: translateY(0);
}

/* Loading Spinner */
.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
```

---

## 8.2 components.css - Component Styles

### üìÑ src/styles/components.css

```css
/* Agent Info */
.agent-info {
  display: flex;
  gap: 12px;
  flex: 1;
}

.agent-avatar {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
}

.agent-details {
  flex: 1;
  min-width: 0;
}

.agent-name {
  margin: 0 0 4px 0;
  font-size: 16px;
  font-weight: 600;
  color: #333;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.agent-meta {
  display: flex;
  gap: 16px;
  margin-bottom: 6px;
  font-size: 12px;
  color: #666;
}

.agent-meta > div {
  display: flex;
  gap: 4px;
}

.agent-meta .label {
  font-weight: 500;
}

.agent-meta .value {
  font-weight: 600;
  color: #333;
}

.agent-status {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
}

.agent-status .status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}

.agent-status .status-text {
  font-weight: 600;
}

/* Status Panel */
.status-panel {
  padding: 20px;
  border-bottom: 1px solid #e0e0e0;
  background: #fafafa;
}

.status-header {
  margin-bottom: 16px;
}

.status-header h3 {
  margin: 0 0 8px 0;
  font-size: 16px;
  font-weight: 600;
  color: #333;
}

.current-status {
  font-size: 13px;
  color: #666;
}

.status-badge {
  padding: 4px 10px;
  border-radius: 12px;
  color: white;
  font-size: 12px;
  font-weight: 600;
  margin-left: 6px;
}

.status-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.status-btn {
  padding: 16px 12px;
  border: none;
  border-radius: 10px;
  color: white;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.status-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
}

.status-btn:active:not(:disabled) {
  transform: translateY(0);
}

.status-btn.active {
  box-shadow: 0 0 0 3px rgba(255,255,255,0.5);
  transform: scale(1.05);
}

.status-btn:disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

.status-icon {
  font-size: 18px;
}

.status-label {
  font-size: 13px;
}

.status-warning {
  margin-top: 12px;
  padding: 10px;
  background: #fff3cd;
  border: 1px solid #ffc107;
  border-radius: 8px;
  color: #856404;
  font-size: 12px;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

/* Message Panel */
.message-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: white;
  overflow: hidden;
}

.message-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid #e0e0e0;
  background: white;
  position: sticky;
  top: 0;
  z-index: 10;
}

.message-header h3 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
  color: #333;
  display: flex;
  align-items: center;
  gap: 8px;
}

.unread-badge {
  background: #f44336;
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 11px;
  font-weight: 600;
}

.scroll-btn {
  background: #f0f0f0;
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s, transform 0.2s;
}

.scroll-btn:hover {
  background: #e0e0e0;
  transform: scale(1.1);
}

.message-list {
  flex: 1;
  overflow-y: auto;
  padding: 16px 20px;
  background: #fafafa;
}

.message-list::-webkit-scrollbar {
  width: 6px;
}

.message-list::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.message-list::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 3px;
}

.message-list::-webkit-scrollbar-thumb:hover {
  background: #555;
}

/* Loading/Empty States */
.loading-messages {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40px 20px;
  color: #999;
}

.loading-messages p {
  margin-top: 16px;
  font-size: 14px;
}

.no-messages {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 60px 20px;
  color: #999;
  text-align: center;
}

.no-messages-icon {
  font-size: 48px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.no-messages p {
  font-size: 16px;
  margin: 8px 0;
  font-weight: 500;
}

.no-messages small {
  font-size: 13px;
  color: #bbb;
}

/* Message Item */
.message-item {
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 12px;
  transition: transform 0.2s, box-shadow 0.2s;
  animation: messageSlideIn 0.3s ease-out;
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message-item.unread {
  border-left: 4px solid #2196f3;
  background: #e3f2fd;
  box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
}

.message-item.broadcast {
  border-left: 4px solid #ff9800;
}

.message-item.broadcast.unread {
  background: #fff8e1;
}

.message-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.message-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.message-from {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  color: #666;
}

.message-from strong {
  color: #333;
  font-weight: 600;
}

.message-priority {
  display: flex;
  align-items: center;
}

.priority-indicator {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
}

.message-content {
  color: #333;
  font-size: 14px;
  line-height: 1.5;
  margin-bottom: 10px;
  word-wrap: break-word;
}

.message-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.message-meta {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 11px;
  color: #999;
  flex-wrap: wrap;
}

.message-type {
  padding: 2px 6px;
  background: #f5f5f5;
  border-radius: 4px;
  font-weight: 500;
}

.message-time {
  font-weight: 500;
}

.time-ago {
  color: #bbb;
}

.mark-read-btn {
  background: #4caf50;
  color: white;
  border: none;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  transition: background-color 0.2s, transform 0.2s;
}

.mark-read-btn:hover:not(:disabled) {
  background: #45a049;
  transform: scale(1.1);
}

.mark-read-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* Responsive */
@media (max-width: 350px) {
  .status-buttons {
    grid-template-columns: 1fr;
  }
  
  .agent-meta {
    flex-direction: column;
    gap: 4px;
  }
}
```

---

## 8.3 ‡∏™‡∏£‡∏∏‡∏õ Styling System

**CSS Files ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏ö:**
1. ‚úÖ **App.css** - Core application styles
2. ‚úÖ **components.css** - Component-specific styles

**Design Principles:**
- Mobile-first responsive design
- Smooth transitions and animations
- Consistent spacing and colors
- Accessibility considerations
- Performance optimized

---

# Section 9: Testing & Debugging

<a name="section-9"></a>

## 9.1 Testing Strategy Overview

```
Testing Pyramid
‚îú‚îÄ‚îÄ Manual Testing (User Flow)
‚îú‚îÄ‚îÄ Integration Testing (API + WebSocket)
‚îú‚îÄ‚îÄ Component Testing (React Components)
‚îî‚îÄ‚îÄ Unit Testing (Utilities)
```

---

## 9.2 Pre-Launch Checklist

### üìã Setup Verification

```bash
#!/bin/bash
# Quick verification script

echo "üîç Agent Desktop App - Pre-Launch Checklist"
echo ""

# 1. Check Node.js version
echo "‚úì Node.js version: $(node -v)"

# 2. Check dependencies
echo "‚úì Checking node_modules..."
[ -d "node_modules" ] && echo "  Installed" || echo "  ‚ùå Missing - Run npm install"

# 3. Check environment file
echo "‚úì Checking .env file..."
[ -f ".env" ] && echo "  Found" || echo "  ‚ö†Ô∏è  Missing - Copy from .env.example"

# 4. Check icon files
echo "‚úì Checking icons..."
[ -f "public/assets/icon.png" ] && echo "  icon.png ‚úì" || echo "  ‚ùå icon.png missing"
[ -f "public/assets/tray-icon.png" ] && echo "  tray-icon.png ‚úì" || echo "  ‚ùå tray-icon.png missing"

# 5. Check backend
echo "‚úì Checking backend..."
curl -s http://localhost:3001/health > /dev/null && echo "  Backend online ‚úì" || echo "  ‚ö†Ô∏è  Backend offline"

echo ""
echo "Run: npm run electron-dev"
```

---

## 9.3 Manual Testing Guide

### Test Case 1: Login Flow

```javascript
/**
 * Test: Successful Login
 * 
 * Steps:
 * 1. Open app
 * 2. Enter valid agent code (AG001)
 * 3. Click Sign In
 * 
 * Expected:
 * - Dashboard shows
 * - Agent info displays correctly
 * - WebSocket connects (green status)
 * - Messages load
 */

/**
 * Test: Invalid Login
 * 
 * Steps:
 * 1. Enter invalid code (AG99)
 * 2. Click Sign In
 * 
 * Expected:
 * - Error message shows
 * - Stay on login screen
 */
```

### Test Case 2: Status Changes

```javascript
/**
 * Test: Change Status via WebSocket
 * 
 * Steps:
 * 1. Login successfully
 * 2. Click "Busy" button
 * 
 * Expected:
 * - UI updates immediately (optimistic)
 * - Backend receives update
 * - Status saved to MongoDB
 * 
 * Verify in backend logs:
 * "Status updated: AG001 -> Busy"
 */

/**
 * Test: Status Update Fallback
 * 
 * Steps:
 * 1. Login
 * 2. Stop backend WebSocket (keep HTTP running)
 * 3. Click status button
 * 
 * Expected:
 * - WebSocket fails
 * - HTTP fallback works
 * - Status still updates
 */
```

### Test Case 3: Messages

```javascript
/**
 * Test: Receive Message
 * 
 * Setup:
 * 1. Login as AG001
 * 2. Use Postman to send message:
 *    POST /api/messages/send
 *    {
 *      "fromCode": "SP001",
 *      "toCode": "AG001",
 *      "content": "Test message",
 *      "type": "direct"
 *    }
 * 
 * Expected:
 * - Message appears in UI
 * - Desktop notification shows
 * - Unread badge shows "1 unread"
 */

/**
 * Test: Mark as Read
 * 
 * Steps:
 * 1. Have unread message
 * 2. Click checkmark button
 * 
 * Expected:
 * - Message background changes (blue ‚Üí white)
 * - Checkmark button disappears
 * - Unread count decreases
 */
```

---

## 9.4 Browser DevTools Debugging

### Console Debugging

```javascript
// Access socket in console (development only)
window.socket

// Check socket status
window.socket.connected  // true/false

// Manually emit event
window.socket.emit('update_status', {
  agentCode: 'AG001',
  status: 'Busy'
})

// Listen to events
window.socket.on('new_message', console.log)

// Check auth token
window.electronAPI?.getAuthToken?.()
```

### Network Tab Monitoring

```
1. Open DevTools ‚Üí Network tab
2. Filter: WS (WebSocket)
3. Click on socket connection
4. View Messages tab
5. Monitor events in real-time
```

### React DevTools

```
1. Install React DevTools extension
2. Open Components tab
3. Select component to inspect
4. View props and state
5. Trigger updates manually
```

---

## 9.5 Common Issues & Solutions

### Issue 1: WebSocket Won't Connect

```javascript
// Check backend logs
// Should see: "New client connected: xxxx"

// Verify SOCKET_URL
console.log(process.env.REACT_APP_SOCKET_URL)

// Check socket creation
const socket = io('http://localhost:3001', {
  query: { agentCode: 'AG001', type: 'agent' }
})

// Monitor events
socket.on('connect_error', console.error)
```

**Solutions:**
- Backend not running ‚Üí Start backend
- Wrong URL ‚Üí Check .env file
- Firewall ‚Üí Allow port 3001
- CORS issue ‚Üí Check backend CORS config

### Issue 2: Messages Not Showing

```javascript
// Check messages state
// In React DevTools ‚Üí App component ‚Üí messages array

// Verify API call
await getMessages('AG001', 50)

// Check WebSocket events
window.socket.on('new_message', (msg) => {
  console.log('Received:', msg)
})
```

**Solutions:**
- No messages in DB ‚Üí Send test message via Postman
- Wrong agent code ‚Üí Verify login
- WebSocket not connected ‚Üí Check connection status
- Event handler not registered ‚Üí Check useEffect dependencies

### Issue 3: Status Not Updating

```javascript
// Check status state
// In React DevTools ‚Üí App component ‚Üí status

// Try both methods
sendStatusUpdate('AG001', 'Busy')      // WebSocket
updateAgentStatus('AG001', 'Busy')    // HTTP

// Check backend logs
// Should see: "Status updated: AG001 -> Busy"
```

**Solutions:**
- WebSocket disconnected ‚Üí Check connection
- Invalid status value ‚Üí Use: Available/Busy/Break/Offline
- Token expired ‚Üí Re-login
- Backend error ‚Üí Check backend logs

---

## 9.6 Performance Monitoring

### Memory Leaks Check

```javascript
// Monitor memory usage
console.memory.usedJSHeapSize / 1048576 + ' MB'

// Check for leaks
// 1. Open app
// 2. Login/logout multiple times
// 3. Monitor memory in DevTools Performance tab
// 4. Memory should not increase continuously

// Common leak sources:
// - Socket event listeners not removed
// - Timers not cleared
// - Large closures in state
```

### Component Re-render Tracking

```javascript
// Add to components
useEffect(() => {
  console.log('Component rendered')
})

// Use React DevTools Profiler
// 1. Start recording
// 2. Perform actions
// 3. Stop recording
// 4. Review flame graph
// 5. Identify unnecessary re-renders
```

---

## 9.7 Production Build Testing

### Build Process

```bash
# 1. Build React app
npm run build

# 2. Test production build locally
npm run electron

# 3. Create installer
npm run dist

# 4. Test installer
# - Install on clean system
# - Run application
# - Verify all features work
```

### Production Checklist

```
Before Release:
‚ñ° No console.log in production
‚ñ° Environment variables correct
‚ñ° Error boundaries working
‚ñ° Icons loading correctly
‚ñ° Tray icon working
‚ñ° Notifications working
‚ñ° Login/logout working
‚ñ° WebSocket reconnection working
‚ñ° All status changes working
‚ñ° Messages displaying
‚ñ° Mark as read working
‚ñ° Performance acceptable
‚ñ° No memory leaks
‚ñ° Installer creates shortcuts
‚ñ° Auto-start option works
‚ñ° Uninstaller works
```

---

## 9.8 Debugging Tools Summary

| Tool | Purpose | Usage |
|------|---------|-------|
| **Chrome DevTools** | Inspect, debug, network | F12 |
| **React DevTools** | Component inspection | Browser extension |
| **Network Tab** | Monitor API/WebSocket | DevTools ‚Üí Network |
| **Console** | Logs, errors | DevTools ‚Üí Console |
| **Electron DevTools** | Native debugging | Set `devTools: true` |
| **Backend Logs** | Server-side debugging | Terminal output |
| **MongoDB Compass** | Database inspection | GUI tool |
| **Postman** | API testing | REST client |

---

## 9.9 Quick Debug Commands

```javascript
// In Browser Console:

// 1. Check environment
console.log('ENV:', process.env.NODE_ENV)
console.log('API:', process.env.REACT_APP_API_URL)

// 2. Check socket
console.log('Socket:', window.socket?.connected)

// 3. Check Electron
console.log('Electron:', window.electronAPI?.isElectron)

// 4. Force re-render
// In React DevTools ‚Üí Select component ‚Üí Right-click ‚Üí "Force Update"

// 5. Clear state (logout/login)

// 6. Reload app
window.location.reload()
```

---

## 9.10 ‡∏™‡∏£‡∏∏‡∏õ Section 9

**‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
- ‚úÖ Manual testing checklist
- ‚úÖ Browser DevTools
- ‚úÖ React DevTools
- ‚úÖ Common issues guide
- ‚úÖ Performance monitoring
- ‚úÖ Production testing

**‡∏Å‡∏≤‡∏£ Debug ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console logs
2. ‡πÉ‡∏ä‡πâ Network tab ‡∏î‡∏π requests
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö State ‡πÉ‡∏ô React DevTools
4. Monitor WebSocket events
5. Check backend logs
6. Test edge cases

---

# üéâ Agent Desktop App V3.2 - ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

**‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 9 Sections:**
1. ‚úÖ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°
2. ‚úÖ ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞ Configuration
3. ‚úÖ Electron Core Files
4. ‚úÖ React Application Structure
5. ‚úÖ Components ‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
6. ‚úÖ Services Layer
7. ‚úÖ Utilities ‡πÅ‡∏•‡∏∞ Helpers
8. ‚úÖ Styling System
9. ‚úÖ Testing & Debugging

