# 6.6.3.1 Frontend Applications - Electron Agent App (Student Guide)

## 🎯 Overview

เอกสารนี้จะอธิบายโครงสร้างและการพัฒนา **Agent Desktop Application** ที่สร้างด้วย **Electron.js + React** สำหรับระบบ Agent Wallboard System โดย App นี้จะมีฟีเจอร์พื้นฐานที่ครอบคลุมการทำงานของ Agent

### 🎓 เป้าหมายการเรียนรู้
เมื่อจบการอ่านเอกสารนี้ นักศึกษาจะสามารถ:
- เข้าใจโครงสร้างไฟล์ของ Electron app ที่เตรียมไว้ให้
- รู้วิธีการรัน และทดสอบ Agent Desktop App
- เข้าใจไฟล์หลักที่จะต้องแก้ไขในการพัฒนา
- สามารถปรับแต่งและเพิ่มฟีเจอร์เบื้องต้นได้
- **ทราบสิ่งที่ต้องสร้าง/แก้ไขเพิ่มเติมให้สมบูรณ์**

---

## 🏗️ **Electron App ที่ได้ในชุด Starter Code**

### **📊 ระดับความพร้อมใช้งาน: 65% Complete**

```
✅ พร้อมใช้งาน (มีให้แล้ว):
├── ⚡ Electron app structure สำเร็จรูป
├── 🔐 Login form พร้อม validation
├── 📊 Status change buttons (Available/Busy/Break/Offline)
├── 🔌 WebSocket client connection (พื้นฐาน)
├── 🔔 Basic desktop notifications (โครงสร้าง)
└── 💬 Message receiving และ display (พื้นฐาน)

🔧 นักศึกษาต้องสร้าง/แก้ไข (35%):
├── 🧩 Components ที่ยังไม่สมบูรณ์ (MessagePanel, AgentInfo)
├── 🔗 Services ที่ขาดหาย (notifications.js)
├── 🛠️ Utilities ที่ขาดหาย (dateUtils.js, validation.js)
├── ⚙️ Configuration files (.env, assets)
├── 🎨 CSS styles ที่ขาดหาย
├── 🔧 Error handling ที่ไม่สมบูรณ์
└── 📱 IPC handlers ในส่วนของ Electron
```

---

## 📁 **Project Structure (ที่จะได้เมื่อสมบูรณ์)**

```
agent-desktop/
├── 📦 package.json                # Dependencies: electron, react, socket.io-client
├── 🔧 .env.example                # ❌ ต้องสร้างเอง
├── ⚡ main.js                     # ⚠️ ไม่สมบูรณ์ - ต้องเพิ่ม IPC handlers
├── 🔒 preload.js                  # ✅ มีให้แล้ว
│
├── 📝 public/
│   ├── 🌐 index.html              # ⚠️ ต้องปรับแต่ง
│   └── 🖼️ assets/                 # ❌ ต้องสร้างเอง
│       ├── icon.png               # App icon
│       └── tray-icon.png          # System tray icon
│
├── ⚛️ src/                         # React Application Source
│   ├── 📱 App.js                   # ✅ มีให้แล้ว
│   ├── 🎯 index.js                 # ✅ มีให้แล้ว
│   │
│   ├── 🧩 components/              # UI Components
│   │   ├── 🔐 LoginForm.js         # ✅ มีให้แล้ว
│   │   ├── 📊 StatusPanel.js       # ✅ มีให้แล้ว
│   │   ├── 💬 MessagePanel.js      # ❌ ต้องสร้างเอง
│   │   └── 👤 AgentInfo.js         # ❌ ต้องสร้างเอง
│   │
│   ├── 🔗 services/                # API และ WebSocket Services
│   │   ├── 🌐 api.js               # ⚠️ ไม่สมบูรณ์ - ต้องแก้ไข
│   │   ├── ⚡ socket.js            # ⚠️ ไม่สมบูรณ์ - ต้องแก้ไข
│   │   └── 🔔 notifications.js     # ❌ ต้องสร้างเอง
│   │
│   ├── 🎨 styles/                  # CSS Files
│   │   ├── 📱 App.css              # ⚠️ ไม่สมบูรณ์
│   │   └── 🧩 components.css       # ❌ ต้องสร้างเอง
│   │
│   └── 🛠️ utils/                   # Helper Functions
│       ├── 📅 dateUtils.js         # ❌ ต้องสร้างเอง
│       └── 🛡️ validation.js        # ❌ ต้องสร้างเอง
│
└── 🏗️ build/                       # Built files (auto-generated)
```

---

## 🎯 **สิ่งที่นักศึกษาต้องทำเพิ่มเติม**

### **📋 Task 1: สร้าง Missing Components**

#### **💬 MessagePanel.js (ต้องสร้างใหม่)**
```javascript
// src/components/MessagePanel.js
// ❌ ไฟล์นี้ไม่มี - ต้องสร้างเอง

import React from 'react';

function MessagePanel({ messages }) {
  // TODO: นักศึกษาต้องเขียนโค้ด
  // 1. แสดงรายการข้อความ
  // 2. แสดง "No messages" เมื่อไม่มีข้อความ
  // 3. แสดงเวลาและผู้ส่ง
  // 4. จัดการ scroll เมื่อมีข้อความใหม่
  
  return (
    <div className="message-panel">
      <h3>Messages ({messages.length})</h3>
      {/* TODO: แสดงรายการข้อความ */}
    </div>
  );
}

export default MessagePanel;
```

**💡 คำแนะนำ:**
- ใช้ `map()` เพื่อแสดงรายการข้อความ
- ใช้ `new Date().toLocaleTimeString()` เพื่อแสดงเวลา
- เพิ่ม CSS class สำหรับ styling

#### **👤 AgentInfo.js (ต้องสร้างใหม่)**
```javascript
// src/components/AgentInfo.js
// ❌ ไฟล์นี้ไม่มี - ต้องสร้างเอง

import React from 'react';

function AgentInfo({ agent, status }) {
  // TODO: นักศึกษาต้องเขียนโค้ด
  // 1. แสดงชื่อ agent
  // 2. แสดง agent code
  // 3. แสดง team information
  // 4. แสดง current status พร้อมสี
  
  if (!agent) return null;

  return (
    <div className="agent-info">
      {/* TODO: แสดงข้อมูล agent */}
    </div>
  );
}

export default AgentInfo;
```

---

### **📋 Task 2: สร้าง Missing Services**

#### **🔔 notifications.js (ต้องสร้างใหม่)**
```javascript
// src/services/notifications.js
// ❌ ไฟล์นี้ไม่มี - ต้องสร้างเอง

// TODO: นักศึกษาต้องเขียนฟังก์ชัน
// 1. showDesktopNotification() - แสดง notification
// 2. requestNotificationPermission() - ขอ permission
// 3. playNotificationSound() - เล่นเสียงแจ้งเตือน (optional)

export const showDesktopNotification = (title, body, icon = null) => {
  // TODO: ตรวจสอบว่าเป็น Electron environment
  // TODO: ใช้ window.electronAPI ถ้าเป็น Electron
  // TODO: ใช้ browser Notification API ถ้าเป็น web
};

export const requestNotificationPermission = async () => {
  // TODO: ขอ permission สำหรับ notifications
};
```

---

### **📋 Task 3: สร้าง Missing Utilities**

#### **📅 dateUtils.js (ต้องสร้างใหม่)**
```javascript
// src/utils/dateUtils.js
// ❌ ไฟล์นี้ไม่มี - ต้องสร้างเอง

// TODO: นักศึกษาต้องเขียนฟังก์ชัน
// 1. formatTime() - แสดงเวลาแบบ HH:MM
// 2. formatDateTime() - แสดงวันที่และเวลา
// 3. getTimeAgo() - แสดงว่า "5 minutes ago"

export const formatTime = (timestamp) => {
  // TODO: return เวลาในรูปแบบ HH:MM
};

export const getTimeAgo = (timestamp) => {
  // TODO: คำนวณและ return "X minutes ago", "X hours ago"
};
```

#### **🛡️ validation.js (ต้องสร้างใหม่)**
```javascript
// src/utils/validation.js
// ❌ ไฟล์นี้ไม่มี - ต้องสร้างเอง

// TODO: นักศึกษาต้องเขียนฟังก์ชัน validation
// 1. validateAgentCode() - ตรวจสอบรูปแบบ agent code
// 2. validateStatus() - ตรวจสอบ status ที่ถูกต้อง

export const validateAgentCode = (code) => {
  // TODO: ตรวจสอบว่า code เป็นรูปแบบ AG001, SP001 หรือไม่
  // TODO: return error message หรือ null
};
```

---

### **📋 Task 4: แก้ไข Services ที่ไม่สมบูรณ์**

#### **🌐 api.js (ต้องปรับปรุง)**
```javascript
// src/services/api.js
// ⚠️ ไฟล์นี้มีแล้ว แต่ไม่สมบูรณ์

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';

export const loginAgent = async (agentCode) => {
  const response = await fetch(`${API_BASE_URL}/auth/login`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ agentCode })
  });

  if (!response.ok) {
    // ❌ ปัญหา: error message ไม่ชัดเจน
    throw new Error('Login failed'); 
  }

  const result = await response.json();
  
  // ❌ ปัญหา: ไม่ได้ return ข้อมูลที่ถูกต้อง
  return result; // TODO: ควร return result.data
};

// TODO: เพิ่มฟังก์ชันอื่น ๆ
// - updateAgentStatus()
// - getAgentInfo()
// - sendMessage()
```

**🔧 สิ่งที่ต้องแก้ไข:**
1. ปรับปรุง error handling ให้แสดงข้อความที่ชัดเจน
2. ปรับปรุง response handling ให้ถูกต้อง
3. เพิ่ม token management
4. เพิ่มฟังก์ชัน API อื่น ๆ

#### **⚡ socket.js (ต้องปรับปรุง)**
```javascript
// src/services/socket.js
// ⚠️ ไฟล์นี้มีแล้ว แต่ไม่สมบูรณ์

import io from 'socket.io-client';

const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';
let socket = null;

export const connectSocket = (agentCode) => {
  socket = io(SOCKET_URL, {
    query: { agentCode, type: 'agent' }
  });

  socket.on('connect', () => {
    console.log('Connected to server');
  });

  socket.on('disconnect', () => {
    console.log('Disconnected from server');
  });

  // ❌ ปัญหา: ไม่มี error handling และ reconnection logic
  // TODO: เพิ่ม error handling
  // TODO: เพิ่ม reconnection logic
  // TODO: เพิ่ม connection timeout handling

  window.socket = socket;
  return socket;
};
```

**🔧 สิ่งที่ต้องแก้ไข:**
1. เพิ่ม error handling สำหรับ connection errors
2. เพิ่ม automatic reconnection
3. เพิ่ม connection timeout handling
4. เพิ่ม authentication error handling

---

### **📋 Task 5: สร้าง Configuration Files**

#### **🔧 .env.example (ต้องสร้างใหม่)**
```bash
# .env.example
# ❌ ไฟล์นี้ไม่มี - ต้องสร้างเอง

REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_SOCKET_URL=http://localhost:3001
ELECTRON_IS_DEV=true
```

#### **🌐 public/index.html (ต้องปรับแต่ง)**
```html
<!-- public/index.html -->
<!-- ⚠️ ไฟล์นี้มีแล้ว แต่ต้องปรับแต่ง -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Agent Wallboard Desktop Application" />
    <!-- TODO: เพิ่ม icon reference -->
    <link rel="icon" href="%PUBLIC_URL%/assets/icon.png" />
    <title>Agent Wallboard</title>
    <!-- TODO: เพิ่ม CSS สำหรับ Electron -->
    <style>
      body {
        zoom: 1;
        overflow-x: hidden;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
```

---

### **📋 Task 6: แก้ไข main.js**

#### **⚡ main.js (ต้องเพิ่ม IPC handlers)**
```javascript
// main.js
// ⚠️ ไฟล์นี้มีโครงสร้างแล้ว แต่ขาด IPC handlers

const { app, BrowserWindow, Tray, Menu, ipcMain, Notification } = require('electron');
const path = require('path');
const isDev = process.env.NODE_ENV === 'development';

let mainWindow;
let tray;

// ❌ ขาดหาย: IPC handlers
// TODO: เพิ่ม IPC handlers สำหรับ
// 1. show-notification
// 2. close-app
// 3. minimize-to-tray
// 4. show-app

ipcMain.handle('show-notification', (event, { title, body }) => {
  // TODO: แสดง native notification
});

ipcMain.handle('close-app', () => {
  // TODO: ปิดแอปพลิเคชัน
});

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 400,
    height: 600,
    // TODO: เพิ่ม minWidth, minHeight
    // TODO: ปรับแต่ง window options
    icon: path.join(__dirname, 'public/assets/icon.png'),
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, 'preload.js')
    },
    // TODO: เพิ่ม show: false เพื่อให้ show เมื่อพร้อม
  });

  // TODO: เพิ่ม window event handlers
  // - ready-to-show
  // - close (minimize to tray แทน close)
}

// ที่เหลือของโค้ดมีให้แล้ว...
```

---

### **📋 Task 7: เพิ่ม CSS Styles**

#### **🎨 styles/components.css (ต้องสร้างใหม่)**
```css
/* src/styles/components.css */
/* ❌ ไฟล์นี้ไม่มี - ต้องสร้างเอง */

/* TODO: เพิ่ม styles สำหรับ */
/* 1. message-panel */
/* 2. agent-info */
/* 3. loading states */
/* 4. error states */

.message-panel {
  /* TODO: styling สำหรับ message panel */
}

.message-item {
  /* TODO: styling สำหรับแต่ละข้อความ */
}

.agent-info {
  /* TODO: styling สำหรับ agent information */
}

.loading {
  /* TODO: styling สำหรับ loading state */
}

.error {
  /* TODO: styling สำหรับ error state */
}
```

---

### **📋 Task 8: สร้าง Asset Files**

```
public/assets/                 # ❌ โฟลเดอร์นี้ไม่มี - ต้องสร้างเอง
├── icon.png                   # App icon (256x256 pixels)
├── tray-icon.png             # System tray icon (16x16 pixels)
└── notification.mp3          # Notification sound (optional)
```

**💡 คำแนะนำ:**
- ใช้ icon generator online สำหรับสร้าง icons
- ดาวน์โหลด free notification sound จาก freesound.org
- หรือใช้ placeholder icons จาก internet

---

## 🧪 **Testing Guidelines**

### **✅ Testing Checklist สำหรับนักศึกษา**

**📋 พื้นฐานที่ต้องทำงานก่อน:**
- [ ] สร้างไฟล์ที่ขาดหายครบทั้งหมด
- [ ] แก้ไขไฟล์ที่ไม่สมบูรณ์
- [ ] ติดตั้ง dependencies ครบถ้วน
- [ ] สร้าง .env file จาก .env.example

**📋 การทดสอบแต่ละส่วน:**
- [ ] **App เปิดได้:** `npm run electron-dev`
- [ ] **Login ทำงาน:** สามารถ login ด้วย AG001, AG002
- [ ] **Status change ทำงาน:** เปลี่ยน status ได้และแสดงสีถูกต้อง
- [ ] **Messages แสดงได้:** รับข้อความจาก supervisor
- [ ] **Notifications ทำงาน:** แสดง desktop notification
- [ ] **System tray ทำงาน:** มี icon ใน system tray

**📋 Integration Testing:**
- [ ] Status change แสดงใน supervisor dashboard แบบ real-time
- [ ] รับข้อความจาก supervisor และแสดง notification
- [ ] Multiple agents ทำงานพร้อมกันได้

---

## 💡 **Development Tips**

### **🔍 การ Debug:**
```bash
# เปิด DevTools ใน Electron
mainWindow.webContents.openDevTools();

# ดู console logs
console.log('Debug message');

# ดู WebSocket connection status
console.log('Socket connected:', window.socket?.connected);
```

### **📚 การเรียนรู้:**
1. **เริ่มจากไฟล์ง่าย ๆ** - dateUtils.js, validation.js
2. **ทำทีละ component** - MessagePanel → AgentInfo → Services
3. **ทดสอบทุกขั้นตอน** - แก้ไขนิดหน่อยแล้วทดสอบ
4. **ใช้ console.log** - เพื่อ debug และเข้าใจ data flow

### **🛠️ การแก้ไขปัญหา:**
```bash
# ถ้า npm install ล้มเหลว
rm -rf node_modules package-lock.json
npm install

# ถ้า Electron ไม่เปิด
npm install electron --save-dev

# ถ้า WebSocket ไม่เชื่อมต่อ
# ตรวจสอบ backend กำลังทำงานที่ port 3001
curl http://localhost:3001/health
```

---

## 📞 **Common Issues & Solutions**

### **❌ "Module not found" errors**
**สาเหตุ:** ไฟล์ที่ import ยังไม่มี
**วิธีแก้:** สร้างไฟล์ที่ขาดหายก่อน

### **❌ "Cannot read property of undefined"**
**สาเหตุ:** ข้อมูลยังไม่โหลดมา
**วิธีแก้:** เพิ่มการตรวจสอบ `if (!data) return null;`

### **❌ WebSocket connection failed**
**สาเหตุ:** Backend ไม่ทำงานหรือ CORS ไม่ถูกต้อง
**วิธีแก้:** ตรวจสอบ backend และ .env file

### **❌ Notification ไม่แสดง**
**สาเหตุ:** ไม่ได้ขอ permission
**วิธีแก้:** เรียก `requestNotificationPermission()` ก่อน

---

## 🎯 **Learning Outcomes**

เมื่อทำงานนี้เสร็จ นักศึกษาจะได้เรียนรู้:

### **🎓 Technical Skills:**
- **Electron.js** - การสร้าง desktop application
- **React** - การสร้าง UI components และ state management
- **WebSocket** - การใช้งาน real-time communication
- **IPC** - การสื่อสารระหว่าง main และ renderer process
- **File Structure** - การจัดระเบียบโค้ดในโปรเจกต์ขนาดใหญ่

### **🔧 Development Skills:**
- **Problem Solving** - การแก้ไขปัญหาจากโค้ดที่ไม่สมบูรณ์
- **Code Reading** - การอ่านและเข้าใจโค้ดที่มีอยู่
- **Integration** - การเชื่อมต่อส่วนต่าง ๆ ให้ทำงานร่วมกัน
- **Testing & Debugging** - การทดสอบและแก้ไข bugs

### **💼 Professional Skills:**
- **Following Specifications** - การทำงานตามเอกสารที่กำหนด
- **Code Organization** - การจัดระเบียบโค้ดให้อ่านง่าย
- **Documentation** - การเขียนคอมเมนต์และอธิบายโค้ด

---

## ✅ **Summary**

**🎯 สิ่งที่นักศึกษาจะได้:**
- โครงสร้าง Electron app ที่ใช้งานได้ 65%
- ตัวอย่างโค้ดที่ดีสำหรับ reference
- รายการงานที่ต้องทำอย่างชัดเจน
- Guidelines สำหรับการแก้ไขและปรับปรุง

**🔧 สิ่งที่ต้องทำเพิ่ม (35%):**
- สร้างไฟล์ที่ขาดหาย (7-8 ไฟล์)
- แก้ไขไฟล์ที่ไม่สมบูรณ์ (3-4 ไฟล์)
- เพิ่ม error handling และ edge cases
- ทดสอบและ debug ให้ทำงานได้

**⏱️ เวลาที่คาดว่าจะใช้:**
- **Week 1:** ทำให้ app ทำงานได้พื้นฐาน (4-6 ชั่วโมง)
- **Week 2:** ปรับปรุงและเพิ่มฟีเจอร์ (2-4 ชั่วโมง)

**🚀 เป้าหมาย:** สร้าง desktop application ที่ใช้งานได้จริงและเชื่อมต่อกับ backend แบบ real-time!

**Happy Coding! 💻✨**