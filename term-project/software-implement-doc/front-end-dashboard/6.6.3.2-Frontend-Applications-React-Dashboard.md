ได้ครับ ผมจะปรับโครงสร้างให้คำอธิบายแต่ละไฟล์อยู่ในหัวข้อ code ของไฟล์นั้นๆ เลย เพื่อความสะดวกในการอ่านและทำความเข้าใจ

---

# 6.6.3.2 Frontend - Supervisor Dashboard (Complete Guide V2.0)

## 📖 สารบัญ
1. [ภาพรวมการทำงานของระบบ](#overview)
2. [Setup & Installation](#setup)
3. [Project Structure](#structure)
4. [Source Code](#source-code)

---

<a name="overview"></a>
## 1. ภาพรวมการทำงานของ Supervisor Dashboard

### 🎯 Dashboard ทำอะไร?

**Supervisor Dashboard** เป็นเว็บแอปพลิเคชันสำหรับ Supervisor ติดตามทีม Agent แบบ real-time

**การทำงานหลัก:**
```
1. Supervisor เข้าสู่ระบบด้วยรหัส (SP001)
2. Dashboard โหลดข้อมูล Agents ในทีม
3. เชื่อมต่อ WebSocket เพื่อรับ real-time updates
4. แสดงสถานะ Agents และสถิติทีม
5. Supervisor สามารถส่งข้อความถึง Agents
```

### 🔄 Data Flow

```
┌─────────────────────────────────────────────────────────────┐
│                     SUPERVISOR DASHBOARD                    │
└─────────────────────────────────────────────────────────────┘
                              │
                ┌─────────────┴─────────────┐
                │                           │
        ┌───────▼────────┐         ┌────────▼────────┐
        │   HTTP API     │         │   WebSocket     │
        │   (REST)       │         │   (Real-time)   │
        └───────┬────────┘         └────────┬────────┘
                │                           │
                │  1. Login                 │  3. Listen events:
                │  2. Get team data         │     - agent_status_update
                │  3. Send messages         │     - agent_connected
                │                           │     - agent_disconnected
                │                           │     - new_message
                └─────────────┬─────────────┘
                              │
                    ┌─────────▼─────────┐
                    │  Backend Server   │
                    │  (Node.js)        │
                    └─────────┬─────────┘
                              │
                    ┌─────────┴────────┐
                    │                  │
            ┌───────▼────────┐  ┌──────▼──────┐
            │  SQLite        │  │  MongoDB    │
            │  (Agents info) │  │  (Status,   │
            │                │  │   Messages) │
            └────────────────┘  └─────────────┘
```

### 📱 User Flow

```
[Login Page]
    │
    ├─→ กรอก Supervisor Code (SP001)
    ├─→ กด Sign In
    ├─→ Backend ตรวจสอบ
    │
    ▼
[Dashboard]
    │
    ├─→ แสดง Team Overview (สถิติ)
    ├─→ แสดง Agent Cards (แต่ละคน)
    ├─→ เชื่อมต่อ WebSocket
    │
    ├─→ รับ real-time updates:
    │   ├─ Agent เปลี่ยน status → Card อัพเดท
    │   ├─ Agent online/offline → สีเปลี่ยน
    │   └─ Message ใหม่ → แสดง notification
    │
    └─→ Actions:
        ├─ กรอง Agent ตาม status
        ├─ ส่งข้อความถึง Agent
        └─ Logout
```

---

<a name="setup"></a>
## 2. Setup & Installation

### ขั้นตอนที่ 1: สร้างโปรเจค

```bash
npx create-react-app supervisor-dashboard
cd supervisor-dashboard
```

### ขั้นตอนที่ 2: ติดตั้ง Dependencies

```bash
# Material-UI
npm install @mui/material @emotion/react @emotion/styled @mui/icons-material

# WebSocket
npm install socket.io-client

# Date utilities
npm install date-fns
```

### ขั้นตอนที่ 3: Configuration Files

**package.json:**
```json
{
  "name": "supervisor-dashboard",
  "version": "1.0.0",
  "private": true,
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.2",
    "@mui/material": "^7.3.2",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.0",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^13.5.0",
    "date-fns": "^4.1.0",
    "react": "^19.1.1",
    "react-dom": "^19.1.1",
    "react-scripts": "5.0.1",
    "socket.io-client": "^4.8.1",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
```

**.env:**
```bash
REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_SOCKET_URL=http://localhost:3001
```

**.gitignore:**
```gitignore
# Dependencies
node_modules/
/.pnp
.pnp.js

# Testing
/coverage

# Production
/build

# Misc
.DS_Store
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*
```

---

<a name="structure"></a>
## 3. Project Structure

```
supervisor-dashboard/
│
├── package.json
├── .env
├── .gitignore
│
├── public/
│   ├── index.html
│   └── manifest.json
│
└── src/
    ├── index.js
    ├── App.js
    ├── App.css
    │
    ├── components/
    │   ├── ErrorBoundary.js
    │   ├── LoginForm.js
    │   ├── Dashboard.js
    │   ├── TeamOverview.js
    │   ├── AgentCard.js
    │   ├── MessagePanel.js
    │   └── StatusFilter.js
    │
    ├── services/
    │   ├── api.js
    │   ├── socket.js
    │   └── auth.js
    │
    ├── hooks/
    │   ├── useSocket.js
    │   └── useTeamData.js
    │
    ├── utils/
    │   ├── statusUtils.js
    │   ├── dateFormat.js
    │   └── validation.js
    │
    └── theme/
        ├── theme.js
        └── colors.js
```

---

<a name="source-code"></a>
## 4. Source Code

### 📄 public/index.html

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#1976d2" />
    <meta
      name="description"
      content="Supervisor Dashboard for Agent Wallboard System - Monitor and manage your team in real-time"
    />
    <title>Supervisor Dashboard - Agent Wallboard</title>
    
    <!-- Roboto Font (Material-UI default) -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    />
    
    <!-- Material Icons (optional) -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
  </head>
  <body>
    <noscript>
      You need to enable JavaScript to run this application.
    </noscript>
    <div id="root"></div>
  </body>
</html>
```

### 📄 public/manifest.json

```json
{
  "short_name": "Supervisor Dashboard",
  "name": "Agent Wallboard - Supervisor Dashboard",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#1976d2",
  "background_color": "#ffffff"
}
```

### 📄 src/index.js

**หน้าที่:** Entry point ของ React application - ไฟล์แรกที่ทำงาน
- สร้าง root element และ render App component ลงใน DOM
- ใช้ StrictMode เพื่อ detect potential problems

```javascript
import React from 'react';
import ReactDOM from 'react-dom/client';
import './App.css';
import App from './App';

// สร้าง root element
const root = ReactDOM.createRoot(document.getElementById('root'));

// Render App
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
```

### 📄 src/App.css

**หน้าที่:** Global styles สำหรับทั้ง application

```css
/* Reset */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* Body */
body {
  font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: #f5f5f5;
}

/* Code */
code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;
}

/* Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #555;
}
```

### 📄 src/theme/colors.js

**หน้าที่:** Color palette สำหรับทั้งระบบ
- กำหนดสีสำหรับแต่ละ status
- Helper functions สำหรับดึงสี

```javascript
/**
 * สีสำหรับแต่ละ Status
 */
export const statusColors = {
  Available: '#4caf50',  // เขียว - พร้อมรับงาน
  Busy: '#ff9800',       // ส้ม - ไม่ว่าง
  Break: '#2196f3',      // น้ำเงิน - พัก
  Offline: '#9e9e9e',    // เทา - ออฟไลน์
};

/**
 * ดึงสี status
 */
export const getStatusColor = (status) => {
  return statusColors[status] || statusColors.Offline;
};

/**
 * Priority Colors (สำหรับข้อความ)
 */
export const priorityColors = {
  low: '#4caf50',
  normal: '#2196f3',
  high: '#f44336',
};

/**
 * Chart Colors (สำหรับกราฟ/สถิติ)
 */
export const chartColors = [
  '#1976d2', // Blue
  '#dc004e', // Pink
  '#4caf50', // Green
  '#ff9800', // Orange
  '#9c27b0', // Purple
  '#00bcd4', // Cyan
];
```

### 📄 src/theme/theme.js

**หน้าที่:** Material-UI theme configuration
- กำหนด color palette, typography, component styles

```javascript
import { createTheme } from '@mui/material/styles';

const theme = createTheme({
  // ชุดสีหลัก
  palette: {
    primary: {
      main: '#1976d2',
      light: '#42a5f5',
      dark: '#1565c0',
    },
    secondary: {
      main: '#dc004e',
    },
    success: {
      main: '#4caf50',
    },
    warning: {
      main: '#ff9800',
    },
    info: {
      main: '#2196f3',
    },
    error: {
      main: '#f44336',
    },
  },
  
  // Typography
  typography: {
    fontFamily: '"Roboto", "Helvetica", "Arial", sans-serif',
    h4: { fontWeight: 600 },
    h6: { fontWeight: 500 },
  },
  
  // Component customization
  components: {
    MuiCard: {
      styleOverrides: {
        root: {
          borderRadius: 8,
          transition: 'box-shadow 0.2s',
          '&:hover': {
            boxShadow: '0 4px 20px rgba(0,0,0,0.12)',
          },
        },
      },
    },
    MuiButton: {
      styleOverrides: {
        root: {
          borderRadius: 6,
          textTransform: 'none',
          fontWeight: 500,
        },
      },
    },
  },
});

export default theme;
```

### 📄 src/services/auth.js

**หน้าที่:** จัดการ JWT token
- setToken() - เก็บ token หลัง login
- getToken() - ดึง token มาใช้ใน API calls
- clearToken() - ลบ token เมื่อ logout
- isAuthenticated() - ตรวจสอบว่า login อยู่หรือไม่

```javascript
// เปลี่ยนจาก in-memory เป็น localStorage
const TOKEN_KEY = 'supervisor_token';
const USER_KEY = 'supervisor_data';

export const setToken = (token) => {
  try {
    localStorage.setItem(TOKEN_KEY, token);
  } catch (error) {
    console.error('Failed to save token:', error);
  }
};

export const getToken = () => {
  try {
    return localStorage.getItem(TOKEN_KEY);
  } catch (error) {
    console.error('Failed to get token:', error);
    return null;
  }
};

export const clearToken = () => {
  try {
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(USER_KEY);
  } catch (error) {
    console.error('Failed to clear token:', error);
  }
};

export const isAuthenticated = () => {
  return getToken() !== null;
};

// เพิ่ม functions สำหรับ user data
export const setSupervisorData = (data) => {
  try {
    localStorage.setItem(USER_KEY, JSON.stringify(data));
  } catch (error) {
    console.error('Failed to save supervisor data:', error);
  }
};

export const getSupervisorData = () => {
  try {
    const data = localStorage.getItem(USER_KEY);
    return data ? JSON.parse(data) : null;
  } catch (error) {
    console.error('Failed to get supervisor data:', error);
    return null;
  }
};

```

### 📄 src/services/api.js

**หน้าที่:** จัดการ HTTP requests ทั้งหมด
- loginSupervisor() - POST /api/auth/login
- sendMessage() - POST /api/messages/send  
- checkServerHealth() - GET /health

```javascript
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';

/**
 * Login Supervisor
 */
export const loginSupervisor = async (supervisorCode) => {
  const response = await fetch(`${API_BASE_URL}/auth/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ supervisorCode })
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error || 'Login failed');
  }

  return response.json();
};

/**
 * Send Message
 */
export const sendMessage = async (messageData, token) => {
  const response = await fetch(`${API_BASE_URL}/messages/send`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(messageData)
  });

  if (!response.ok) {
    throw new Error('Failed to send message');
  }

  return response.json();
};

/**
 * Check Server Health
 */
export const checkServerHealth = async () => {
  const response = await fetch(API_BASE_URL.replace('/api', '/health'));
  return response.json();
};
```

### 📄 src/services/socket.js

**หน้าที่:** จัดการ WebSocket connection
- connectSocket() - สร้าง connection พร้อม authenticate
- disconnectSocket() - ปิด connection
- getSocket() - ดึง socket instance

```javascript
import io from 'socket.io-client';

const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';
let socket = null;

/**
 * Connect WebSocket as Supervisor
 */
export const connectSocket = (supervisorCode) => {
    // ตัด connection เก่า (ถ้ามี)    
    if (socket) {
        socket.disconnect();
    }

    console.log('Connecting to WebSocket...', SOCKET_URL);

    // สร้าง connection
    socket = io(SOCKET_URL, {
        query: {
            supervisorCode: supervisorCode.toUpperCase(),
            type: 'supervisor'
        },
        reconnection: true,
        reconnectionAttempts: 5,
        reconnectionDelay: 1000
    });

    // ✅ เพิ่ม: emit supervisor_connect เมื่อเชื่อมต่อสำเร็จ
    socket.on('connect', () => {
        console.log('Socket connected, sending supervisor_connect...');
        socket.emit('supervisor_connect', {
            supervisorCode: supervisorCode.toUpperCase()
        });
    });

    // เก็บไว้ใน window เพื่อ debug
    window.socket = socket;

    return socket;
};

/**
 * Disconnect WebSocket
 */
export const disconnectSocket = () => {
    if (socket) {
        socket.disconnect();
        socket = null;
        window.socket = null;
    }
};

/**
 * Get current socket instance
 */
export const getSocket = () => socket;
```

### 📄 src/utils/statusUtils.js

**หน้าที่:** Helper functions สำหรับ status
- getStatusColor() - return hex color
- getStatusIcon() - return Material-UI icon component
- ใช้ใน AgentCard, StatusFilter, etc.

```javascript
import { 
  CheckCircle,  // Available
  Cancel,       // Busy
  Pause,        // Break
  PowerOff      // Offline
} from '@mui/icons-material';

/**
 * ดึงสี status
 */
export const getStatusColor = (status) => {
  const colors = {
    Available: '#4caf50',
    Busy: '#ff9800',
    Break: '#2196f3',
    Offline: '#9e9e9e'
  };
  return colors[status] || colors.Offline;
};

/**
 * ดึง icon component สำหรับ status
 */
export const getStatusIcon = (status) => {
  const icons = {
    Available: CheckCircle,
    Busy: Cancel,
    Break: Pause,
    Offline: PowerOff
  };
  return icons[status] || PowerOff;
};

/**
 * ดึง label ของ status
 */
export const getStatusLabel = (status) => {
  return status || 'Unknown';
};
```

### 📄 src/utils/dateFormat.js

**หน้าที่:** Format dates/times
- formatTime() - "14:30"
- formatTimeAgo() - "5 minutes ago"
- ใช้แสดง last update time ใน AgentCard

```javascript
import { format, formatDistance } from 'date-fns';

/**
 * Format timestamp เป็น HH:mm
 */
export const formatTime = (timestamp) => {
  try {
    return format(new Date(timestamp), 'HH:mm');
  } catch (error) {
    return '--:--';
  }
};

/**
 * Format timestamp เป็น DD/MM/YYYY HH:mm
 */
export const formatDateTime = (timestamp) => {
  try {
    return format(new Date(timestamp), 'dd/MM/yyyy HH:mm');
  } catch (error) {
    return 'Invalid date';
  }
};

/**
 * แสดงเวลาแบบ relative (เมื่อไหร่)
 */
export const formatTimeAgo = (timestamp) => {
  try {
    if (!timestamp) return 'unknown';
    return formatDistance(new Date(timestamp), new Date(), {
      addSuffix: true
    });
  } catch (error) {
    return 'unknown';
  }
};
```

### 📄 src/utils/validation.js

**หน้าที่:** Validate inputs
- validateSupervisorCode() - ตรวจสอบ format SP001
- validateMessage() - ต้องไม่ว่าง, ไม่เกิน 500 chars
- Return error message หรือ null (valid)

```javascript
/**
 * Validate Supervisor Code
 * Format: SP + 3 digits (SP001, SP002, etc.)
 */
export const validateSupervisorCode = (code) => {
  if (!code) {
    return 'Supervisor code is required';
  }

  const trimmed = code.trim().toUpperCase();

  if (trimmed.length === 0) {
    return 'Supervisor code cannot be empty';
  }

  // ตรวจสอบ format: SP + 3 digits
  const pattern = /^SP\d{3}$/;
  if (!pattern.test(trimmed)) {
    return 'Invalid format. Use SP001, SP002, etc.';
  }

  return null; // valid
};

/**
 * Validate Message Content
 */
export const validateMessage = (content) => {
  if (!content || !content.trim()) {
    return 'Message cannot be empty';
  }

  if (content.length > 500) {
    return 'Message is too long (max 500 characters)';
  }

  return null; // valid
};

/**
 * Validate Email (ถ้าต้องการใช้)
 */
export const validateEmail = (email) => {
  if (!email) {
    return 'Email is required';
  }

  const pattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!pattern.test(email)) {
    return 'Invalid email format';
  }

  return null;
};
```


### 📄 src/utils/transformers.js

**หน้าที่:** Validate inputs
- Transform agent data from API to UI format

```javascript
/**
 * Transform agent data from API to UI format
 */
export const transformAgent = (agent, defaultTeamId = null) => {
  if (!agent) return null;

  return {
    agentCode: agent.agent_code || agent.agentCode,
    agentName: agent.agent_name || agent.agentName,
    role: agent.role || 'agent',
    email: agent.email || '',
    phone: agent.phone || '',
    team_id: agent.team_id || agent.teamId || defaultTeamId,
    // UI fields
    currentStatus: agent.currentStatus || 'Offline',
    isOnline: agent.isOnline || false,
    lastUpdate: agent.lastUpdate || new Date(),
    lastSeen: agent.lastSeen || new Date()
  };
};

export const transformAgents = (agents, defaultTeamId = null) => {
  if (!Array.isArray(agents)) return [];
  return agents.map(agent => transformAgent(agent, defaultTeamId)).filter(a => a !== null);
};
```

### 📄 src/hooks/useSocket.js

**หน้าที่:** Custom hook จัดการ WebSocket
- Connect เมื่อ component mount
- Disconnect เมื่อ component unmount (cleanup)
- Return socket instance

```javascript
import { useEffect, useRef } from 'react';
import { connectSocket, disconnectSocket } from '../services/socket';

export const useSocket = (supervisorCode, onConnect) => {
  const socketRef = useRef(null);

  useEffect(() => {
    if (supervisorCode) {
      // Connect
      console.log('useSocket: Connecting...');
      socketRef.current = connectSocket(supervisorCode);

      // Callback เมื่อเชื่อมต่อสำเร็จ
      if (onConnect) {
        socketRef.current.on('connect', onConnect);
      }

      // Cleanup: Disconnect เมื่อ unmount
      return () => {
        console.log('useSocket: Disconnecting...');
        disconnectSocket();
      };
    }
  }, [supervisorCode, onConnect]);

  return socketRef.current;
};
```

### 📄 src/hooks/useTeamData.js

**หน้าที่:** Custom hook จัดการ team data
- เก็บ state ของ agents
- updateAgentStatus() - update agent in array
- setAgentOnline() - update online status
- Return { agents, updateAgent, setOnline }

```javascript
import { useState } from 'react';

export const useTeamData = (initialData = []) => {
  const [agents, setAgents] = useState(initialData);

  /**
   * Update agent status
   */
  const updateAgentStatus = (agentCode, status, timestamp) => {
    setAgents(prev => prev.map(agent =>
      agent.agentCode === agentCode
        ? { 
            ...agent, 
            currentStatus: status,
            lastUpdate: timestamp 
          }
        : agent
    ));
  };

  /**
   * Set agent online/offline
   */
  const setAgentOnline = (agentCode, isOnline, timestamp) => {
    setAgents(prev => prev.map(agent =>
      agent.agentCode === agentCode
        ? { 
            ...agent, 
            isOnline,
            lastSeen: timestamp 
          }
        : agent
    ));
  };

  /**
   * Reset team data
   */
  const resetTeamData = (newData) => {
    setAgents(newData);
  };

  return {
    agents,
    updateAgentStatus,
    setAgentOnline,
    resetTeamData
  };
};
```

---

## Components

### 📄 src/App.js

**หน้าที่:** Main application component - จัดการ state และ logic หลักทั้งหมด
- เก็บ state: isLoggedIn, supervisor, teamData, messages, socketConnected
- Handle login → เรียก API → ได้ token
- เชื่อมต่อ WebSocket เมื่อ login และ listen events
- Update state เมื่อมีการเปลี่ยนแปลง (real-time)
- Route ระหว่าง LoginForm และ Dashboard ตาม login state

```javascript
import React, { useState, useEffect, useRef } from 'react';
import {
  ThemeProvider,
  CssBaseline,
  Container,
  Box,              // ← เพิ่ม
  CircularProgress, // ← เพิ่ม
  Typography        // ← เพิ่ม
} from '@mui/material';
import LoginForm from './components/LoginForm';
import Dashboard from './components/Dashboard';
import ErrorBoundary from './components/ErrorBoundary';
import { connectSocket, disconnectSocket, getSocket } from './services/socket';
import {
  setToken,
  getToken,
  clearToken,
  setSupervisorData,
  getSupervisorData
} from './services/auth';
import theme from './theme/theme';
import './App.css';
import { transformAgents } from './utils/transformers';

function App() {
  // STATE
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [supervisor, setSupervisor] = useState(null);
  const [teamData, setTeamData] = useState([]);
  const [messages, setMessages] = useState([]);
  const [socketConnected, setSocketConnected] = useState(false);
  const [isRestoring, setIsRestoring] = useState(true); // เพิ่ม loading state

  const socketRef = useRef(null);

  // ✅ เพิ่ม: Restore session เมื่อ component mount
  useEffect(() => {
    const restoreSession = async () => {
      console.log('🔄 Attempting to restore session...');

      const savedToken = getToken();
      const savedSupervisor = getSupervisorData();

      if (savedToken && savedSupervisor) {
        console.log('✅ Found saved session:', savedSupervisor.supervisorCode);

        try {
          // ตรวจสอบว่า token ยังใช้งานได้หรือไม่
          // โดยเรียก API ที่ต้องการ authentication
          const response = await fetch(
            `${process.env.REACT_APP_API_URL}/agents/team/${savedSupervisor.teamId}`,
            {
              headers: {
                'Authorization': `Bearer ${savedToken}`
              }
            }
          );

          if (response.ok) {
            const data = await response.json();

            console.log('✅ Session is valid');

            // ✅ ใช้ transformer
            const transformedAgents = transformAgents(
              data.agents || [],
              savedSupervisor.teamId
            );

            console.log('✅ Transformed team data:', transformedAgents);

            setSupervisor(savedSupervisor);
            setTeamData(transformedAgents);
            setIsLoggedIn(true);

          } else {
            console.warn('⚠️ Token expired or invalid');
            clearToken();
          }

        } catch (error) {
          console.error('❌ Failed to restore session:', error);
          clearToken();
        }
      } else {
        console.log('ℹ️ No saved session found');
      }

      setIsRestoring(false);
    };

    restoreSession();
  }, []);

  // WebSocket setup
  useEffect(() => {
    if (isLoggedIn && supervisor) {
      console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
      console.log('🔌 Setting up WebSocket connection...');
      console.log('Supervisor:', supervisor.supervisorCode);
      console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');

      const socket = connectSocket(supervisor.supervisorCode);
      socketRef.current = socket;

      // Event: เชื่อมต่อสำเร็จ
      socket.on('connect', () => {
        console.log('✅ WebSocket connected');
        setSocketConnected(true);
      });

      // Event: ตัดการเชื่อมต่อ
      socket.on('disconnect', () => {
        console.log('⚠️ WebSocket disconnected');
        setSocketConnected(false);
      });



    // ✅ Event: รับข้อมูล online agents เมื่อเชื่อมต่อสำเร็จ
    socket.on('connection_success', (data) => {
      console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
      console.log('✅ [SUPERVISOR CONNECTION SUCCESS]');
      console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
      console.log('Online agents:', data.onlineAgents);
      
      if (data.onlineAgents && data.onlineAgents.length > 0) {
        // อัปเดต agents ที่ online
        setTeamData(prev => {
          const updated = prev.map(agent => {
            const isOnline = data.onlineAgents.some(
              onlineAgent => onlineAgent.agentCode === agent.agentCode
            );
            
            if (isOnline) {
              console.log(`  ✅ Setting ${agent.agentCode} as online`);
              return {
                ...agent,
                isOnline: true,
                currentStatus: 'Available',
                lastUpdate: new Date()
              };
            }
            return agent;
          });
          
          console.log('Updated team data:', updated.map(a => ({
            code: a.agentCode,
            online: a.isOnline,
            status: a.currentStatus
          })));
          
          return updated;
        });
      }
      
      console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
    });

      
      // Event: Agent เชื่อมต่อ (online)
      socket.on('agent_connected', (data) => {
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        console.log('🟢 [AGENT CONNECTED]');
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        console.log('Agent code:', data.agentCode);
        console.log('Timestamp:', data.timestamp);

        setTeamData(prev => {
          console.log('Before update:', prev.map(a => ({
            code: a.agentCode,
            online: a.isOnline
          })));

          const updated = prev.map(agent =>
            agent.agentCode === data.agentCode
              ? {
                ...agent,
                isOnline: true,
                currentStatus: 'Available',
                lastSeen: data.timestamp,
                lastUpdate: data.timestamp
              }
              : agent
          );

          console.log('After update:', updated.map(a => ({
            code: a.agentCode,
            online: a.isOnline
          })));

          return updated;
        });

        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
      });

      // Event: Agent ตัดการเชื่อมต่อ (offline)
      socket.on('agent_disconnected', (data) => {
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        console.log('🔴 [AGENT DISCONNECTED]');
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        console.log('Agent code:', data.agentCode);

        setTeamData(prev => prev.map(agent =>
          agent.agentCode === data.agentCode
            ? {
              ...agent,
              isOnline: false,
              currentStatus: 'Offline',
              lastSeen: data.timestamp
            }
            : agent
        ));

        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
      });

      // Event: Agent เปลี่ยน status
      socket.on('agent_status_update', (data) => {
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        console.log('📊 [STATUS UPDATE]');
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        console.log('Agent:', data.agentCode);
        console.log('Status:', data.status);

        setTeamData(prev => prev.map(agent =>
          agent.agentCode === data.agentCode
            ? {
              ...agent,
              currentStatus: data.status,
              lastUpdate: data.timestamp
            }
            : agent
        ));

        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
      });

      // Event: ข้อความใหม่
      socket.on('new_message', (message) => {
        console.log('💬 New message:', message);
        setMessages(prev => [...prev, message]);
      });

      return () => {
        console.log('🧹 Cleaning up WebSocket...');
        socket.off('connect');
        socket.off('disconnect');
        socket.off('agent_connected');
        socket.off('agent_disconnected');
        socket.off('agent_status_update');
        socket.off('new_message');

        disconnectSocket();
        socketRef.current = null;
        setSocketConnected(false);
      };
    }
  }, [isLoggedIn, supervisor]);

  // Handlers
  const handleLogin = (loginData) => {
    console.log('✅ Login successful');

    const supervisorData = {
      supervisorCode: loginData.data.user.agentCode,
      name: loginData.data.user.agentName,
      teamId: loginData.data.user.teamId,
      teamName: loginData.data.user.teamName,
      email: loginData.data.user.email
    };

    const rawTeamData = loginData.data.teamData || [];

    // ✅ บันทึก token และ data
    setToken(loginData.data.token);
    setSupervisorData(supervisorData);

    setSupervisor(supervisorData);
    setTeamData(rawTeamData);
    setIsLoggedIn(true);
  };

  const handleLogout = () => {
    console.log('Logging out...');

    // ✅ ลบ saved data
    clearToken();

    disconnectSocket();

    setIsLoggedIn(false);
    setSupervisor(null);
    setTeamData([]);
    setMessages([]);
    setSocketConnected(false);
    socketRef.current = null;
  };

  const handleSendMessage = (messageData) => {
    console.log('📤 Sending message:', messageData);

    const socket = socketRef.current || getSocket();

    if (!socket || !socket.connected) {
      console.error('❌ Socket not available');
      return;
    }

    socket.emit('send_message', {
      fromCode: supervisor.supervisorCode,
      ...messageData
    });

    setMessages(prev => [...prev, {
      ...messageData,
      fromCode: supervisor.supervisorCode,
      timestamp: new Date()
    }]);
  };

  // ✅ แสดง loading ระหว่าง restore session
  if (isRestoring) {
    return (
      <ThemeProvider theme={theme}>
        <CssBaseline />
        <Container
          maxWidth="xl"
          sx={{
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
            minHeight: '100vh'
          }}
        >
          <Box textAlign="center">
            <CircularProgress />
            <Typography variant="body2" sx={{ mt: 2 }}>
              Loading...
            </Typography>
          </Box>
        </Container>
      </ThemeProvider>
    );
  }

  return (
    <ErrorBoundary>
      <ThemeProvider theme={theme}>
        <CssBaseline />
        <Container maxWidth="xl" sx={{ py: 2 }}>
          {!isLoggedIn ? (
            <LoginForm onLogin={handleLogin} />
          ) : (
            <Dashboard
              supervisor={supervisor}
              teamData={teamData}
              messages={messages}
              socketConnected={socketConnected}
              onSendMessage={handleSendMessage}
              onLogout={handleLogout}
            />
          )}
        </Container>
      </ThemeProvider>
    </ErrorBoundary>
  );
}

export default App;
```

### 📄 src/components/ErrorBoundary.js

**หน้าที่:** จัดการ errors ที่เกิดใน component tree
- Catch errors และป้องกัน app crash ทั้งหมด
- แสดง error UI ที่เป็นมิตร
- มีปุ่ม Reload Application

```javascript
import React from 'react';
import { Box, Typography, Button, Paper } from '@mui/material';
import { Error as ErrorIcon } from '@mui/icons-material';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { 
      hasError: false,
      error: null 
    };
  }

  // เรียกเมื่อมี error เกิดขึ้น
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  // Log error
  componentDidCatch(error, errorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  // Reset error state
  handleReset = () => {
    this.setState({ hasError: false, error: null });
    window.location.reload();
  };

  render() {
    if (this.state.hasError) {
      // แสดง error UI
      return (
        <Box
          display="flex"
          justifyContent="center"
          alignItems="center"
          minHeight="100vh"
          bgcolor="#f5f5f5"
        >
          <Paper elevation={3} sx={{ p: 4, maxWidth: 500, textAlign: 'center' }}>
            <ErrorIcon sx={{ fontSize: 60, color: 'error.main', mb: 2 }} />
            <Typography variant="h5" gutterBottom>
              Something went wrong
            </Typography>
            <Typography variant="body2" color="text.secondary" sx={{ mb: 3 }}>
              {this.state.error?.message || 'An unexpected error occurred'}
            </Typography>
            <Button 
              variant="contained" 
              onClick={this.handleReset}
            >
              Reload Application
            </Button>
          </Paper>
        </Box>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;
```

### 📄 src/components/LoginForm.js

**หน้าที่:** หน้า login สำหรับ supervisor
- รับ input supervisor code และ validate format (SP001)
- ตรวจสอบ backend server status ก่อน login
- เรียก API login และแสดง loading state
- แสดง error message ถ้า login ล้มเหลว
- เรียก onLogin callback เมื่อสำเร็จ

```javascript
import React, { useState, useEffect } from 'react';
import {
    Paper, TextField, Button, Typography, Alert, Box,
    CircularProgress, Chip
} from '@mui/material';
import { AccountCircle, CheckCircle, Cancel } from '@mui/icons-material';
import { loginSupervisor } from '../services/api';
import { validateSupervisorCode } from '../utils/validation';
import { checkServerHealth } from '../services/api';

function LoginForm({ onLogin }) {
    // State
    const [supervisorCode, setSupervisorCode] = useState('');
    const [loading, setLoading] = useState(false);
    const [error, setError] = useState('');
    const [serverStatus, setServerStatus] = useState('checking'); // checking, online, offline

    // ตรวจสอบ backend status เมื่อ component mount
    useEffect(() => {
        checkBackendStatus();
    }, []);

    /**
     * ตรวจสอบว่า backend server ทำงานอยู่หรือไม่
     */
    const checkBackendStatus = async () => {
        try {
            await checkServerHealth();
            setServerStatus('online');
        } catch (err) {
            setServerStatus('offline');
            setError('Cannot connect to server. Please make sure backend is running.');
        }
    };

    /**
     * Handle form submit
     */
    const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');

        // Validate input
        const validationError = validateSupervisorCode(supervisorCode);
        if (validationError) {
            setError(validationError);
            return;
        }

        // เรียก API
        setLoading(true);
        try {
            const response = await loginSupervisor(supervisorCode.toUpperCase());

            // ตรวจสอบว่าเป็น supervisor จริง
            if (response.data.user.role !== 'supervisor') {
                setError('This code is not a supervisor account');
                setLoading(false);
                return;
            }

            // Login สำเร็จ → เรียก callback
            onLogin(response);

        } catch (err) {
            setError(err.message || 'Login failed. Please check your code.');
        } finally {
            setLoading(false);
        }
    };

    return (
        <Box
            display="flex"
            justifyContent="center"
            alignItems="center"
            minHeight="100vh"
            bgcolor="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
        >
            <Paper elevation={3} sx={{ p: 4, maxWidth: 400, width: '100%' }}>
                {/* Header */}
                <Box textAlign="center" mb={3}>
                    <AccountCircle sx={{ fontSize: 60, color: 'primary.main', mb: 2 }} />
                    <Typography variant="h4" gutterBottom>
                        Supervisor Dashboard
                    </Typography>
                    <Typography variant="body2" color="text.secondary">
                        Sign in to monitor your team
                    </Typography>

                    {/* Server Status Badge */}
                    <Box mt={2}>
                        <Chip
                            size="small"
                            icon={serverStatus === 'online' ? <CheckCircle /> : <Cancel />}
                            label={
                                serverStatus === 'checking' ? 'Checking server...' :
                                    serverStatus === 'online' ? 'Server Online' :
                                        'Server Offline'
                            }
                            color={serverStatus === 'online' ? 'success' : 'error'}
                            variant={serverStatus === 'checking' ? 'outlined' : 'filled'}
                        />
                    </Box>
                </Box>

                {/* Login Form */}
                <form onSubmit={handleSubmit}>
                    <TextField
                        fullWidth
                        label="Supervisor Code"
                        placeholder="SP001"
                        value={supervisorCode}
                        onChange={(e) => setSupervisorCode(e.target.value.toUpperCase())}
                        margin="normal"
                        required
                        disabled={loading || serverStatus === 'offline'}
                        autoFocus
                        helperText="Format: SP + 3 digits (e.g., SP001)"
                    />

                    <Button
                        type="submit"
                        fullWidth
                        variant="contained"
                        size="large"
                        disabled={loading || serverStatus === 'offline'}
                        sx={{ mt: 3, mb: 2 }}
                    >
                        {loading ? <CircularProgress size={24} color="inherit" /> : 'Sign In'}
                    </Button>

                    {/* Error Message */}
                    {error && (
                        <Alert severity="error" sx={{ mt: 2 }}>
                            {error}
                        </Alert>
                    )}
                </form>

                {/* Test Credentials */}
                <Box mt={3} textAlign="center">
                    <Typography variant="caption" color="text.secondary">
                        Test Credentials
                    </Typography>
                    <Typography variant="caption" display="block" color="text.secondary">
                        SP001 • SP002 • SP003
                    </Typography>
                </Box>
            </Paper>
        </Box>
    );
}

export default LoginForm;
```

### 📄 src/components/Dashboard.js

**หน้าที่:** Layout หลักหลัง login
- แสดง App Bar (header) พร้อมชื่อ supervisor และ online count
- แสดง TeamOverview (สถิติทีม)
- แสดง StatusFilter (ปุ่มกรอง)
- แสดง Agent Cards (grid layout)
- จัดการ MessagePanel (modal สำหรับส่งข้อความ)

```javascript
import React, { useState } from 'react';
import {
    Grid, AppBar, Toolbar, Typography, Button, Box,
    Chip, IconButton, Tooltip
} from '@mui/material';
import {
    Logout, People, Message, Refresh, Circle
} from '@mui/icons-material';
import TeamOverview from './TeamOverview';
import AgentCard from './AgentCard';
import MessagePanel from './MessagePanel';
import StatusFilter from './StatusFilter';

function Dashboard({
    supervisor,
    teamData,
    messages,
    socketConnected,
    onSendMessage,
    onLogout
}) {
    const [statusFilter, setStatusFilter] = useState('All');
    const [showMessagePanel, setShowMessagePanel] = useState(false);

    // ✅ เพิ่ม: ตรวจสอบและสร้าง safeTeamData
    const safeTeamData = Array.isArray(teamData) ? teamData : [];

    // กรองข้อมูล agent ตาม status filter
    const filteredAgents = safeTeamData.filter(agent =>
        statusFilter === 'All' || agent.currentStatus === statusFilter
    );

    // สถิติทีม
    const teamStats = {
        total: safeTeamData.length,
        online: safeTeamData.filter(a => a.isOnline).length,
        available: safeTeamData.filter(a => a.currentStatus === 'Available').length,
        busy: safeTeamData.filter(a => a.currentStatus === 'Busy').length,
        break: safeTeamData.filter(a => a.currentStatus === 'Break').length,
        offline: safeTeamData.filter(a => a.currentStatus === 'Offline').length
    };

    const handleRefresh = () => {
        window.location.reload();
    };

    return (
        <Box>
            {/* App Bar */}
            <AppBar position="static" elevation={1}>
                <Toolbar>
                    <People sx={{ mr: 1 }} />

                    <Box sx={{ flexGrow: 1 }}>
                        <Typography variant="h6">
                            {supervisor.name}
                        </Typography>
                        <Typography variant="caption" sx={{ opacity: 0.8 }}>
                            {supervisor.teamName}
                        </Typography>
                    </Box>

                    <Tooltip title={socketConnected ? 'Connected' : 'Disconnected'}>
                        <Circle
                            sx={{
                                fontSize: 12,
                                color: socketConnected ? 'success.light' : 'error.light',
                                mr: 2
                            }}
                        />
                    </Tooltip>

                    <Chip
                        label={`${teamStats.online}/${teamStats.total} Online`}
                        color="success"
                        variant="outlined"
                        sx={{ mr: 2, color: 'white', borderColor: 'white' }}
                    />

                    <Button
                        color="inherit"
                        startIcon={<Message />}
                        onClick={() => setShowMessagePanel(true)}
                        sx={{ mr: 1 }}
                    >
                        Send Message
                    </Button>

                    <Tooltip title="Refresh">
                        <IconButton color="inherit" onClick={handleRefresh}>
                            <Refresh />
                        </IconButton>
                    </Tooltip>

                    <Button
                        color="inherit"
                        startIcon={<Logout />}
                        onClick={onLogout}
                    >
                        Logout
                    </Button>
                </Toolbar>
            </AppBar>

            {/* Dashboard Content */}
            <Box sx={{ mt: 3 }}>
                <Grid container spacing={3}>
                    <Grid item xs={12}>
                        <TeamOverview stats={teamStats} />
                    </Grid>

                    <Grid item xs={12}>
                        <StatusFilter
                            currentFilter={statusFilter}
                            onFilterChange={setStatusFilter}
                            stats={teamStats}
                        />
                    </Grid>

                    <Grid item xs={12}>
                        {filteredAgents.length > 0 ? (
                            <Grid container spacing={2}>
                                {filteredAgents.map(agent => (
                                    <Grid item xs={12} sm={6} md={4} lg={3} key={agent.agentCode}>
                                        <AgentCard
                                            agent={agent}
                                            onSendMessage={(content) => onSendMessage({
                                                type: 'direct',
                                                toCode: agent.agentCode,
                                                content
                                            })}
                                        />
                                    </Grid>
                                ))}
                            </Grid>
                        ) : (
                            <Box textAlign="center" py={5}>
                                <Typography variant="h6" color="text.secondary">
                                    No agents found with status: {statusFilter}
                                </Typography>
                            </Box>
                        )}
                    </Grid>
                </Grid>
            </Box>

            {/* Message Panel Modal */}
            <MessagePanel
                open={showMessagePanel}
                onClose={() => setShowMessagePanel(false)}
                supervisor={supervisor}
                teamData={safeTeamData}
                onSendMessage={onSendMessage}
            />
        </Box>
    );
}

export default Dashboard;
```

### 📄 src/components/TeamOverview.js

**หน้าที่:** แสดงสถิติทีมภาพรวม
- คำนวณ: จำนวน total, online, available, busy, break, offline
- แสดงเป็น cards พร้อม icons สีสันสวยงาม
- Update real-time เมื่อ agent เปลี่ยน status

```javascript
import React from 'react';
import { Grid, Card, CardContent, Typography, Box } from '@mui/material';
import { 
  People, CheckCircle, Cancel, Pause, PowerOff 
} from '@mui/icons-material';

function TeamOverview({ stats }) {
  // กำหนด cards ที่จะแสดง
  const overviewCards = [
    {
      label: 'Total Agents',
      value: stats.total,
      icon: People,
      color: '#1976d2'
    },
    {
      label: 'Online',
      value: stats.online,
      icon: PowerOff,
      color: '#4caf50'
    },
    {
      label: 'Available',
      value: stats.available,
      icon: CheckCircle,
      color: '#4caf50'
    },
    {
      label: 'Busy',
      value: stats.busy,
      icon: Cancel,
      color: '#ff9800'
    },
    {
      label: 'On Break',
      value: stats.break,
      icon: Pause,
      color: '#2196f3'
    },
    {
      label: 'Offline',
      value: stats.offline,
      icon: PowerOff,
      color: '#9e9e9e'
    }
  ];

  return (
    <Grid container spacing={2}>
      {overviewCards.map((card, index) => {
        const IconComponent = card.icon;
        
        return (
          <Grid item xs={6} sm={4} md={2} key={index}>
            <Card elevation={2}>
              <CardContent>
                {/* Icon */}
                <Box display="flex" justifyContent="center" mb={1}>
                  <IconComponent sx={{ fontSize: 40, color: card.color }} />
                </Box>
                
                {/* Value */}
                <Typography 
                  variant="h4" 
                  align="center" 
                  sx={{ fontWeight: 'bold', color: card.color }}
                >
                  {card.value}
                </Typography>
                
                {/* Label */}
                <Typography 
                  variant="body2" 
                  align="center" 
                  color="text.secondary"
                >
                  {card.label}
                </Typography>
              </CardContent>
            </Card>
          </Grid>
        );
      })}
    </Grid>
  );
}

export default TeamOverview;
```

### 📄 src/components/AgentCard.js

**หน้าที่:** แสดงข้อมูล agent แต่ละคน
- แสดง: ชื่อ, รหัส, status, last update time
- สี border เปลี่ยนตาม status
- แสดง online/offline indicator
- ปุ่ม "Message" → เปิด dialog ส่งข้อความ

```javascript
import React, { useState } from 'react';
import {
    Card, CardContent, Typography, Chip, Button, Box,
    Dialog, DialogTitle, DialogContent, DialogActions, TextField,
    Tooltip
} from '@mui/material';
import { Person, AccessTime, Message, Circle } from '@mui/icons-material';
import { getStatusColor, getStatusIcon } from '../utils/statusUtils';
import { formatTimeAgo } from '../utils/dateFormat';

function AgentCard({ agent, onSendMessage }) {
    // State สำหรับ message dialog
    const [messageDialog, setMessageDialog] = useState(false);
    const [messageContent, setMessageContent] = useState('');

    // ===========================================
    // Handlers
    // ===========================================

    const handleSendMessage = () => {
        if (messageContent.trim()) {
            onSendMessage(messageContent);
            setMessageContent('');
            setMessageDialog(false);
        }
    };

    // ===========================================
    // UI Properties
    // ===========================================

    const StatusIcon = getStatusIcon(agent.currentStatus);
    const statusColor = getStatusColor(agent.currentStatus);

    return (
        <>
            {/* Agent Card */}
            <Card
                elevation={2}
                sx={{
                    border: `2px solid ${agent.isOnline ? statusColor : '#ccc'}`,
                    opacity: agent.isOnline ? 1 : 0.7,
                    transition: 'all 0.3s'
                }}
            >
                <CardContent>
                    {/* Agent Info Row */}
                    <Box display="flex" alignItems="center" mb={2}>
                        {/* Avatar Icon */}
                        <Person sx={{ mr: 1, color: 'text.secondary' }} />

                        {/* Name & Code */}
                        <Box flexGrow={1}>
                            <Typography variant="h6" noWrap>
                                {agent.agentName}
                            </Typography>
                            <Typography variant="caption" color="text.secondary">
                                {agent.agentCode}
                            </Typography>
                        </Box>

                        {/* Online Indicator */}
                        {agent.isOnline && (
                            <Tooltip title="Online">
                                <Circle sx={{ fontSize: 12, color: 'success.main' }} />
                            </Tooltip>
                        )}
                    </Box>

                    {/* Current Status */}
                    <Box display="flex" alignItems="center" mb={2}>
                        <StatusIcon sx={{ mr: 1, color: statusColor }} />
                        <Chip
                            label={agent.currentStatus}
                            size="small"
                            sx={{
                                backgroundColor: statusColor,
                                color: 'white',
                                fontWeight: 'bold'
                            }}
                        />
                    </Box>

                    {/* Last Update Time */}
                    <Box display="flex" alignItems="center" mb={2}>
                        <AccessTime sx={{ mr: 1, fontSize: 16, color: 'text.secondary' }} />
                        <Typography variant="caption" color="text.secondary">
                            {agent.isOnline
                                ? `Updated ${formatTimeAgo(agent.lastUpdate)}`
                                : `Last seen ${formatTimeAgo(agent.lastSeen)}`
                            }
                        </Typography>
                    </Box>

                    {/* Actions */}
                    <Box display="flex" justifyContent="space-between">
                        <Button
                            size="small"
                            startIcon={<Message />}
                            onClick={() => setMessageDialog(true)}
                            disabled={!agent.isOnline}
                        >
                            Message
                        </Button>

                        <Chip
                            size="small"
                            label={agent.isOnline ? 'Online' : 'Offline'}
                            color={agent.isOnline ? 'success' : 'default'}
                            variant="outlined"
                        />
                    </Box>
                </CardContent>
            </Card>

            {/* Send Message Dialog */}
            <Dialog
                open={messageDialog}
                onClose={() => setMessageDialog(false)}
                maxWidth="sm"
                fullWidth
            >
                <DialogTitle>
                    Send Message to {agent.agentName}
                </DialogTitle>
                <DialogContent>
                    <TextField
                        fullWidth
                        multiline
                        rows={4}
                        label="Message"
                        value={messageContent}
                        onChange={(e) => setMessageContent(e.target.value)}
                        margin="normal"
                        placeholder="Type your message here..."
                        autoFocus
                    />
                </DialogContent>
                <DialogActions>
                    <Button onClick={() => setMessageDialog(false)}>
                        Cancel
                    </Button>
                    <Button
                        onClick={handleSendMessage}
                        variant="contained"
                        disabled={!messageContent.trim()}
                    >
                        Send
                    </Button>
                </DialogActions>
            </Dialog>
        </>
    );
}

export default AgentCard;
```

### 📄 src/components/MessagePanel.js

**หน้าที่:** Modal สำหรับส่งข้อความ
- เลือกประเภท: Direct (คนเดียว) หรือ Broadcast (ทั้งทีม)
- ถ้า Direct → เลือก agent ที่จะส่ง
- กรอกข้อความ (max 500 chars)
- มี Quick Templates สำหรับข้อความที่ใช้บ่อย

```javascript
/**
 * MESSAGE PANEL COMPONENT
 * Modal สำหรับส่งข้อความ Direct หรือ Broadcast
 * - เลือกประเภท: Direct (คนเดียว) หรือ Broadcast (ทั้งทีม)
 * - เลือก agent (ถ้าเป็น direct)
 * - กรอกข้อความ
 * - ส่งข้อความ
 * 
 * FIX: เพิ่ม supervisor prop เพื่อใช้ teamId สำหรับ broadcast
 */

import React, { useState, useEffect } from 'react';
import {
    Dialog, DialogTitle, DialogContent, DialogActions,
    Button, TextField, RadioGroup, FormControlLabel, Radio,
    FormControl, FormLabel, Select, MenuItem, InputLabel,
    Box, Typography, Alert
} from '@mui/material';
import { Send } from '@mui/icons-material';
import { validateMessage } from '../utils/validation';

function MessagePanel({ open, onClose, supervisor, teamData, onSendMessage }) {
    const [messageType, setMessageType] = useState('direct');
    const [selectedAgent, setSelectedAgent] = useState('');
    const [messageContent, setMessageContent] = useState('');
    const [error, setError] = useState('');

    // Debug logging เมื่อเปิด modal
    useEffect(() => {
        if (open) {
            console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
            console.log('📧 [MESSAGE PANEL OPENED]');
            console.log('Supervisor:', supervisor);
            console.log('Team ID:', supervisor?.teamId);
            console.log('Team Name:', supervisor?.teamName);
            console.log('Team Data:', teamData?.length, 'agents');
            console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        }
    }, [open, supervisor, teamData]);

    const handleTypeChange = (e) => {
        setMessageType(e.target.value);
        setSelectedAgent('');
        setError('');
    };

    const handleSend = () => {
        setError('');
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
        console.log('📤 [SENDING MESSAGE]');

        // Validate message content
        const validationError = validateMessage(messageContent);
        if (validationError) {
            setError(validationError);
            console.error('❌ Validation error:', validationError);
            return;
        }

        // Validate direct message selection
        if (messageType === 'direct' && !selectedAgent) {
            setError('Please select an agent');
            console.error('❌ No agent selected');
            return;
        }

        // สร้าง message object
        const messageData = {
            content: messageContent.trim(),
            type: messageType,
            priority: 'normal'
        };

        // เพิ่ม recipient
        if (messageType === 'direct') {
            messageData.toCode = selectedAgent;
            console.log('✅ Direct message to:', selectedAgent);
        } else {
            // Broadcast - ต้องมี teamId
            if (!supervisor || !supervisor.teamId) {
                console.error('❌ Missing supervisor or teamId');
                console.error('   Supervisor:', supervisor);
                setError('Cannot determine team ID for broadcast message');
                return;
            }

            messageData.toTeamId = supervisor.teamId;
            console.log('✅ Broadcast to team:', supervisor.teamId, `(${supervisor.teamName})`);
        }

        console.log('Message data:', messageData);
        console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');

        // ส่งข้อความ
        onSendMessage(messageData);

        // Reset และปิด
        setMessageContent('');
        setSelectedAgent('');
        setMessageType('direct');
        setError('');
        onClose();
    };

    const handleCancel = () => {
        setMessageContent('');
        setSelectedAgent('');
        setMessageType('direct');
        setError('');
        onClose();
    };

    // Filter online agents
    const onlineAgents = teamData ? teamData.filter(agent => agent.isOnline) : [];
    const totalAgents = teamData ? teamData.length : 0;

    return (
        <Dialog
            open={open}
            onClose={handleCancel}
            maxWidth="sm"
            fullWidth
        >
            <DialogTitle>
                Send Message
            </DialogTitle>

            <DialogContent>
                {/* Message Type Selection */}
                <FormControl component="fieldset" sx={{ mb: 3, mt: 1 }}>
                    <FormLabel component="legend">Message Type</FormLabel>
                    <RadioGroup
                        row
                        value={messageType}
                        onChange={handleTypeChange}
                    >
                        <FormControlLabel
                            value="direct"
                            control={<Radio />}
                            label="Direct (to one agent)"
                        />
                        <FormControlLabel
                            value="broadcast"
                            control={<Radio />}
                            label="Broadcast (to all team)"
                        />
                    </RadioGroup>
                </FormControl>

                {/* Agent Selection (Direct) */}
                {messageType === 'direct' && (
                    <FormControl fullWidth sx={{ mb: 3 }}>
                        <InputLabel>Select Agent</InputLabel>
                        <Select
                            value={selectedAgent}
                            onChange={(e) => setSelectedAgent(e.target.value)}
                            label="Select Agent"
                        >
                            {onlineAgents.length > 0 ? (
                                onlineAgents.map(agent => (
                                    <MenuItem key={agent.agentCode} value={agent.agentCode}>
                                        {agent.agentName} ({agent.agentCode}) - {agent.currentStatus}
                                    </MenuItem>
                                ))
                            ) : (
                                <MenuItem disabled>No agents online</MenuItem>
                            )}
                        </Select>
                    </FormControl>
                )}

                {/* Broadcast Info */}
                {messageType === 'broadcast' && (
                    <Alert severity="info" sx={{ mb: 3 }}>
                        This message will be sent to all agents in your team
                        {supervisor?.teamName && <> ({supervisor.teamName})</>}
                        <br />
                        {totalAgents} agents total, {onlineAgents.length} online
                    </Alert>
                )}

                {/* Message Content */}
                <TextField
                    fullWidth
                    multiline
                    rows={6}
                    label="Message Content"
                    value={messageContent}
                    onChange={(e) => setMessageContent(e.target.value)}
                    placeholder="Type your message here..."
                    helperText={`${messageContent.length}/500 characters`}
                    inputProps={{ maxLength: 500 }}
                />

                {/* Error Message */}
                {error && (
                    <Alert severity="error" sx={{ mt: 2 }}>
                        {error}
                    </Alert>
                )}

                {/* Quick Templates */}
                <Box mt={2}>
                    <Typography variant="caption" color="text.secondary" gutterBottom>
                        Quick Templates:
                    </Typography>
                    <Box display="flex" gap={1} flexWrap="wrap" mt={1}>
                        {[
                            'Please update your status',
                            'Team meeting in 15 minutes',
                            'Great work today!',
                            'Please check your queue'
                        ].map((template, index) => (
                            <Button
                                key={index}
                                size="small"
                                variant="outlined"
                                onClick={() => setMessageContent(template)}
                            >
                                {template}
                            </Button>
                        ))}
                    </Box>
                </Box>
            </DialogContent>

            <DialogActions>
                <Button onClick={handleCancel}>
                    Cancel
                </Button>
                <Button
                    onClick={handleSend}
                    variant="contained"
                    startIcon={<Send />}
                    disabled={!messageContent.trim() || (messageType === 'direct' && !selectedAgent)}
                >
                    Send Message
                </Button>
            </DialogActions>
        </Dialog>
    );
}

export default MessagePanel;
```

### 📄 src/components/StatusFilter.js

**หน้าที่:** ปุ่มกรองแสดง agents ตาม status
- All, Available, Busy, Break, Offline
- แสดงจำนวนแต่ละ status
- Highlight ปุ่มที่เลือก

```javascript
import React from 'react';
import { Box, Button, Chip } from '@mui/material';
import { 
  ViewModule, CheckCircle, Cancel, Pause, PowerOff 
} from '@mui/icons-material';

function StatusFilter({ currentFilter, onFilterChange, stats }) {
  // กำหนด filter buttons
  const filterButtons = [
    {
      value: 'All',
      label: 'All Agents',
      icon: ViewModule,
      count: stats.total,
      color: '#1976d2'
    },
    {
      value: 'Available',
      label: 'Available',
      icon: CheckCircle,
      count: stats.available,
      color: '#4caf50'
    },
    {
      value: 'Busy',
      label: 'Busy',
      icon: Cancel,
      count: stats.busy,
      color: '#ff9800'
    },
    {
      value: 'Break',
      label: 'Break',
      icon: Pause,
      count: stats.break,
      color: '#2196f3'
    },
    {
      value: 'Offline',
      label: 'Offline',
      icon: PowerOff,
      count: stats.offline,
      color: '#9e9e9e'
    }
  ];

  return (
    <Box 
      sx={{ 
        display: 'flex', 
        gap: 1, 
        flexWrap: 'wrap',
        p: 2,
        bgcolor: 'background.paper',
        borderRadius: 2,
        boxShadow: 1
      }}
    >
      {filterButtons.map((filter) => {
        const IconComponent = filter.icon;
        const isActive = currentFilter === filter.value;

        return (
          <Button
            key={filter.value}
            variant={isActive ? 'contained' : 'outlined'}
            onClick={() => onFilterChange(filter.value)}
            startIcon={<IconComponent />}
            sx={{
              borderColor: filter.color,
              color: isActive ? 'white' : filter.color,
              bgcolor: isActive ? filter.color : 'transparent',
              '&:hover': {
                bgcolor: isActive ? filter.color : `${filter.color}20`,
                borderColor: filter.color
              }
            }}
          >
            {filter.label}
            <Chip
              label={filter.count}
              size="small"
              sx={{
                ml: 1,
                bgcolor: isActive ? 'rgba(255,255,255,0.3)' : 'transparent',
                color: isActive ? 'white' : filter.color,
                fontWeight: 'bold'
              }}
            />
          </Button>
        );
      })}
    </Box>
  );
}

export default StatusFilter;
```

---

## 5. การรัน Dashboard

### Development Mode

```bash
# Terminal 1: Start Backend Server
cd backend-server
npm run dev

# Terminal 2: Start Dashboard
cd supervisor-dashboard
npm start

# เปิด browser: http://localhost:3000
```

### Test Login

```
Supervisor Codes:
- SP001 (Team A)
- SP002 (Team B)
- SP003 (Team C)
```

---

## 6. สรุป

**ไฟล์ทั้งหมดที่สร้างครบ:**

```
src/
├── App.js                      ✅ Main application
├── index.js                    ✅ Entry point
├── App.css                     ✅ Global styles
│
├── components/
│   ├── ErrorBoundary.js        ✅ Error handling
│   ├── LoginForm.js            ✅ Login page
│   ├── Dashboard.js            ✅ Main dashboard
│   ├── TeamOverview.js         ✅ Team statistics
│   ├── AgentCard.js            ✅ Agent display
│   ├── MessagePanel.js         ✅ Send messages
│   └── StatusFilter.js         ✅ Filter agents
│
├── services/
│   ├── api.js                  ✅ HTTP API
│   ├── socket.js               ✅ WebSocket
│   └── auth.js                 ✅ Token management
│
├── hooks/
│   ├── useSocket.js            ✅ Socket hook
│   └── useTeamData.js          ✅ Team data hook
│
├── utils/
│   ├── statusUtils.js          ✅ Status helpers
│   ├── dateFormat.js           ✅ Date formatting
│   └── validation.js           ✅ Input validation
│
└── theme/
    ├── theme.js                ✅ MUI theme
    └── colors.js               ✅ Color palette
```

**Dashboard พร้อมใช้งาน 100%!**

**Features:**
- ✅ Login/Logout
- ✅ Real-time WebSocket updates
- ✅ Team statistics overview
- ✅ Agent status monitoring
- ✅ Direct & Broadcast messaging
- ✅ Status filtering
- ✅ Responsive design
- ✅ Error handling

**ขั้นตอนต่อไป:**
1. ทดสอบ Dashboard ร่วมกับ Agent Desktop App
2. ทดสอบการส่งข้อความ
3. ทดสอบ real-time updates
4. Deploy to production (optional)