# 6.6.4 Database & Sample Data - Agent Wallboard System

## 🎯 ภาพรวม

เอกสารนี้จะอธิบายโครงสร้างฐานข้อมูลของ Agent Wallboard System ที่ใช้ **Hybrid Database Architecture** คือ SQLite สำหรับ master data และ MongoDB สำหรับ real-time data รวมถึง sample data ที่เตรียมไว้สำหรับการทดสอบ

### 🎓 เป้าหมายการเรียนรู้
เมื่อจบการอ่านเอกสารนี้ นักศึกษาจะสามารถ:
- เข้าใจสาเหตุการใช้ 2 database systems
- รู้จัก database schema และ table structure
- เข้าใจ sample data ที่มีให้สำหรับการทดสอบ
- รู้วิธีการเพิ่ม/แก้ไขข้อมูลสำหรับการพัฒนา

---

## 🏗️ **Database Architecture Overview**

### **🎯 ทำไมต้องใช้ 2 Databases?**

```
📊 SQLite (Master Data)          🍃 MongoDB (Real-time Data)
├── 👥 Agent Information        ├── 💬 Messages
├── 🏢 Team Structure           ├── 📊 Status Logs  
├── 👤 Supervisor Mapping       ├── 🔗 Connection Logs
└── ⚙️ System Configuration      └── 📈 Performance Metrics
```

**📊 SQLite ใช้สำหรับ:**
- **Structured Data** - ข้อมูลที่มีโครงสร้างชัดเจน
- **ACID Compliance** - ต้องการความถูกต้องของข้อมูล
- **Referential Integrity** - ความสัมพันธ์ระหว่าง tables
- **Complex Queries** - Join operations ที่ซับซ้อน

**🍃 MongoDB ใช้สำหรับ:**
- **High Write Volume** - บันทึกข้อมูล real-time บ่อย ๆ
- **Flexible Schema** - โครงสร้างข้อมูลที่เปลี่ยนแปลงได้
- **Fast Read/Write** - Performance สำหรับ real-time operations
- **Time-series Data** - ข้อมูลที่มี timestamp

---

## 📊 **SQLite Database Schema**

### **🗄️ ตำแหน่งไฟล์และการเชื่อมต่อ**
```bash
ไฟล์ Database: database/sqlite/wallboard.db
Connection String: sqlite:../database/sqlite/wallboard.db
ขนาดไฟล์: ~50KB (พร้อม sample data)
```

### **📋 Tables Overview**
```sql
-- 4 หลัก tables สำหรับ master data
TABLES:
├── teams           (3 records)   # ข้อมูลทีม
├── agents          (13 records)  # ข้อมูล Agent และ Supervisor master data  
├── agent_sessions  (0 records)   # การติดตาม Login/logout (ใช้ในอนาคต)
└── system_config   (8 records)   # การตั้งค่าระบบ
```

---

### **🏢 Table: teams**

**จุดประสงค์:** จัดเก็บข้อมูล teams และ supervisor mapping

```sql
CREATE TABLE teams (
    team_id INTEGER PRIMARY KEY AUTOINCREMENT,
    team_name VARCHAR(50) NOT NULL UNIQUE,
    supervisor_code VARCHAR(10),
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT 1
);
```

**📊 Sample Data:**
```sql
INSERT INTO teams (team_id, team_name, supervisor_code, description) VALUES
(1, 'Customer Service', 'SP001', 'Main customer service team'),
(2, 'Technical Support', 'SP002', 'Technical support specialists'), 
(3, 'Sales Team', 'SP003', 'Sales and marketing team');
```

**🎯 การใช้งาน:**
- **Supervisor Dashboard:** แสดงรายชื่อ team ที่ supervisor ดูแล
- **Agent Assignment:** กำหนด agents เข้าทีม
- **Access Control:** ควบคุมการเข้าถึงข้อมูลตามทีม

---

### **👥 Table: agents**

**จุดประสงค์:** จัดเก็บข้อมูล agents และ supervisors ทั้งหมด

```sql
CREATE TABLE agents (
    agent_id INTEGER PRIMARY KEY AUTOINCREMENT,
    agent_code VARCHAR(10) NOT NULL UNIQUE,
    agent_name VARCHAR(100) NOT NULL,
    team_id INTEGER NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('agent', 'supervisor')),
    email VARCHAR(100),
    phone VARCHAR(20),
    hire_date DATE,
    is_active BOOLEAN DEFAULT 1,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (team_id) REFERENCES teams(team_id)
);
```

**📊 Sample Data (13 records):**
```sql
-- Supervisors (3)
INSERT INTO agents (agent_code, agent_name, team_id, role, email, phone, hire_date) VALUES
('SP001', 'Sarah Wilson', 1, 'supervisor', 'sarah.wilson@company.com', '555-0101', '2023-01-15'),
('SP002', 'Mike Johnson', 2, 'supervisor', 'mike.johnson@company.com', '555-0102', '2023-01-20'),
('SP003', 'Lisa Chen', 3, 'supervisor', 'lisa.chen@company.com', '555-0103', '2023-02-01');

-- Customer Service Team Agents (4)
INSERT INTO agents (agent_code, agent_name, team_id, role, email, phone, hire_date) VALUES
('AG001', 'John Smith', 1, 'agent', 'john.smith@company.com', '555-0201', '2023-03-01'),
('AG002', 'Emma Davis', 1, 'agent', 'emma.davis@company.com', '555-0202', '2023-03-05'),
('AG003', 'Robert Brown', 1, 'agent', 'robert.brown@company.com', '555-0203', '2023-03-10'),
('AG004', 'Jennifer Wilson', 1, 'agent', 'jennifer.wilson@company.com', '555-0204', '2023-03-15');

-- Technical Support Team Agents (3)
INSERT INTO agents (agent_code, agent_name, team_id, role, email, phone, hire_date) VALUES
('AG005', 'David Miller', 2, 'agent', 'david.miller@company.com', '555-0301', '2023-04-01'),
('AG006', 'Amanda Taylor', 2, 'agent', 'amanda.taylor@company.com', '555-0302', '2023-04-05'),
('AG007', 'Chris Anderson', 2, 'agent', 'chris.anderson@company.com', '555-0303', '2023-04-10');

-- Sales Team Agents (3)
INSERT INTO agents (agent_code, agent_name, team_id, role, email, phone, hire_date) VALUES
('AG008', 'Michelle Garcia', 3, 'agent', 'michelle.garcia@company.com', '555-0401', '2023-05-01'),
('AG009', 'Kevin Martinez', 3, 'agent', 'kevin.martinez@company.com', '555-0402', '2023-05-05'),
('AG010', 'Jessica Rodriguez', 3, 'agent', 'jessica.rodriguez@company.com', '555-0403', '2023-05-10');
```

**🎯 การใช้งาน:**
- **Authentication:** ตรวจสอบ agent_code ในการ login
- **Team Management:** แสดง agents ในแต่ละทีม
- **User Profile:** แสดงข้อมูลส่วนตัวของ agents

---

### **📅 Table: agent_sessions** *(สำหรับอนาคต)*

**จุดประสงค์:** ติดตาม login/logout sessions

```sql
CREATE TABLE agent_sessions (
    session_id INTEGER PRIMARY KEY AUTOINCREMENT,
    agent_code VARCHAR(10) NOT NULL,
    login_time DATETIME NOT NULL,
    logout_time DATETIME,
    session_duration INTEGER, -- in seconds
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (agent_code) REFERENCES agents(agent_code)
);
```

**🎯 การใช้งาน (Week 2):**
- **Session Tracking:** ติดตาม working hours
- **Security Audit:** ตรวจสอบการเข้าถึงระบบ
- **Performance Analysis:** วิเคราะห์ usage patterns

---

### **⚙️ Table: system_config**

**จุดประสงค์:** จัดเก็บการตั้งค่าระบบ

```sql
CREATE TABLE system_config (
    config_id INTEGER PRIMARY KEY AUTOINCREMENT,
    config_key VARCHAR(50) NOT NULL UNIQUE,
    config_value TEXT NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT 1,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

**📊 Sample Data (8 records):**
```sql
INSERT INTO system_config (config_key, config_value, description) VALUES
('status_timeout', '300', 'Auto-offline timeout in seconds'),
('message_retention', '30', 'Message retention in days'),
('max_concurrent_sessions', '1', 'Max sessions per agent'),
('notification_enabled', 'true', 'Enable desktop notifications'),
('websocket_timeout', '30000', 'WebSocket timeout in milliseconds'),
('api_rate_limit', '100', 'API requests per minute'),
('session_duration', '28800', 'Max session duration in seconds (8 hours)'),
('backup_interval', '86400', 'Database backup interval in seconds');
```

**🎯 การใช้งาน:**
- **System Behavior:** ควบคุมพฤติกรรมระบบ
- **Performance Tuning:** ปรับแต่ง timeouts และ limits
- **Feature Toggles:** เปิด/ปิดฟีเจอร์ต่าง ๆ

---

## 🍃 **MongoDB Collections Schema**

### **🗄️ Database และ Connection**
```bash
Database Name: wallboard
Connection URI: mongodb://localhost:27017/wallboard
Collections: 4 collections สำหรับ real-time data
```

### **📋 Collections Overview**
```javascript
// 4 หลัก collections สำหรับ real-time data
COLLECTIONS:
├── messages         # Direct และ broadcast messages
├── agent_status     # Status change history  
├── connection_logs  # Agent connection/disconnection logs
└── performance_metrics  # Team performance data (Week 2)
```

---

### **💬 Collection: messages**

**จุดประสงค์:** จัดเก็บข้อความทั้งหมดในระบบ

```javascript
const messageSchema = new mongoose.Schema({
  fromCode: {
    type: String,
    required: true,
    uppercase: true
  },
  toCode: {
    type: String,
    uppercase: true  // สำหรับ direct messages
  },
  toTeamId: {
    type: Number     // สำหรับ broadcast messages
  },
  content: {
    type: String,
    required: true,
    trim: true
  },
  type: {
    type: String,
    enum: ['direct', 'broadcast'],
    required: true
  },
  priority: {
    type: String,
    enum: ['low', 'normal', 'high'],
    default: 'normal'
  },
  isRead: {
    type: Boolean,
    default: false
  },
  readAt: {
    type: Date
  },
  timestamp: {
    type: Date,
    default: Date.now,
    index: true
  }
});
```

**📊 Sample Data:**
```javascript
// Sample messages ที่จะถูกสร้างเมื่อ setup
const sampleMessages = [
  {
    fromCode: "SP001",
    toCode: "AG001",
    content: "Good morning! Ready for the day?",
    type: "direct",
    priority: "normal",
    timestamp: new Date(),
    isRead: false
  },
  {
    fromCode: "SP001",
    toTeamId: 1,
    content: "Team meeting in 15 minutes",
    type: "broadcast",
    priority: "high",
    timestamp: new Date(),
    isRead: false
  },
  {
    fromCode: "SP002",
    toCode: "AG005",
    content: "Please check the technical queue",
    type: "direct",
    priority: "normal",
    timestamp: new Date(),
    isRead: true,
    readAt: new Date()
  }
];
```

**🎯 การใช้งาน:**
- **Real-time Messaging:** ส่งข้อความระหว่าง supervisor และ agents
- **Message History:** เก็บประวัติข้อความ
- **Notification System:** ข้อความที่ยังไม่ได้อ่าน
- **Analytics:** วิเคราะห์การสื่อสารในทีม

---

### **📊 Collection: agent_status**

**จุดประสงค์:** ติดตามการเปลี่ยนแปลงสถานะของ agents

```javascript
const statusSchema = new mongoose.Schema({
  agentCode: {
    type: String,
    required: true,
    uppercase: true,
    index: true
  },
  status: {
    type: String,
    enum: ['Available', 'Busy', 'Break', 'Offline'],
    required: true
  },
  timestamp: {
    type: Date,
    default: Date.now,
    index: true
  },
  teamId: {
    type: Number,
    index: true
  },
  duration: {
    type: Number  // เวลาใน status นี้ (วินาที)
  },
  sessionId: {
    type: String  // เชื่อมโยงกับ connection session
  }
});
```

**📊 Sample Data:**
```javascript
// Sample status changes ที่จะถูกสร้างเมื่อ setup
const sampleStatusLogs = [
  {
    agentCode: "AG001",
    status: "Available",
    timestamp: new Date(Date.now() - 3600000), // 1 hour ago
    teamId: 1,
    duration: 1800 // 30 minutes
  },
  {
    agentCode: "AG001", 
    status: "Busy",
    timestamp: new Date(Date.now() - 1800000), // 30 minutes ago
    teamId: 1,
    duration: 900 // 15 minutes
  },
  {
    agentCode: "AG001",
    status: "Break",
    timestamp: new Date(Date.now() - 900000), // 15 minutes ago
    teamId: 1,
    duration: 600 // 10 minutes
  },
  {
    agentCode: "AG002",
    status: "Available",
    timestamp: new Date(Date.now() - 7200000), // 2 hours ago
    teamId: 1,
    duration: 7200 // 2 hours
  }
];
```

**🎯 การใช้งาน:**
- **Real-time Status Display:** แสดงสถานะปัจจุบันของ agents
- **Status History:** ประวัติการเปลี่ยนสถานะ
- **Performance Analytics:** วิเคราะห์เวลาทำงานและ utilization
- **Reporting:** รายงานประจำวัน/สัปดาห์

---

### **🔗 Collection: connection_logs**

**จุดประสงค์:** ติดตาม WebSocket connections และ disconnections

```javascript
const connectionLogSchema = new mongoose.Schema({
  agentCode: {
    type: String,
    required: true,
    uppercase: true,
    index: true
  },
  eventType: {
    type: String,
    enum: ['connect', 'disconnect', 'reconnect'],
    required: true
  },
  timestamp: {
    type: Date,
    default: Date.now,
    index: true
  },
  socketId: {
    type: String,
    required: true
  },
  ipAddress: {
    type: String
  },
  userAgent: {
    type: String
  },
  connectionDuration: {
    type: Number  // เวลาเชื่อมต่อ (วินาที)
  },
  disconnectReason: {
    type: String  // สาเหตุการตัดการเชื่อมต่อ
  }
});
```

**📊 Sample Data:**
```javascript
// Sample connection logs ที่จะถูกสร้างเมื่อ setup
const sampleConnectionLogs = [
  {
    agentCode: "AG001",
    eventType: "connect",
    timestamp: new Date(Date.now() - 28800000), // 8 hours ago
    socketId: "socket_123456",
    ipAddress: "192.168.1.100",
    userAgent: "Agent Desktop App v1.0"
  },
  {
    agentCode: "AG001",
    eventType: "disconnect", 
    timestamp: new Date(Date.now() - 3600000), // 1 hour ago
    socketId: "socket_123456",
    connectionDuration: 25200, // 7 hours
    disconnectReason: "client_disconnect"
  },
  {
    agentCode: "AG002",
    eventType: "connect",
    timestamp: new Date(Date.now() - 14400000), // 4 hours ago
    socketId: "socket_789012",
    ipAddress: "192.168.1.101",
    userAgent: "Agent Desktop App v1.0"
  }
];
```

**🎯 การใช้งาน:**
- **Connection Monitoring:** ติดตาม network stability
- **Session Tracking:** ประวัติการเชื่อมต่อ
- **Troubleshooting:** วิเคราะห์ connection issues
- **Security:** ตรวจสอบ unauthorized connections

---

### **📈 Collection: performance_metrics** *(Week 2 Feature)*

**จุดประสงค์:** เก็บข้อมูล team performance สำหรับ analytics

```javascript
const performanceMetricsSchema = new mongoose.Schema({
  teamId: {
    type: Number,
    required: true,
    index: true
  },
  date: {
    type: Date,
    required: true,
    index: true
  },
  metrics: {
    totalAgents: { type: Number, default: 0 },
    activeAgents: { type: Number, default: 0 },
    utilization: { type: Number, default: 0 },  // percentage
    averageStatusDuration: {
      Available: { type: Number, default: 0 },
      Busy: { type: Number, default: 0 },
      Break: { type: Number, default: 0 }
    },
    messagesSent: { type: Number, default: 0 },
    messagesSentByType: {
      direct: { type: Number, default: 0 },
      broadcast: { type: Number, default: 0 }
    },
    connectionStability: { type: Number, default: 100 } // percentage
  }
}, {
  collection: 'performance_metrics',
  timestamps: true
});
```

**🎯 การใช้งาน (Week 2):**
- **Team Analytics Dashboard:** แสดงกราฟและสถิติ
- **Performance Reports:** รายงานประจำวัน/สัปดาห์
- **Trend Analysis:** วิเคราะห์แนวโน้ม performance

---

## 🛠️ **Database Setup Scripts**

### **📊 SQLite Setup**

**Location:** `database/sqlite/`

**🔧 create_db.sh:**
```bash
#!/bin/bash
echo "🔧 Creating SQLite Database..."

# Remove existing database for fresh start
rm -f wallboard.db

# Create database and tables
sqlite3 wallboard.db < init.sql
sqlite3 wallboard.db < sample_data.sql

echo "✅ SQLite database created successfully!"
echo "📊 Database location: $(pwd)/wallboard.db"

# Verify data
echo "🔍 Verification:"
sqlite3 wallboard.db "SELECT role, COUNT(*) as count FROM agents GROUP BY role;"
sqlite3 wallboard.db "SELECT team_name, supervisor_code FROM teams;"
```

**📜 init.sql - Schema Creation:**
```sql
-- Create teams table
CREATE TABLE teams (
    team_id INTEGER PRIMARY KEY AUTOINCREMENT,
    team_name VARCHAR(50) NOT NULL UNIQUE,
    supervisor_code VARCHAR(10),
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT 1
);

-- Create agents table
CREATE TABLE agents (
    agent_id INTEGER PRIMARY KEY AUTOINCREMENT,
    agent_code VARCHAR(10) NOT NULL UNIQUE,
    agent_name VARCHAR(100) NOT NULL,
    team_id INTEGER NOT NULL,
    role VARCHAR(20) NOT NULL CHECK (role IN ('agent', 'supervisor')),
    email VARCHAR(100),
    phone VARCHAR(20),
    hire_date DATE,
    is_active BOOLEAN DEFAULT 1,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (team_id) REFERENCES teams(team_id)
);

-- Create agent_sessions table
CREATE TABLE agent_sessions (
    session_id INTEGER PRIMARY KEY AUTOINCREMENT,
    agent_code VARCHAR(10) NOT NULL,
    login_time DATETIME NOT NULL,
    logout_time DATETIME,
    session_duration INTEGER,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (agent_code) REFERENCES agents(agent_code)
);

-- Create system_config table
CREATE TABLE system_config (
    config_id INTEGER PRIMARY KEY AUTOINCREMENT,
    config_key VARCHAR(50) NOT NULL UNIQUE,
    config_value TEXT NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT 1,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- Create indexes for performance
CREATE INDEX idx_agents_team_id ON agents(team_id);
CREATE INDEX idx_agents_code ON agents(agent_code);
CREATE INDEX idx_sessions_agent ON agent_sessions(agent_code);
CREATE INDEX idx_config_key ON system_config(config_key);
```

**🎭 sample_data.sql - Sample Data:**
```sql
-- Insert teams
INSERT INTO teams (team_id, team_name, supervisor_code, description) VALUES
(1, 'Customer Service', 'SP001', 'Main customer service team'),
(2, 'Technical Support', 'SP002', 'Technical support specialists'), 
(3, 'Sales Team', 'SP003', 'Sales and marketing team');

-- Insert supervisors and agents (13 records total)
-- [Complete SQL script จะถูกใส่ใน starter package]

-- Insert system configuration
INSERT INTO system_config (config_key, config_value, description) VALUES
('status_timeout', '300', 'Auto-offline timeout in seconds'),
('message_retention', '30', 'Message retention in days'),
('max_concurrent_sessions', '1', 'Max sessions per agent'),
('notification_enabled', 'true', 'Enable desktop notifications'),
('websocket_timeout', '30000', 'WebSocket timeout in milliseconds'),
('api_rate_limit', '100', 'API requests per minute'),
('session_duration', '28800', 'Max session duration in seconds (8 hours)'),
('backup_interval', '86400', 'Database backup interval in seconds');
```

---

### **🍃 MongoDB Setup**

**Location:** `database/mongodb/`

**🔧 setup.sh:**
```bash
#!/bin/bash
echo "🍃 Setting up MongoDB..."

# Check if MongoDB is running
if ! mongosh --eval "db.adminCommand('ismaster')" >/dev/null 2>&1; then
    echo "❌ MongoDB is not running. Please start MongoDB first."
    echo "   Windows: net start MongoDB"
    echo "   macOS: brew services start mongodb/brew/mongodb-community"
    echo "   Linux: sudo systemctl start mongod"
    exit 1
fi

echo "✅ MongoDB is running"

# Run sample data script
echo "📊 Creating sample data..."
node sample_data.js

echo "✅ MongoDB setup completed!"
echo "🔍 Verify with: mongosh wallboard --eval 'show collections'"
```

**🎭 sample_data.js - MongoDB Data:**
```javascript
const mongoose = require('mongoose');
require('dotenv').config();

// MongoDB connection
const MONGODB_URI = process.env.MONGODB_URI || 'mongodb://localhost:27017/wallboard';

// Schema definitions (same as in models/)
const messageSchema = new mongoose.Schema({
  fromCode: { type: String, required: true, uppercase: true },
  toCode: { type: String, uppercase: true },
  toTeamId: { type: Number },
  content: { type: String, required: true },
  type: { type: String, enum: ['direct', 'broadcast'], required: true },
  priority: { type: String, enum: ['low', 'normal', 'high'], default: 'normal' },
  isRead: { type: Boolean, default: false },
  readAt: { type: Date },
  timestamp: { type: Date, default: Date.now }
});

const statusSchema = new mongoose.Schema({
  agentCode: { type: String, required: true, uppercase: true },
  status: { type: String, enum: ['Available', 'Busy', 'Break', 'Offline'], required: true },
  timestamp: { type: Date, default: Date.now },
  teamId: { type: Number },
  duration: { type: Number }
});

const connectionLogSchema = new mongoose.Schema({
  agentCode: { type: String, required: true, uppercase: true },
  eventType: { type: String, enum: ['connect', 'disconnect', 'reconnect'], required: true },
  timestamp: { type: Date, default: Date.now },
  socketId: { type: String, required: true },
  ipAddress: { type: String },
  userAgent: { type: String },
  connectionDuration: { type: Number }
});

const Message = mongoose.model('Message', messageSchema);
const AgentStatus = mongoose.model('AgentStatus', statusSchema);
const ConnectionLog = mongoose.model('ConnectionLog', connectionLogSchema);

async function insertSampleData() {
  try {
    console.log('🧹 Clearing existing data...');
    await Message.deleteMany({});
    await AgentStatus.deleteMany({});
    await ConnectionLog.deleteMany({});

    console.log('💬 Inserting sample messages...');
    const sampleMessages = [
      {
        fromCode: "SP001",
        toCode: "AG001", 
        content: "Good morning! Ready for the day?",
        type: "direct",
        priority: "normal",
        timestamp: new Date(Date.now() - 3600000), // 1 hour ago
        isRead: true,
        readAt: new Date(Date.now() - 3500000)
      },
      {
        fromCode: "SP001",
        toTeamId: 1,
        content: "Team meeting in 15 minutes",
        type: "broadcast", 
        priority: "high",
        timestamp: new Date(Date.now() - 1800000), // 30 minutes ago
        isRead: false
      },
      {
        fromCode: "SP002",
        toCode: "AG005",
        content: "Please check the technical queue",
        type: "direct",
        priority: "normal", 
        timestamp: new Date(Date.now() - 900000), // 15 minutes ago
        isRead: false
      },
      {
        fromCode: "SP003",
        toTeamId: 3,
        content: "Great sales numbers this week!",
        type: "broadcast",
        priority: "normal",
        timestamp: new Date(Date.now() - 7200000), // 2 hours ago
        isRead: true
      }
    ];
    await Message.insertMany(sampleMessages);

    console.log('📊 Inserting sample status logs...');
    const sampleStatusLogs = [
      {
        agentCode: "AG001",
        status: "Available", 
        timestamp: new Date(Date.now() - 7200000), // 2 hours ago
        teamId: 1,
        duration: 3600
      },
      {
        agentCode: "AG001",
        status: "Busy",
        timestamp: new Date(Date.now() - 3600000), // 1 hour ago
        teamId: 1,
        duration: 1800
      },
      {
        agentCode: "AG002", 
        status: "Available",
        timestamp: new Date(Date.now() - 14400000), // 4 hours ago
        teamId: 1,
        duration: 7200
      },
      {
        agentCode: "AG005",
        status: "Busy",
        timestamp: new Date(Date.now() - 1800000), // 30 minutes ago
        teamId: 2,
        duration: 1500
      }
    ];
    await AgentStatus.insertMany(sampleStatusLogs);

    console.log('🔗 Inserting sample connection logs...');
    const sampleConnectionLogs = [
      {
        agentCode: "AG001",
        eventType: "connect",
        timestamp: new Date(Date.now() - 28800000), // 8 hours ago
        socketId: "socket_ag001_001",
        ipAddress: "192.168.1.100",
        userAgent: "Agent Desktop App v1.0"
      },
      {
        agentCode: "AG001", 
        eventType: "disconnect",
        timestamp: new Date(Date.now() - 3600000), // 1 hour ago
        socketId: "socket_ag001_001",
        connectionDuration: 25200 // 7 hours
      },
      {
        agentCode: "AG002",
        eventType: "connect", 
        timestamp: new Date(Date.now() - 14400000), // 4 hours ago
        socketId: "socket_ag002_001",
        ipAddress: "192.168.1.101",
        userAgent: "Agent Desktop App v1.0"
      }
    ];
    await ConnectionLog.insertMany(sampleConnectionLogs);

    // Verify data
    const messageCount = await Message.countDocuments();
    const statusCount = await AgentStatus.countDocuments();
    const logCount = await ConnectionLog.countDocuments();

    console.log(`📊 Verification:
    - Messages: ${messageCount} records
    - Status logs: ${statusCount} records  
    - Connection logs: ${logCount} records`);

    console.log('✅ Sample data inserted successfully!');

  } catch (error) {
    console.error('❌ Error inserting sample data:', error);
  }
}

// MongoDB Connection and Setup
async function setupMongoDB() {
  try {
    await mongoose.connect(MONGODB_URI);
    console.log('✅ Connected to MongoDB');

    await insertSampleData();
    
    console.log('🚀 MongoDB setup completed successfully!');
  } catch (error) {
    console.error('❌ MongoDB setup failed:', error);
  } finally {
    await mongoose.disconnect();
  }
}

// Export for use in other files
module.exports = {
  setupMongoDB,
  insertSampleData
};

// Run setup if called directly
if (require.main === module) {
  setupMongoDB();
}
```

---

## 🧪 **การทดสอบข้อมูล**

### **🔐 Login Credentials สำหรับ Testing**

**👤 Supervisors:**
```
SP001 - Sarah Wilson (Customer Service Team - Team ID: 1)
SP002 - Mike Johnson (Technical Support Team - Team ID: 2)  
SP003 - Lisa Chen (Sales Team - Team ID: 3)
```

**👥 Agents:**
```
Customer Service Team (Team ID: 1):
├── AG001 - John Smith
├── AG002 - Emma Davis
├── AG003 - Robert Brown
└── AG004 - Jennifer Wilson

Technical Support Team (Team ID: 2):
├── AG005 - David Miller
├── AG006 - Amanda Taylor
└── AG007 - Chris Anderson

Sales Team (Team ID: 3):
├── AG008 - Michelle Garcia
├── AG009 - Kevin Martinez
└── AG010 - Jessica Rodriguez
```

### **🧪 Basic Testing Scenarios**

**Scenario 1: Multi-Agent Testing**
```bash
1. Login as supervisor SP001
2. Login as agents AG001, AG002, AG003 (Customer Service Team)
3. เปลี่ยน status ในแต่ละ agent → สังเกต real-time updates ใน supervisor dashboard
4. ส่ง direct message จาก supervisor ไปยัง specific agent
5. ส่ง broadcast message ไปยัทั้งทีม
```

**Scenario 2: Cross-Team Testing**
```bash
1. Login as different supervisors (SP001, SP002, SP003)
2. Login as agents จากต่างทีม
3. ตรวจสอบว่า supervisors เห็นแค่ team members ของตัวเอง
4. ทดสอบการส่งข้อความระหว่างทีมต่าง ๆ
```

**Scenario 3: Performance Testing**
```bash
1. Login พร้อมกันด้วย multiple agents (AG001-AG005)
2. เปลี่ยน status อย่างรวดเร็วใน multiple agents
3. ส่งข้อความหลาย ๆ ข้อความตามลำดับอย่างรวดเร็ว
4. ติดตาม system performance และความตอบสนอง
```

---

## 🔍 **Database Query Examples**

### **📊 SQLite Useful Queries**

```sql
-- ดูข้อมูลทีมทั้งหมด
SELECT t.team_name, t.supervisor_code, COUNT(a.agent_id) as agent_count
FROM teams t
LEFT JOIN agents a ON t.team_id = a.team_id AND a.role = 'agent'
GROUP BY t.team_id, t.team_name, t.supervisor_code;

-- ดู agents ในทีมเฉพาะ
SELECT agent_code, agent_name, role, email
FROM agents 
WHERE team_id = 1 AND is_active = 1
ORDER BY role DESC, agent_name;

-- ดูการตั้งค่าระบบ
SELECT config_key, config_value, description
FROM system_config 
WHERE is_active = 1
ORDER BY config_key;

-- ตรวจสอบ supervisors และทีมที่ดูแล
SELECT a.agent_code, a.agent_name, t.team_name
FROM agents a
JOIN teams t ON a.team_id = t.team_id
WHERE a.role = 'supervisor'
ORDER BY a.agent_name;
```

### **🍃 MongoDB Useful Queries**

```javascript
// 1. ดูข้อความล่าสุด
db.messages.find().sort({timestamp: -1}).limit(10);

// 2. ดู Status Changes ของ Agent
db.agent_status.find({agentCode: "AG001"}).sort({timestamp: -1}).limit(5);

// 3. ดู Connection Activity
db.connection_logs.find({eventType: "connect"}).sort({timestamp: -1}).limit(5);

// 4. หา Broadcast Messages
db.messages.find({type: "broadcast"}).sort({timestamp: -1});

// 5. ดูข้อความที่ยังไม่ได้อ่าน
db.messages.find({isRead: false}).sort({timestamp: -1});

// 6. วิเคราะห์ status distribution
db.agent_status.aggregate([
  {$group: {_id: "$status", count: {$sum: 1}}},
  {$sort: {count: -1}}
]);

// 7. ดูการเชื่อมต่อของ agent เฉพาะ
db.connection_logs.find({agentCode: "AG001"}).sort({timestamp: -1});
```

---

## 🔧 **Database Maintenance Scripts**

### **🧹 Reset to Initial State**

**reset_data.sh:**
```bash
#!/bin/bash
echo "⚠️  This will reset all data to initial state. Continue? (y/N)"
read -r response

if [[ "$response" =~ ^[Yy]$ ]]; then
    echo "🧹 Resetting databases..."
    
    # Reset SQLite
    echo "📊 Resetting SQLite..."
    cd database/sqlite
    ./create_db.sh
    cd ../..
    
    # Reset MongoDB  
    echo "🍃 Resetting MongoDB..."
    mongosh wallboard --eval "db.dropDatabase()"
    cd database/mongodb
    node sample_data.js
    cd ../..
    
    echo "✅ Databases reset to initial state"
    echo "🔍 Verify:"
    echo "   SQLite: sqlite3 database/sqlite/wallboard.db 'SELECT COUNT(*) FROM agents;'"
    echo "   MongoDB: mongosh wallboard --eval 'db.stats()'"
else
    echo "❌ Reset cancelled"
fi
```

### **💾 Backup Script**

**backup_data.sh:**
```bash
#!/bin/bash
BACKUP_DIR="backups/$(date +%Y%m%d_%H%M%S)"
mkdir -p $BACKUP_DIR

echo "💾 Creating backup..."

# Backup SQLite
echo "📊 Backing up SQLite..."
cp database/sqlite/wallboard.db $BACKUP_DIR/

# Backup MongoDB
echo "🍃 Backing up MongoDB..."
mongodump --db wallboard --out $BACKUP_DIR/mongodb/

echo "✅ Backup completed: $BACKUP_DIR"
echo "📁 Contents:"
ls -la $BACKUP_DIR/
```

---

## ✅ **Database Verification Checklist**

### **📋 เมื่อได้ Starter Code มา:**

**SQLite Verification:**
- [ ] ไฟล์ `database/sqlite/wallboard.db` มีอยู่และ accessible
- [ ] Tables ทั้งหมดถูกสร้างแล้ว (teams, agents, agent_sessions, system_config)
- [ ] Sample data ครบทั้งหมด (3 teams, 13 agents, 8 configs)
- [ ] สามารถ query ด้วย SQL ได้ปกติ

**MongoDB Verification:**
- [ ] MongoDB service running และเชื่อมต่อได้
- [ ] Database `wallboard` ถูกสร้างแล้ว
- [ ] Collections ครบทั้งหมด (messages, agent_status, connection_logs)
- [ ] Sample data มีใน collections

**Integration Verification:**
- [ ] Backend เชื่อมต่อ databases ได้ทั้งคู่
- [ ] Sample login credentials ใช้งานได้ (SP001, AG001)
- [ ] Status changes บันทึกลง MongoDB ได้
- [ ] Messages save/retrieve ได้ถูกต้อง

---

## 🎯 **Next Steps**

หลังจากเข้าใจ database schema และ sample data แล้ว ขั้นตอนต่อไปคือ:

1. **🏗️ 6.6.2 Backend Server Code** - เรียนรู้วิธีการใช้ databases ในโค้ด
2. **🖥️ 6.6.3 Frontend Applications** - เข้าใจการแสดงข้อมูลใน UI
3. **📅 6.2 Development Plan** - เริ่มพัฒนาตาม 14-day roadmap

### **💡 เคล็ดลับสำหรับการทำงานกับ Database:**

**🔍 การ Debug Database Issues:**
- **ใช้ Database Browser Tools** - SQLite Browser สำหรับ SQLite, MongoDB Compass สำหรับ MongoDB
- **ตรวจสอบ Connection Strings** - ใน .env files ว่าถูกต้อง
- **ดู Backend Logs** - เมื่อเกิด database errors
- **Test Queries ก่อน** - ลองรัน queries ใน database tools ก่อนเขียนโค้ด

**📊 การวิเคราะห์ข้อมูล:**
- **เริ่มจาก Simple Queries** - SELECT ธรรมดาก่อนทำ complex joins
- **ใช้ Indexes อย่างชาญฉลาด** - เพื่อ performance ที่ดี
- **Monitor Query Performance** - สำหรับ real-time operations
- **Keep Data Fresh** - ใช้ reset scripts เมื่อข้อมูลยุ่งจากการทดสอบ

**🔐 Security Best Practices:**
- **ไม่เก็บ Sensitive Data** - ใน sample data
- **ใช้ Environment Variables** - สำหรับ database credentials
- **Regular Backups** - ก่อนการทดสอบ features ใหม่
- **Validate Input Data** - ก่อน insert/update database

---

## 📞 **Need Help with Database?**

**ถ้าเจอปัญหาเกี่ยวกับ Database:**

**🔧 SQLite Issues:**
1. **Database file not found** - ตรวจสอบ path ใน .env file
2. **Permission denied** - ตรวจสอบ file permissions
3. **Table doesn't exist** - รัน init.sql script ใหม่
4. **Sample data missing** - รัน sample_data.sql script

**🍃 MongoDB Issues:**
1. **Connection refused** - ตรวจสอบว่า MongoDB service กำลังทำงาน
2. **Database not found** - รัน sample_data.js script
3. **Collection empty** - ตรวจสอบ sample data insertion
4. **Query errors** - ตรวจสอบ syntax ใน MongoDB shell

**📋 Quick Troubleshooting Commands:**
```bash
# Test SQLite connection
sqlite3 database/sqlite/wallboard.db "SELECT COUNT(*) FROM agents;"

# Test MongoDB connection  
mongosh wallboard --eval "db.stats()"

# Check backend database connections
curl http://localhost:3001/api/test/database

# Reset everything if needed
chmod +x scripts/reset-data.sh && ./scripts/reset-data.sh
```

**🆘 Emergency Reset:**
ถ้าข้อมูลเสียหายหรือยุ่งจากการทดสอบ:
```bash
# Complete database reset
rm -f database/sqlite/wallboard.db
cd database/sqlite && ./create_db.sh && cd ../..
mongosh wallboard --eval "db.dropDatabase()"
cd database/mongodb && node sample_data.js && cd ../..
```

---

## 🎉 **สรุป Database Architecture**

**🏆 ความเข้าใจที่ได้รับ:**

### **📊 SQLite (Master Data):**
- **4 Tables** สำหรับข้อมูลหลักของระบบ
- **13 Sample Users** (3 supervisors + 10 agents)
- **3 Teams** พร้อม supervisor assignments
- **8 Configuration Settings** สำหรับปรับแต่งระบบ

### **🍃 MongoDB (Real-time Data):**
- **4 Collections** สำหรับข้อมูล dynamic
- **Flexible Schema** สำหรับ real-time requirements
- **Time-series Data** สำหรับ analytics และ reporting
- **Performance Optimized** สำหรับ high-frequency operations

### **🔗 Integration Benefits:**
- **Best of Both Worlds** - Structured + Flexible data storage
- **Performance Optimization** - Right tool for right job
- **Scalability** - Can scale each database independently
- **Learning Experience** - Practical experience with hybrid architecture

**🚀 คุณพร้อมแล้วสำหรับการพัฒนา Agent Wallboard System!**

**Database เป็นหัวใจของระบบ และตอนนี้คุณเข้าใจโครงสร้างและข้อมูลทั้งหมดแล้ว ขั้นตอนต่อไปคือการเรียนรู้วิธีใช้ข้อมูลเหล่านี้ในโค้ด Backend และ Frontend** 💪

---

## 📚 **Additional Resources**

**📖 Documentation Links:**
- **SQLite Tutorial:** https://www.sqlitetutorial.net/
- **MongoDB Manual:** https://docs.mongodb.com/manual/
- **SQL vs NoSQL:** https://www.mongodb.com/nosql-explained/nosql-vs-sql
- **Database Design Best Practices:** ดูใน docs/database-design.md

**🛠️ Recommended Tools:**
- **SQLite Browser:** https://sqlitebrowser.org/ (Free GUI for SQLite)
- **MongoDB Compass:** https://www.mongodb.com/products/compass (Free GUI for MongoDB)
- **VS Code Extensions:** SQLite, MongoDB for VS Code
- **Command Line Tools:** sqlite3, mongosh

**🎓 Learning Path สำหรับ Database:**
1. **Week 1 Day 1-2:** ทำความเข้าใจ schema และ sample data
2. **Week 1 Day 3-4:** ทดสอบ queries และ data manipulation
3. **Week 1 Day 5-7:** เชื่อมต่อกับ backend code
4. **Week 2:** เพิ่มข้อมูลใหม่และ optimize performance

**Happy Database Learning! 🗄️✨**