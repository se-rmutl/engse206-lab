# 6.6.3.1 Frontend Applications - Electron Agent App

## 🎯 Overview

เอกสารนี้จะอธิบายโครงสร้างและการพัฒนา **Agent Desktop Application** ที่สร้างด้วย **Electron.js + React** สำหรับระบบ Agent Wallboard System โดย App นี้จะมีฟีเจอร์พื้นฐานที่ครอบคลุมการทำงานของ Agent

### 🎓 เป้าหมายการเรียนรู้
เมื่อจบการอ่านเอกสารนี้ นักศึกษาจะสามารถ:
- เข้าใจโครงสร้างไฟล์ของ Electron app ที่เตรียมไว้ให้
- รู้วิธีการรัน และทดสอบ Agent Desktop App
- เข้าใจไฟล์หลักที่จะต้องแก้ไขในการพัฒนา
- สามารถปรับแต่งและเพิ่มฟีเจอร์เบื้องต้นได้

---

## 🏗️ **Electron App ที่ได้ในชุด Starter Code**

### **📊 ระดับความพร้อมใช้งาน: 75% Complete**

```
✅ พร้อมใช้งาน:
├── ⚡ Electron app structure สำเร็จรูป
├── 🔐 Login form พร้อม validation
├── 📊 Status change buttons (Available/Busy/Break/Offline)
├── 🔌 WebSocket client connection
├── 🔔 Basic desktop notifications
└── 💬 Message receiving และ display

🎯 นักศึกษาต้องเพิ่ม/แก้ไข:
├── 🎨 ปรับปรุง UI design และ branding
├── 🔊 เพิ่มฟีเจอร์ notification sounds
├── ⚙️ ปรับแต่ง system tray integration
└── 📋 เพิ่ม message history display
```

---

## 📁 **Project Structure (Simple & Practical)**

```
agent-desktop/
├── 📦 package.json                # Dependencies: electron, react, socket.io-client
├── 🔧 .env.example                # API_URL, SOCKET_URL, ELECTRON_IS_DEV
├── ⚡ main.js                     # Electron main process - สร้าง window, system tray
├── 🔒 preload.js                  # Security bridge ระหว่าง main และ renderer
│
├── 📝 public/
│   ├── 🌐 index.html              # HTML template สำหรับ React app
│   └── 🖼️ assets/                 # Icons, images สำหรับ Electron
│       ├── icon.png               # App icon
│       └── tray-icon.png          # System tray icon
│
├── ⚛️ src/                         # React Application Source
│   ├── 📱 App.js                   # Main React component - login state, WebSocket
│   ├── 🎯 index.js                 # React entry point
│   │
│   ├── 🧩 components/              # UI Components (เฉพาะที่จำเป็น)
│   │   ├── 🔐 LoginForm.js         # Agent login interface
│   │   ├── 📊 StatusPanel.js       # Status change buttons
│   │   ├── 💬 MessagePanel.js      # Message display
│   │   └── 👤 AgentInfo.js         # Show logged-in agent info
│   │
│   ├── 🔗 services/                # API และ WebSocket Services
│   │   ├── 🌐 api.js               # HTTP API calls (login, etc.)
│   │   ├── ⚡ socket.js            # WebSocket connection
│   │   └── 🔔 notifications.js     # Desktop notifications
│   │
│   ├── 🎨 styles/                  # CSS Files
│   │   ├── 📱 App.css              # Main app styling
│   │   └── 🧩 components.css       # Component styles
│   │
│   └── 🛠️ utils/                   # Helper Functions
│       ├── 📅 dateUtils.js         # Date formatting helpers
│       └── 🛡️ validation.js        # Input validation functions
│
└── 🏗️ build/                       # Built files (auto-generated)
```

---

## ⚡ **Main Process (main.js) - แบบเรียบง่าย**

### **🎯 main.js หน้าที่หลัก**
```javascript
// main.js - ไฟล์หลักของ Electron app
const { app, BrowserWindow, Tray, Menu } = require('electron');
const path = require('path');
const isDev = process.env.NODE_ENV === 'development';

let mainWindow;
let tray;

// 🚀 สร้าง main window
function createWindow() {
  mainWindow = new BrowserWindow({
    width: 400,          // ขนาดเล็กพอดี
    height: 600,
    icon: path.join(__dirname, 'public/assets/icon.png'),
    webPreferences: {
      nodeIntegration: false,    // Security
      contextIsolation: true,    // Security
      preload: path.join(__dirname, 'preload.js')
    }
  });

  // โหลด React app
  const startUrl = isDev 
    ? 'http://localhost:3000' 
    : `file://${path.join(__dirname, '../build/index.html')}`;
  
  mainWindow.loadURL(startUrl);
}

// 🔔 สร้าง system tray
function createTray() {
  tray = new Tray(path.join(__dirname, 'public/assets/tray-icon.png'));
  
  const contextMenu = Menu.buildFromTemplate([
    { label: 'Show App', click: () => mainWindow.show() },
    { label: 'Quit', click: () => app.quit() }
  ]);
  
  tray.setContextMenu(contextMenu);
  tray.setToolTip('Agent Wallboard');
}

// 🎯 App events
app.whenReady().then(() => {
  createWindow();
  createTray();
});

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') app.quit();
});
```

### **🔒 preload.js - Security Bridge**
```javascript
// preload.js - ส่วนเชื่อมต่อความปลอดภัย
const { contextBridge, ipcRenderer } = require('electron');

// เปิดเผย API ที่ปลอดภัยให้ React ใช้
contextBridge.exposeInMainWorld('electronAPI', {
  // ส่ง notification ผ่าน main process
  showNotification: (title, body) => {
    ipcRenderer.invoke('show-notification', { title, body });
  },
  
  // ปิด app
  closeApp: () => {
    ipcRenderer.invoke('close-app');
  }
});
```

---

## ⚛️ **React App Structure (src/)**

### **📱 App.js - Main Component**
```javascript
// src/App.js - React component หลัก
import React, { useState, useEffect } from 'react';
import LoginForm from './components/LoginForm';
import StatusPanel from './components/StatusPanel';
import MessagePanel from './components/MessagePanel';
import AgentInfo from './components/AgentInfo';
import { connectSocket, disconnectSocket } from './services/socket';
import './styles/App.css';

function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [agent, setAgent] = useState(null);
  const [status, setStatus] = useState('Offline');
  const [messages, setMessages] = useState([]);

  // 🔌 เชื่อมต่อ WebSocket เมื่อ login สำเร็จ
  useEffect(() => {
    if (isLoggedIn && agent) {
      connectSocket(agent.agentCode);
      
      // ฟัง status updates
      window.socket?.on('status_updated', (data) => {
        setStatus(data.status);
      });
      
      // ฟัง messages ใหม่
      window.socket?.on('new_message', (message) => {
        setMessages(prev => [...prev, message]);
        
        // แสดง notification
        if (window.electronAPI) {
          window.electronAPI.showNotification(
            'New Message', 
            message.content
          );
        }
      });
    }
    
    return () => {
      disconnectSocket();
    };
  }, [isLoggedIn, agent]);

  // 🔐 Handle login
  const handleLogin = (agentData) => {
    setAgent(agentData);
    setIsLoggedIn(true);
    setStatus('Available');
  };

  // 📊 Handle status change
  const handleStatusChange = (newStatus) => {
    setStatus(newStatus);
    // ส่ง status update ผ่าน WebSocket
    window.socket?.emit('update_status', {
      agentCode: agent.agentCode,
      status: newStatus
    });
  };

  return (
    <div className="app">
      {!isLoggedIn ? (
        <LoginForm onLogin={handleLogin} />
      ) : (
        <div className="dashboard">
          <AgentInfo agent={agent} status={status} />
          <StatusPanel 
            currentStatus={status} 
            onStatusChange={handleStatusChange} 
          />
          <MessagePanel messages={messages} />
        </div>
      )}
    </div>
  );
}

export default App;
```

---

## 🧩 **Key Components ที่นักศึกษาจะทำงานด้วย**

### **🔐 LoginForm.js**
```javascript
// src/components/LoginForm.js
import React, { useState } from 'react';
import { loginAgent } from '../services/api';

function LoginForm({ onLogin }) {
  const [agentCode, setAgentCode] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError('');

    try {
      const agentData = await loginAgent(agentCode);
      onLogin(agentData);
    } catch (err) {
      setError('Invalid agent code');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="login-form">
      <h2>Agent Login</h2>
      <form onSubmit={handleSubmit}>
        <input
          type="text"
          placeholder="Agent Code (e.g., AG001)"
          value={agentCode}
          onChange={(e) => setAgentCode(e.target.value)}
          required
        />
        <button type="submit" disabled={loading}>
          {loading ? 'Logging in...' : 'Sign In'}
        </button>
        {error && <div className="error">{error}</div>}
      </form>
    </div>
  );
}

export default LoginForm;
```

### **📊 StatusPanel.js**
```javascript
// src/components/StatusPanel.js
import React from 'react';

function StatusPanel({ currentStatus, onStatusChange }) {
  const statuses = [
    { key: 'Available', label: 'Available', color: '#4CAF50' },
    { key: 'Busy', label: 'Busy', color: '#FF9800' },
    { key: 'Break', label: 'Break', color: '#2196F3' },
    { key: 'Offline', label: 'Offline', color: '#9E9E9E' }
  ];

  return (
    <div className="status-panel">
      <h3>Current Status: <span className={`status ${currentStatus.toLowerCase()}`}>
        {currentStatus}
      </span></h3>
      
      <div className="status-buttons">
        {statuses.map(status => (
          <button
            key={status.key}
            className={`status-btn ${status.key === currentStatus ? 'active' : ''}`}
            onClick={() => onStatusChange(status.key)}
            style={{ backgroundColor: status.color }}
          >
            {status.label}
          </button>
        ))}
      </div>
    </div>
  );
}

export default StatusPanel;
```

---

## 🔗 **Services - API และ WebSocket**

### **🌐 api.js - HTTP API Calls**
```javascript
// src/services/api.js
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';

export const loginAgent = async (agentCode) => {
  const response = await fetch(`${API_BASE_URL}/auth/login`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ agentCode })
  });

  if (!response.ok) {
    throw new Error('Login failed');
  }

  return response.json();
};

export const getAgentInfo = async (agentCode) => {
  const response = await fetch(`${API_BASE_URL}/agents/${agentCode}`);
  return response.json();
};
```

### **⚡ socket.js - WebSocket Connection**
```javascript
// src/services/socket.js
import io from 'socket.io-client';

const SOCKET_URL = process.env.REACT_APP_SOCKET_URL || 'http://localhost:3001';
let socket = null;

export const connectSocket = (agentCode) => {
  socket = io(SOCKET_URL, {
    query: { agentCode, type: 'agent' }
  });

  socket.on('connect', () => {
    console.log('Connected to server');
  });

  socket.on('disconnect', () => {
    console.log('Disconnected from server');
  });

  // เก็บ socket ไว้ใน global scope สำหรับใช้ใน components
  window.socket = socket;
  
  return socket;
};

export const disconnectSocket = () => {
  if (socket) {
    socket.disconnect();
    socket = null;
    window.socket = null;
  }
};
```

---

## 🎨 **Styling - เรียบง่ายและใช้งานได้**

### **📱 App.css - Main Styles**
```css
/* src/styles/App.css */
.app {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  max-width: 400px;
  margin: 0 auto;
  padding: 20px;
  background: #f5f5f5;
  min-height: 100vh;
}

.login-form {
  background: white;
  padding: 30px;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.login-form h2 {
  text-align: center;
  margin-bottom: 20px;
  color: #333;
}

.login-form input {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}

.login-form button {
  width: 100%;
  padding: 12px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
}

.login-form button:hover {
  background: #0056b3;
}

.login-form button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.error {
  color: #dc3545;
  text-align: center;
  margin-top: 10px;
}

.dashboard {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.status-panel {
  margin-bottom: 20px;
}

.status-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 15px;
}

.status-btn {
  padding: 12px;
  border: none;
  border-radius: 4px;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: opacity 0.2s;
}

.status-btn:hover {
  opacity: 0.8;
}

.status-btn.active {
  box-shadow: 0 0 0 3px rgba(0,0,0,0.2);
}

.status {
  font-weight: bold;
  padding: 4px 8px;
  border-radius: 4px;
  color: white;
}

.status.available { background: #4CAF50; }
.status.busy { background: #FF9800; }
.status.break { background: #2196F3; }
.status.offline { background: #9E9E9E; }
```

---

## 🚀 **Package.json และ Scripts**

### **📦 package.json Example**
```json
{
  "name": "agent-desktop",
  "version": "1.0.0",
  "description": "Agent Wallboard Desktop Application",
  "main": "main.js",
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "electron": "electron .",
    "electron-dev": "concurrently \"npm start\" \"wait-on http://localhost:3000 && electron .\"",
    "dist": "npm run build && electron-builder"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-scripts": "5.0.1",
    "socket.io-client": "^4.7.2",
    "electron": "^25.0.0"
  },
  "devDependencies": {
    "concurrently": "^8.2.0",
    "wait-on": "^7.0.1",
    "electron-builder": "^24.6.3"
  }
}
```

---

## 🧪 **Development และ Testing**

### **🔧 Development Scripts**
```bash
# เริ่ม development
npm run electron-dev

# Build production
npm run build
npm run electron

# Package as executable
npm run dist
```

### **✅ Basic Testing Checklist**
```bash
📋 Agent Desktop Testing:
├── ✅ App เปิดได้เป็น Electron window
├── ✅ Login ด้วย agent code ได้ (AG001, AG002, etc.)
├── ✅ แสดงข้อมูล agent ที่ login
├── ✅ เปลี่ยน status ได้ทั้ง 4 แบบ
├── ✅ Status เปลี่ยนใน Supervisor Dashboard แบบ real-time
├── ✅ รับข้อความจาก supervisor ได้
├── ✅ แสดง desktop notification เมื่อมีข้อความใหม่
└── ✅ System tray ทำงานได้
```

---

## 🎯 **สิ่งที่นักศึกษาจะแก้ไข/เพิ่มเติม**

### **Week 1: ทำความเข้าใจและปรับแต่งพื้นฐาน**
- ✅ ทดสอบ app ให้ทำงานได้
- 🎨 ปรับ CSS styling ให้สวยขึ้น
- 🖼️ เปลี่ยน icon และ branding
- 🔊 เพิ่ม notification sound

### **Week 2: เพิ่มฟีเจอร์ใหม่**
- 📋 Message history และ search
- ⚙️ Settings panel (notification preferences)
- 📊 แสดง team members และ status
- 🎯 Quick status presets

---

## 📞 **Troubleshooting**

### **❌ Common Issues และแก้ไข**

**Issue 1: "Electron won't start"**
```bash
# ลบ node_modules และ install ใหม่
rm -rf node_modules package-lock.json
npm install
npm run electron-dev
```

**Issue 2: "Cannot connect to backend"**
```bash
# ตรวจสอบ .env file
REACT_APP_API_URL=http://localhost:3001/api
REACT_APP_SOCKET_URL=http://localhost:3001

# ตรวจสอบ backend กำลังทำงาน
curl http://localhost:3001/health
```

**Issue 3: "White screen in Electron"**
```bash
# เปิด DevTools ใน Electron
mainWindow.webContents.openDevTools();

# ตรวจสอบ console errors
```

---

## ✅ **Summary**

**🎉 Agent Desktop App ที่ได้:**
- ⚡ **Electron application** ที่ทำงานบน desktop
- 🔐 **Login system** พร้อม validation
- 📊 **Status management** สำหรับ agent
- 💬 **Real-time messaging** จาก supervisor
- 🔔 **Desktop notifications** เมื่อมีข้อความใหม่
- 🎯 **System tray integration** สำหรับ quick access

**💡 Next Steps:**
1. ทดสอบ app ให้ทำงานกับ backend และ supervisor dashboard
2. ปรับแต่ง UI/UX ให้เหมาะกับการใช้งานจริง
3. เพิ่มฟีเจอร์ตามต้องการของทีม

**Happy Coding! 🚀**